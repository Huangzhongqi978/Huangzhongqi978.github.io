<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><!--!--><title>åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ« - Brahmacaryaå¥‡å¥‡</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#1e88e5"><meta name="application-name" content="Brahmacaryaå¥‡å¥‡"><meta name="msapplication-TileImage" content="/img/logo-192.png"><meta name="msapplication-TileColor" content="#1e88e5"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brahmacaryaå¥‡å¥‡"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="192x192" href="/img/logo-192.png"><link rel="apple-touch-icon" sizes="512x512" href="/img/logo-512.png"><meta name="description" content="GRUæ¶æ„ä¸‹çš„è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«"><meta property="og:type" content="website"><meta property="og:title" content="åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ«"><meta property="og:url" content="https://huangzhongqi978.top/2025/10/01/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3/"><meta property="og:site_name" content="Brahmacaryaå¥‡å¥‡"><meta property="og:description" content="GRUæ¶æ„ä¸‹çš„è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://huangzhongqi978.top/img/og_image.png"><meta property="article:published_time" content="2025-10-01T08:40:31.000Z"><meta property="article:modified_time" content="2025-10-01T08:52:29.154Z"><meta property="article:author" content="HuangZhongqi"><meta property="article:tag" content="GRUç»“æ„"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://huangzhongqi978.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://huangzhongqi978.top/2025/10/01/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3/"},"headline":"åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ«","image":["https://huangzhongqi978.top/img/og_image.png"],"datePublished":"2025-10-01T08:40:31.000Z","dateModified":"2025-10-01T08:52:29.154Z","author":{"@type":"Person","name":"HuangZhongqi"},"publisher":{"@type":"Organization","name":"Brahmacaryaå¥‡å¥‡","logo":{"@type":"ImageObject","url":"https://huangzhongqi978.top/img/logo.svg"}},"description":"GRUæ¶æ„ä¸‹çš„è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«"}</script><link rel="canonical" href="https://huangzhongqi978.top/2025/10/01/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="/css/modern-effects.css"><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Brahmacaryaå¥‡å¥‡" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/Huangzhongqi978"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/"><i class="fab fa-twitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="LinkedIn" href="https://linkedin.com/in/huangzhongqi"><i class="fab fa-linkedin"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-10-01T08:40:31.000Z" title="2025/10/1 16:40:31">2025-10-01</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-10-01T08:52:29.154Z" title="2025/10/1 16:52:29">2025-10-01</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86/">è‡ªç„¶è¯­è¨€å¤„ç†</a></span><span class="level-item">1 å°æ—¶è¯»å®Œ (å¤§çº¦11025ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile">åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ«</h1><div class="content"><p>GRUæ¶æ„ä¸‹çš„è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«</p>
<span id="more"></span>

<h1 id="æƒ…æ„Ÿè¯†åˆ«æ¨¡å‹ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£"><a href="#æƒ…æ„Ÿè¯†åˆ«æ¨¡å‹ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£" class="headerlink" title="æƒ…æ„Ÿè¯†åˆ«æ¨¡å‹ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£"></a>æƒ…æ„Ÿè¯†åˆ«æ¨¡å‹ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£</h1><h2 id="ğŸ“‹-ç›®å½•"><a href="#ğŸ“‹-ç›®å½•" class="headerlink" title="ğŸ“‹ ç›®å½•"></a>ğŸ“‹ ç›®å½•</h2><ol>
<li><a href="#%E6%A6%82%E8%BF%B0">æ¦‚è¿°</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8C%96%E6%8A%80%E6%9C%AF">æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E8%AF%A6%E8%A7%A3">ä»£ç å®ç°è¯¦è§£</a></li>
<li><a href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E">å‚æ•°é…ç½®è¯´æ˜</a></li>
<li><a href="#%E8%AE%AD%E7%BB%83%E7%AD%96%E7%95%A5%E4%BC%98%E5%8C%96">è®­ç»ƒç­–ç•¥ä¼˜åŒ–</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96">æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–</a></li>
</ol>
<hr>
<h2 id="ğŸ“–-æ¦‚è¿°"><a href="#ğŸ“–-æ¦‚è¿°" class="headerlink" title="ğŸ“– æ¦‚è¿°"></a>ğŸ“– æ¦‚è¿°</h2><p>æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†IEMOCAPæƒ…æ„Ÿè¯†åˆ«æ¨¡å‹çš„æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯ï¼Œä¸»è¦è§£å†³è·¨è¯´è¯äººæƒ…æ„Ÿè¯†åˆ«ä¸­çš„æ³›åŒ–èƒ½åŠ›é—®é¢˜ã€‚ä¼˜åŒ–ç­–ç•¥åŒ…æ‹¬è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯ã€é«˜çº§è®­ç»ƒç­–ç•¥å’Œç»¼åˆæŸå¤±å‡½æ•°è®¾è®¡ã€‚</p>
<h3 id="ä¸»è¦ä¼˜åŒ–ç›®æ ‡"><a href="#ä¸»è¦ä¼˜åŒ–ç›®æ ‡" class="headerlink" title="ä¸»è¦ä¼˜åŒ–ç›®æ ‡"></a>ä¸»è¦ä¼˜åŒ–ç›®æ ‡</h3><ul>
<li>ğŸ¯ <strong>æå‡è·¨è¯´è¯äººæ³›åŒ–èƒ½åŠ›</strong>ï¼šæ¶ˆé™¤è¯´è¯äººç‰¹å¾å¯¹æƒ…æ„Ÿè¯†åˆ«çš„å¹²æ‰°</li>
<li>ğŸ“ˆ <strong>å¢å¼ºæ¨¡å‹é²æ£’æ€§</strong>ï¼šé€šè¿‡å¤šç§æ­£åˆ™åŒ–å’Œæ•°æ®å¢å¼ºæŠ€æœ¯</li>
<li>âš¡ <strong>ä¼˜åŒ–è®­ç»ƒæ•ˆç‡</strong>ï¼šé‡‡ç”¨å…ˆè¿›çš„å­¦ä¹ ç‡è°ƒåº¦å’Œæ—©åœç­–ç•¥</li>
<li>ğŸ” <strong>æä¾›å…¨é¢ç›‘æ§</strong>ï¼šå®æ—¶å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹å’Œæ¨¡å‹æ€§èƒ½</li>
</ul>
<hr>
<h2 id="ğŸ”§-æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯"><a href="#ğŸ”§-æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯" class="headerlink" title="ğŸ”§ æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯"></a>ğŸ”§ æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯</h2><h3 id="1-è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯"><a href="#1-è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯" class="headerlink" title="1. è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯"></a>1. è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯</h3><h4 id="1-1-è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ–-AdaIN"><a href="#1-1-è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ–-AdaIN" class="headerlink" title="1.1 è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ– (AdaIN)"></a>1.1 è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ– (AdaIN)</h4><p><strong>åŸç†</strong>ï¼šé€šè¿‡å®ä¾‹çº§åˆ«çš„å½’ä¸€åŒ–æ¶ˆé™¤ä¸åŒè¯´è¯äººçš„éŸ³é¢‘ç‰¹å¾å·®å¼‚ï¼Œä¿ç•™æƒ…æ„Ÿç›¸å…³ä¿¡æ¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AdaptiveInstanceNormalization</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ– - è¯´è¯äººå½’ä¸€åŒ–å±‚</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    åŸç†ï¼š</span></span><br><span class="line"><span class="string">    1. è®¡ç®—æ¯ä¸ªæ ·æœ¬åœ¨æ—¶åºç»´åº¦ä¸Šçš„å‡å€¼å’Œæ–¹å·®</span></span><br><span class="line"><span class="string">    2. è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œæ¶ˆé™¤è¯´è¯äººç‰¹å¾å·®å¼‚</span></span><br><span class="line"><span class="string">    3. é€šè¿‡å¯å­¦ä¹ å‚æ•°é‡æ–°ç¼©æ”¾ï¼Œä¿ç•™æƒ…æ„Ÿä¿¡æ¯</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    æ•°å­¦å…¬å¼ï¼š</span></span><br><span class="line"><span class="string">    Î¼ = mean(x, dim=1)  # æ—¶åºç»´åº¦å‡å€¼</span></span><br><span class="line"><span class="string">    ÏƒÂ² = var(x, dim=1)  # æ—¶åºç»´åº¦æ–¹å·®</span></span><br><span class="line"><span class="string">    x_norm = (x - Î¼) / âˆš(ÏƒÂ² + Îµ)  # å½’ä¸€åŒ–</span></span><br><span class="line"><span class="string">    output = Î³ * x_norm + Î²  # ä»¿å°„å˜æ¢</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num_features, eps=<span class="number">1e-5</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(AdaptiveInstanceNormalization, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.num_features = num_features</span><br><span class="line">        <span class="variable language_">self</span>.eps = eps  <span class="comment"># æ•°å€¼ç¨³å®šæ€§å‚æ•°</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å¯å­¦ä¹ çš„ç¼©æ”¾å’Œåç§»å‚æ•°</span></span><br><span class="line">        <span class="variable language_">self</span>.weight = nn.Parameter(torch.ones(num_features))   <span class="comment"># Î³ ç¼©æ”¾å‚æ•°</span></span><br><span class="line">        <span class="variable language_">self</span>.bias = nn.Parameter(torch.zeros(num_features))    <span class="comment"># Î² åç§»å‚æ•°</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å‰å‘ä¼ æ’­</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: [batch_size, seq_len, num_features] è¾“å…¥ç‰¹å¾</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            å½’ä¸€åŒ–åçš„ç‰¹å¾</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># è®¡ç®—å®ä¾‹çº§åˆ«çš„å‡å€¼å’Œæ–¹å·®ï¼ˆè·¨åºåˆ—ç»´åº¦ï¼‰</span></span><br><span class="line">        mean = x.mean(dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)  <span class="comment"># [batch_size, 1, num_features]</span></span><br><span class="line">        var = x.var(dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>, unbiased=<span class="literal">False</span>)  <span class="comment"># [batch_size, 1, num_features]</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å½’ä¸€åŒ–å¤„ç†</span></span><br><span class="line">        x_norm = (x - mean) / torch.sqrt(var + <span class="variable language_">self</span>.eps)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åº”ç”¨å¯å­¦ä¹ çš„ä»¿å°„å˜æ¢</span></span><br><span class="line">        out = x_norm * <span class="variable language_">self</span>.weight.unsqueeze(<span class="number">0</span>).unsqueeze(<span class="number">0</span>) + <span class="variable language_">self</span>.bias.unsqueeze(<span class="number">0</span>).unsqueeze(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>num_features</code>: ç‰¹å¾ç»´åº¦æ•°é‡</li>
<li><code>eps</code>: æ•°å€¼ç¨³å®šæ€§å‚æ•°ï¼Œé˜²æ­¢é™¤é›¶é”™è¯¯</li>
<li><code>weight</code>: å¯å­¦ä¹ çš„ç¼©æ”¾å‚æ•°Î³</li>
<li><code>bias</code>: å¯å­¦ä¹ çš„åç§»å‚æ•°Î²</li>
</ul>
<h4 id="1-2-æ¢¯åº¦åè½¬å¯¹æŠ—è®­ç»ƒ"><a href="#1-2-æ¢¯åº¦åè½¬å¯¹æŠ—è®­ç»ƒ" class="headerlink" title="1.2 æ¢¯åº¦åè½¬å¯¹æŠ—è®­ç»ƒ"></a>1.2 æ¢¯åº¦åè½¬å¯¹æŠ—è®­ç»ƒ</h4><p><strong>åŸç†</strong>ï¼šé€šè¿‡æ¢¯åº¦åè½¬å±‚å®ç°å¯¹æŠ—è®­ç»ƒï¼Œè¿«ä½¿æ¨¡å‹å­¦ä¹ è¯´è¯äººæ— å…³çš„ç‰¹å¾è¡¨ç¤ºã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GradientReversalLayer</span>(torch.autograd.Function):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ¢¯åº¦åè½¬å±‚ - å¯¹æŠ—è®­ç»ƒæ ¸å¿ƒç»„ä»¶</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    åŸç†ï¼š</span></span><br><span class="line"><span class="string">    1. å‰å‘ä¼ æ’­ï¼šæ­£å¸¸ä¼ é€’ç‰¹å¾ï¼Œä¸åšä»»ä½•æ”¹å˜</span></span><br><span class="line"><span class="string">    2. åå‘ä¼ æ’­ï¼šå°†æ¢¯åº¦ä¹˜ä»¥è´Ÿçš„ç¼©æ”¾å› å­Î±</span></span><br><span class="line"><span class="string">    3. æ•ˆæœï¼šä½¿æ¨¡å‹æ— æ³•ä»ç‰¹å¾ä¸­è¯†åˆ«è¯´è¯äººèº«ä»½</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    æ•°å­¦è¡¨ç¤ºï¼š</span></span><br><span class="line"><span class="string">    forward: y = x</span></span><br><span class="line"><span class="string">    backward: âˆ‚L/âˆ‚x = -Î± * âˆ‚L/âˆ‚y</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">ctx, x, alpha</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å‰å‘ä¼ æ’­ï¼šç›´æ¥ä¼ é€’è¾“å…¥</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: è¾“å…¥ç‰¹å¾</span></span><br><span class="line"><span class="string">            alpha: æ¢¯åº¦åè½¬å¼ºåº¦</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        ctx.alpha = alpha  <span class="comment"># ä¿å­˜alphaç”¨äºåå‘ä¼ æ’­</span></span><br><span class="line">        <span class="keyword">return</span> x.view_as(x)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backward</span>(<span class="params">ctx, grad_output</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        åå‘ä¼ æ’­ï¼šæ¢¯åº¦ç¬¦å·åè½¬</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            grad_output: æ¥è‡ªä¸Šå±‚çš„æ¢¯åº¦</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            åè½¬åçš„æ¢¯åº¦</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> grad_output.neg() * ctx.alpha, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gradient_reverse</span>(<span class="params">x, alpha=<span class="number">1.0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¢¯åº¦åè½¬å‡½æ•°åŒ…è£…å™¨&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> GradientReversalLayer.apply(x, alpha)</span><br></pre></td></tr></table></figure>

<p><strong>è¯´è¯äººåˆ†ç±»å™¨</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯´è¯äººåˆ†ç±»å¤´ï¼ˆç”¨äºå¯¹æŠ—è®­ç»ƒï¼‰</span></span><br><span class="line"><span class="keyword">if</span> <span class="variable language_">self</span>.use_adversarial:</span><br><span class="line">    <span class="variable language_">self</span>.speaker_classifier = nn.Sequential(</span><br><span class="line">        nn.Linear(hidden_size * <span class="number">4</span>, hidden_size),      <span class="comment"># ç‰¹å¾é™ç»´</span></span><br><span class="line">        nn.ReLU(inplace=<span class="literal">True</span>),                        <span class="comment"># éçº¿æ€§æ¿€æ´»</span></span><br><span class="line">        nn.Dropout(<span class="variable language_">self</span>.dropout_rate),                <span class="comment"># é˜²è¿‡æ‹Ÿåˆ</span></span><br><span class="line">        nn.Linear(hidden_size, hidden_size // <span class="number">2</span>),     <span class="comment"># è¿›ä¸€æ­¥é™ç»´</span></span><br><span class="line">        nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">        nn.Dropout(<span class="variable language_">self</span>.dropout_rate),</span><br><span class="line">        nn.Linear(hidden_size // <span class="number">2</span>, <span class="number">10</span>)              <span class="comment"># 10ä¸ªè¯´è¯äººåˆ†ç±»</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h3 id="2-å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶"><a href="#2-å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="2. å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶"></a>2. å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶</h3><p><strong>åŸç†</strong>ï¼šé€šè¿‡å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶æ•è·åºåˆ—ä¸­çš„é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œå¢å¼ºæƒ…æ„Ÿç‰¹å¾è¡¨ç¤ºã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MultiHeadSelfAttention</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    åŸç†ï¼š</span></span><br><span class="line"><span class="string">    1. å°†è¾“å…¥ç‰¹å¾åˆ†åˆ«æŠ•å½±åˆ°Qã€Kã€Vç©ºé—´</span></span><br><span class="line"><span class="string">    2. è®¡ç®—å¤šä¸ªæ³¨æ„åŠ›å¤´çš„æ³¨æ„åŠ›æƒé‡</span></span><br><span class="line"><span class="string">    3. åŠ æƒèšåˆç‰¹å¾ä¿¡æ¯</span></span><br><span class="line"><span class="string">    4. é€šè¿‡æ®‹å·®è¿æ¥å’Œå±‚å½’ä¸€åŒ–ç¨³å®šè®­ç»ƒ</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    æ³¨æ„åŠ›å…¬å¼ï¼š</span></span><br><span class="line"><span class="string">    Attention(Q,K,V) = softmax(QK^T/âˆšd_k)V</span></span><br><span class="line"><span class="string">    MultiHead = Concat(head_1, ..., head_h)W^O</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, d_model, num_heads, dropout=<span class="number">0.1</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(MultiHeadSelfAttention, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="keyword">assert</span> d_model % num_heads == <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.d_model = d_model          <span class="comment"># æ¨¡å‹ç»´åº¦</span></span><br><span class="line">        <span class="variable language_">self</span>.num_heads = num_heads      <span class="comment"># æ³¨æ„åŠ›å¤´æ•°é‡</span></span><br><span class="line">        <span class="variable language_">self</span>.d_k = d_model // num_heads <span class="comment"># æ¯ä¸ªå¤´çš„ç»´åº¦</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># çº¿æ€§æŠ•å½±å±‚</span></span><br><span class="line">        <span class="variable language_">self</span>.w_q = nn.Linear(d_model, d_model)  <span class="comment"># QueryæŠ•å½±</span></span><br><span class="line">        <span class="variable language_">self</span>.w_k = nn.Linear(d_model, d_model)  <span class="comment"># KeyæŠ•å½±</span></span><br><span class="line">        <span class="variable language_">self</span>.w_v = nn.Linear(d_model, d_model)  <span class="comment"># ValueæŠ•å½±</span></span><br><span class="line">        <span class="variable language_">self</span>.w_o = nn.Linear(d_model, d_model)  <span class="comment"># è¾“å‡ºæŠ•å½±</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ­£åˆ™åŒ–å±‚</span></span><br><span class="line">        <span class="variable language_">self</span>.dropout = nn.Dropout(dropout)</span><br><span class="line">        <span class="variable language_">self</span>.layer_norm = nn.LayerNorm(d_model)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å‰å‘ä¼ æ’­</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: [batch_size, seq_len, d_model] è¾“å…¥ç‰¹å¾</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            æ³¨æ„åŠ›å¢å¼ºåçš„ç‰¹å¾å’Œæ³¨æ„åŠ›æƒé‡</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        batch_size, seq_len, d_model = x.size()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä¿å­˜æ®‹å·®è¿æ¥</span></span><br><span class="line">        residual = x</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. çº¿æ€§æŠ•å½±åˆ°Qã€Kã€V</span></span><br><span class="line">        Q = <span class="variable language_">self</span>.w_q(x).view(batch_size, seq_len, <span class="variable language_">self</span>.num_heads, <span class="variable language_">self</span>.d_k).transpose(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">        K = <span class="variable language_">self</span>.w_k(x).view(batch_size, seq_len, <span class="variable language_">self</span>.num_heads, <span class="variable language_">self</span>.d_k).transpose(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">        V = <span class="variable language_">self</span>.w_v(x).view(batch_size, seq_len, <span class="variable language_">self</span>.num_heads, <span class="variable language_">self</span>.d_k).transpose(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. è®¡ç®—ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›</span></span><br><span class="line">        attention_scores = torch.matmul(Q, K.transpose(-<span class="number">2</span>, -<span class="number">1</span>)) / math.sqrt(<span class="variable language_">self</span>.d_k)</span><br><span class="line">        attention_weights = F.softmax(attention_scores, dim=-<span class="number">1</span>)</span><br><span class="line">        attention_weights = <span class="variable language_">self</span>.dropout(attention_weights)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. åŠ æƒèšåˆValue</span></span><br><span class="line">        context = torch.matmul(attention_weights, V)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. æ‹¼æ¥å¤šå¤´è¾“å‡º</span></span><br><span class="line">        context = context.transpose(<span class="number">1</span>, <span class="number">2</span>).contiguous().view(</span><br><span class="line">            batch_size, seq_len, <span class="variable language_">self</span>.d_model</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 5. è¾“å‡ºæŠ•å½±</span></span><br><span class="line">        output = <span class="variable language_">self</span>.w_o(context)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 6. æ®‹å·®è¿æ¥å’Œå±‚å½’ä¸€åŒ–</span></span><br><span class="line">        output = <span class="variable language_">self</span>.layer_norm(output + residual)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> output, attention_weights.mean(dim=<span class="number">1</span>)  <span class="comment"># è¿”å›å¹³å‡æ³¨æ„åŠ›æƒé‡ç”¨äºå¯è§†åŒ–</span></span><br></pre></td></tr></table></figure>

<h3 id="3-ä½ç½®ç¼–ç "><a href="#3-ä½ç½®ç¼–ç " class="headerlink" title="3. ä½ç½®ç¼–ç "></a>3. ä½ç½®ç¼–ç </h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PositionalEncoding</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ­£å¼¦ä½ç½®ç¼–ç </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    åŸç†ï¼š</span></span><br><span class="line"><span class="string">    ä½¿ç”¨ä¸åŒé¢‘ç‡çš„æ­£å¼¦å’Œä½™å¼¦å‡½æ•°ä¸ºåºåˆ—ä¸­çš„æ¯ä¸ªä½ç½®ç”Ÿæˆå”¯ä¸€çš„ç¼–ç </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    å…¬å¼ï¼š</span></span><br><span class="line"><span class="string">    PE(pos, 2i) = sin(pos / 10000^(2i/d_model))</span></span><br><span class="line"><span class="string">    PE(pos, 2i+1) = cos(pos / 10000^(2i/d_model))</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, d_model, max_length=<span class="number">5000</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(PositionalEncoding, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åˆ›å»ºä½ç½®ç¼–ç çŸ©é˜µ</span></span><br><span class="line">        pe = torch.zeros(max_length, d_model)</span><br><span class="line">        position = torch.arange(<span class="number">0</span>, max_length).unsqueeze(<span class="number">1</span>).<span class="built_in">float</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è®¡ç®—é™¤æ•°é¡¹</span></span><br><span class="line">        div_term = torch.exp(torch.arange(<span class="number">0</span>, d_model, <span class="number">2</span>).<span class="built_in">float</span>() *</span><br><span class="line">                            -(math.log(<span class="number">10000.0</span>) / d_model))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åº”ç”¨æ­£å¼¦å’Œä½™å¼¦å‡½æ•°</span></span><br><span class="line">        pe[:, <span class="number">0</span>::<span class="number">2</span>] = torch.sin(position * div_term)  <span class="comment"># å¶æ•°ä½ç½®ä½¿ç”¨sin</span></span><br><span class="line">        pe[:, <span class="number">1</span>::<span class="number">2</span>] = torch.cos(position * div_term)  <span class="comment"># å¥‡æ•°ä½ç½®ä½¿ç”¨cos</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.register_buffer(<span class="string">&#x27;pe&#x27;</span>, pe.unsqueeze(<span class="number">0</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ·»åŠ ä½ç½®ç¼–ç åˆ°è¾“å…¥ç‰¹å¾&quot;&quot;&quot;</span></span><br><span class="line">        seq_len = x.size(<span class="number">1</span>)</span><br><span class="line">        pos_encoding = <span class="variable language_">self</span>.pe[:, :seq_len, :].to(x.device)</span><br><span class="line">        <span class="keyword">return</span> x + pos_encoding</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ—ï¸-ä»£ç å®ç°è¯¦è§£"><a href="#ğŸ—ï¸-ä»£ç å®ç°è¯¦è§£" class="headerlink" title="ğŸ—ï¸ ä»£ç å®ç°è¯¦è§£"></a>ğŸ—ï¸ ä»£ç å®ç°è¯¦è§£</h2><h3 id="1-å¢å¼ºGRUæ¨¡å‹æ¶æ„"><a href="#1-å¢å¼ºGRUæ¨¡å‹æ¶æ„" class="headerlink" title="1. å¢å¼ºGRUæ¨¡å‹æ¶æ„"></a>1. å¢å¼ºGRUæ¨¡å‹æ¶æ„</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EnhancedGRUModel</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å¢å¼ºçš„GRUæ¨¡å‹ - é’ˆå¯¹è·¨è¯´è¯äººæƒ…æ„Ÿè¯†åˆ«ä¼˜åŒ–</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    æ¶æ„ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="string">    1. è¾“å…¥æŠ•å½± + ä½ç½®ç¼–ç </span></span><br><span class="line"><span class="string">    2. è¯´è¯äººå½’ä¸€åŒ–å±‚ (AdaIN)</span></span><br><span class="line"><span class="string">    3. å¤šå±‚åŒå‘GRU + å±‚å½’ä¸€åŒ– + æ®‹å·®è¿æ¥</span></span><br><span class="line"><span class="string">    4. å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶</span></span><br><span class="line"><span class="string">    5. ç‰¹å¾å¢å¼ºæ¨¡å—</span></span><br><span class="line"><span class="string">    6. åŒè·¯åˆ†ç±»å¤´ï¼ˆæƒ…æ„Ÿ + è¯´è¯äººå¯¹æŠ—ï¼‰</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_size, hidden_size, output_size, args</span>):</span><br><span class="line">        <span class="built_in">super</span>(EnhancedGRUModel, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åŸºç¡€å‚æ•°</span></span><br><span class="line">        <span class="variable language_">self</span>.input_size = input_size</span><br><span class="line">        <span class="variable language_">self</span>.hidden_size = hidden_size</span><br><span class="line">        <span class="variable language_">self</span>.output_size = output_size</span><br><span class="line">        <span class="variable language_">self</span>.num_layers = args.dia_layers</span><br><span class="line">        <span class="variable language_">self</span>.dropout_rate = args.dropout</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åŠŸèƒ½å¼€å…³</span></span><br><span class="line">        <span class="variable language_">self</span>.use_attention = args.attention</span><br><span class="line">        <span class="variable language_">self</span>.use_speaker_norm = <span class="built_in">getattr</span>(args, <span class="string">&#x27;speaker_norm&#x27;</span>, <span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.use_adversarial = <span class="built_in">getattr</span>(args, <span class="string">&#x27;speaker_adversarial&#x27;</span>, <span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. è¾“å…¥å¤„ç†å±‚</span></span><br><span class="line">        <span class="variable language_">self</span>.input_projection = nn.Linear(input_size, hidden_size * <span class="number">2</span>)</span><br><span class="line">        <span class="variable language_">self</span>.pos_encoding = PositionalEncoding(hidden_size * <span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. è¯´è¯äººå½’ä¸€åŒ–å±‚</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.use_speaker_norm:</span><br><span class="line">            <span class="variable language_">self</span>.speaker_norm = AdaptiveInstanceNormalization(hidden_size * <span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. å¤šå±‚åŒå‘GRU</span></span><br><span class="line">        <span class="variable language_">self</span>.gru_layers = nn.ModuleList()</span><br><span class="line">        <span class="variable language_">self</span>.layer_norms = nn.ModuleList()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.num_layers):</span><br><span class="line">            input_dim = hidden_size * <span class="number">2</span> <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">else</span> hidden_size * <span class="number">4</span></span><br><span class="line">            <span class="variable language_">self</span>.gru_layers.append(</span><br><span class="line">                nn.GRU(input_dim, hidden_size * <span class="number">2</span>, batch_first=<span class="literal">True</span>, </span><br><span class="line">                      bidirectional=<span class="literal">True</span>, dropout=<span class="variable language_">self</span>.dropout_rate <span class="keyword">if</span> i &lt; <span class="variable language_">self</span>.num_layers-<span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line">            )</span><br><span class="line">            <span class="variable language_">self</span>.layer_norms.append(nn.LayerNorm(hidden_size * <span class="number">4</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. å¤šå¤´è‡ªæ³¨æ„åŠ›</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.use_attention:</span><br><span class="line">            <span class="variable language_">self</span>.self_attention = MultiHeadSelfAttention(</span><br><span class="line">                d_model=hidden_size * <span class="number">4</span>, </span><br><span class="line">                num_heads=<span class="number">8</span>, </span><br><span class="line">                dropout=<span class="variable language_">self</span>.dropout_rate</span><br><span class="line">            )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 5. ç‰¹å¾å¢å¼ºæ¨¡å—</span></span><br><span class="line">        <span class="variable language_">self</span>.feature_enhancement = nn.Sequential(</span><br><span class="line">            nn.Linear(hidden_size * <span class="number">4</span>, hidden_size * <span class="number">2</span>),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">            nn.Dropout(<span class="variable language_">self</span>.dropout_rate),</span><br><span class="line">            nn.Linear(hidden_size * <span class="number">2</span>, hidden_size * <span class="number">2</span>),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">            nn.Dropout(<span class="variable language_">self</span>.dropout_rate)</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 6. å…¨å±€æ± åŒ–ç­–ç•¥</span></span><br><span class="line">        <span class="variable language_">self</span>.global_pooling = nn.AdaptiveAvgPool1d(<span class="number">1</span>)      <span class="comment"># å¹³å‡æ± åŒ–</span></span><br><span class="line">        <span class="variable language_">self</span>.global_max_pooling = nn.AdaptiveMaxPool1d(<span class="number">1</span>)   <span class="comment"># æœ€å¤§æ± åŒ–</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 7. æƒ…æ„Ÿåˆ†ç±»å¤´</span></span><br><span class="line">        <span class="variable language_">self</span>.emotion_classifier = nn.Sequential(</span><br><span class="line">            nn.Linear(hidden_size * <span class="number">4</span>, hidden_size),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">            nn.Dropout(<span class="variable language_">self</span>.dropout_rate),</span><br><span class="line">            nn.Linear(hidden_size, hidden_size // <span class="number">2</span>),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">            nn.Dropout(<span class="variable language_">self</span>.dropout_rate),</span><br><span class="line">            nn.Linear(hidden_size // <span class="number">2</span>, output_size)</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 8. è¯´è¯äººåˆ†ç±»å¤´ï¼ˆå¯¹æŠ—è®­ç»ƒï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.use_adversarial:</span><br><span class="line">            <span class="variable language_">self</span>.speaker_classifier = nn.Sequential(</span><br><span class="line">                nn.Linear(hidden_size * <span class="number">4</span>, hidden_size),</span><br><span class="line">                nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">                nn.Dropout(<span class="variable language_">self</span>.dropout_rate),</span><br><span class="line">                nn.Linear(hidden_size, hidden_size // <span class="number">2</span>),</span><br><span class="line">                nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">                nn.Dropout(<span class="variable language_">self</span>.dropout_rate),</span><br><span class="line">                nn.Linear(hidden_size // <span class="number">2</span>, <span class="number">10</span>)  <span class="comment"># IEMOCAPæœ‰10ä¸ªè¯´è¯äºº</span></span><br><span class="line">            )</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.dropout = nn.Dropout(<span class="variable language_">self</span>.dropout_rate)</span><br><span class="line">        <span class="variable language_">self</span>._init_weights()</span><br></pre></td></tr></table></figure>

<h3 id="2-å‰å‘ä¼ æ’­æµç¨‹"><a href="#2-å‰å‘ä¼ æ’­æµç¨‹" class="headerlink" title="2. å‰å‘ä¼ æ’­æµç¨‹"></a>2. å‰å‘ä¼ æ’­æµç¨‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x, alpha=<span class="number">1.0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å‰å‘ä¼ æ’­</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        x: [batch_size, seq_len, input_size] è¾“å…¥ç‰¹å¾</span></span><br><span class="line"><span class="string">        alpha: æ¢¯åº¦åè½¬å¼ºåº¦ï¼ˆç”¨äºå¯¹æŠ—è®­ç»ƒï¼‰</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        dict: åŒ…å«æƒ…æ„Ÿå’Œè¯´è¯äººé¢„æµ‹ç»“æœçš„å­—å…¸</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    batch_size, seq_len, _ = x.size()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. è¾“å…¥æŠ•å½±å’Œä½ç½®ç¼–ç </span></span><br><span class="line">    x = <span class="variable language_">self</span>.input_projection(x)  <span class="comment"># [batch_size, seq_len, hidden_size*2]</span></span><br><span class="line">    x = <span class="variable language_">self</span>.pos_encoding(x)      <span class="comment"># æ·»åŠ ä½ç½®ä¿¡æ¯</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. è¯´è¯äººå½’ä¸€åŒ–ï¼ˆæ¶ˆé™¤è¯´è¯äººç‰¹å¾ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.use_speaker_norm:</span><br><span class="line">        x = <span class="variable language_">self</span>.speaker_norm(x)</span><br><span class="line">    </span><br><span class="line">    x = <span class="variable language_">self</span>.dropout(x)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. å¤šå±‚åŒå‘GRUå¤„ç†</span></span><br><span class="line">    <span class="keyword">for</span> i, (gru_layer, layer_norm) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(<span class="variable language_">self</span>.gru_layers, <span class="variable language_">self</span>.layer_norms)):</span><br><span class="line">        residual = x <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        gru_out, _ = gru_layer(x)  <span class="comment"># [batch_size, seq_len, hidden_size*4]</span></span><br><span class="line">        gru_out = layer_norm(gru_out)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ®‹å·®è¿æ¥ï¼ˆä»ç¬¬äºŒå±‚å¼€å§‹ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> residual <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> residual.size(-<span class="number">1</span>) == gru_out.size(-<span class="number">1</span>):</span><br><span class="line">            gru_out = gru_out + residual</span><br><span class="line">        </span><br><span class="line">        x = <span class="variable language_">self</span>.dropout(gru_out)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. å¤šå¤´è‡ªæ³¨æ„åŠ›å¢å¼º</span></span><br><span class="line">    attention_weights = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.use_attention:</span><br><span class="line">        x, attention_weights = <span class="variable language_">self</span>.self_attention(x)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. ç‰¹å¾å¢å¼º</span></span><br><span class="line">    enhanced_features = <span class="variable language_">self</span>.feature_enhancement(x)</span><br><span class="line">    combined_features = torch.cat([x, enhanced_features], dim=-<span class="number">1</span>)</span><br><span class="line">    combined_features = combined_features[:, :, :<span class="variable language_">self</span>.hidden_size*<span class="number">4</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 6. å…¨å±€æ± åŒ–</span></span><br><span class="line">    pooling_input = combined_features.transpose(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    avg_pooled = <span class="variable language_">self</span>.global_pooling(pooling_input).squeeze(-<span class="number">1</span>)</span><br><span class="line">    max_pooled = <span class="variable language_">self</span>.global_max_pooling(pooling_input).squeeze(-<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ‹¼æ¥æ± åŒ–ç»“æœ</span></span><br><span class="line">    pooled_features = torch.cat([avg_pooled, max_pooled], dim=<span class="number">1</span>)</span><br><span class="line">    final_features = pooled_features[:, :<span class="variable language_">self</span>.hidden_size*<span class="number">4</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 7. æƒ…æ„Ÿåˆ†ç±»</span></span><br><span class="line">    emotion_logits = <span class="variable language_">self</span>.emotion_classifier(final_features)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 8. è¯´è¯äººå¯¹æŠ—åˆ†ç±»</span></span><br><span class="line">    speaker_logits = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.use_adversarial:</span><br><span class="line">        <span class="comment"># åº”ç”¨æ¢¯åº¦åè½¬</span></span><br><span class="line">        adversarial_features = gradient_reverse(final_features, alpha)</span><br><span class="line">        speaker_logits = <span class="variable language_">self</span>.speaker_classifier(adversarial_features)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;emotion_logits&#x27;</span>: emotion_logits,</span><br><span class="line">        <span class="string">&#x27;speaker_logits&#x27;</span>: speaker_logits,</span><br><span class="line">        <span class="string">&#x27;attention_weights&#x27;</span>: attention_weights,</span><br><span class="line">        <span class="string">&#x27;features&#x27;</span>: final_features</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âš™ï¸-å‚æ•°é…ç½®è¯´æ˜"><a href="#âš™ï¸-å‚æ•°é…ç½®è¯´æ˜" class="headerlink" title="âš™ï¸ å‚æ•°é…ç½®è¯´æ˜"></a>âš™ï¸ å‚æ•°é…ç½®è¯´æ˜</h2><h3 id="1-æ¨¡å‹ç»“æ„å‚æ•°"><a href="#1-æ¨¡å‹ç»“æ„å‚æ•°" class="headerlink" title="1. æ¨¡å‹ç»“æ„å‚æ•°"></a>1. æ¨¡å‹ç»“æ„å‚æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€æ¶æ„å‚æ•°</span></span><br><span class="line">input_size = <span class="number">768</span>          <span class="comment"># HuBERTç‰¹å¾ç»´åº¦</span></span><br><span class="line">hidden_size = <span class="number">256</span>         <span class="comment"># GRUéšè—å±‚å¤§å°</span></span><br><span class="line">output_size = <span class="number">4</span>           <span class="comment"># æƒ…æ„Ÿç±»åˆ«æ•°é‡ï¼ˆangry, happy, neutral, sadï¼‰</span></span><br><span class="line">dia_layers = <span class="number">3</span>            <span class="comment"># GRUå±‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£åˆ™åŒ–å‚æ•°</span></span><br><span class="line">dropout = <span class="number">0.3</span>             <span class="comment"># Dropoutæ¦‚ç‡</span></span><br><span class="line">max_grad_norm = <span class="number">1.0</span>       <span class="comment"># æ¢¯åº¦è£å‰ªé˜ˆå€¼</span></span><br><span class="line">l2_reg = <span class="number">1e-5</span>            <span class="comment"># L2æ­£åˆ™åŒ–æƒé‡</span></span><br></pre></td></tr></table></figure>

<h3 id="2-ä¼˜åŒ–ç­–ç•¥å‚æ•°"><a href="#2-ä¼˜åŒ–ç­–ç•¥å‚æ•°" class="headerlink" title="2. ä¼˜åŒ–ç­–ç•¥å‚æ•°"></a>2. ä¼˜åŒ–ç­–ç•¥å‚æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­¦ä¹ ç‡è°ƒåº¦</span></span><br><span class="line">learning_rate = <span class="number">0.0005</span>    <span class="comment"># åˆå§‹å­¦ä¹ ç‡</span></span><br><span class="line">lr_schedule = <span class="string">&#x27;cosine&#x27;</span>    <span class="comment"># å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥</span></span><br><span class="line">warmup_steps = <span class="number">1000</span>       <span class="comment"># é¢„çƒ­æ­¥æ•°</span></span><br><span class="line">min_lr = <span class="number">1e-7</span>            <span class="comment"># æœ€å°å­¦ä¹ ç‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒç­–ç•¥</span></span><br><span class="line">batch_size = <span class="number">32</span>          <span class="comment"># æ‰¹æ¬¡å¤§å°</span></span><br><span class="line">epochs = <span class="number">50</span>              <span class="comment"># è®­ç»ƒè½®æ•°</span></span><br><span class="line">patience = <span class="number">10</span>            <span class="comment"># æ—©åœè€å¿ƒå€¼</span></span><br></pre></td></tr></table></figure>

<h3 id="3-è¯´è¯äººæ— å…³åŒ–å‚æ•°"><a href="#3-è¯´è¯äººæ— å…³åŒ–å‚æ•°" class="headerlink" title="3. è¯´è¯äººæ— å…³åŒ–å‚æ•°"></a>3. è¯´è¯äººæ— å…³åŒ–å‚æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># AdaINå½’ä¸€åŒ–</span></span><br><span class="line">speaker_norm = <span class="literal">True</span>       <span class="comment"># å¯ç”¨è¯´è¯äººå½’ä¸€åŒ–</span></span><br><span class="line">eps = <span class="number">1e-5</span>               <span class="comment"># æ•°å€¼ç¨³å®šæ€§å‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æŠ—è®­ç»ƒ</span></span><br><span class="line">speaker_adversarial = <span class="literal">True</span>    <span class="comment"># å¯ç”¨å¯¹æŠ—è®­ç»ƒ</span></span><br><span class="line">adversarial_weight = <span class="number">0.05</span>     <span class="comment"># å¯¹æŠ—æŸå¤±æƒé‡</span></span><br><span class="line">alpha_schedule = <span class="string">&#x27;linear&#x27;</span>     <span class="comment"># æ¢¯åº¦åè½¬å¼ºåº¦è°ƒåº¦</span></span><br><span class="line">max_alpha = <span class="number">1.0</span>              <span class="comment"># æœ€å¤§æ¢¯åº¦åè½¬å¼ºåº¦</span></span><br></pre></td></tr></table></figure>

<h3 id="4-æ³¨æ„åŠ›æœºåˆ¶å‚æ•°"><a href="#4-æ³¨æ„åŠ›æœºåˆ¶å‚æ•°" class="headerlink" title="4. æ³¨æ„åŠ›æœºåˆ¶å‚æ•°"></a>4. æ³¨æ„åŠ›æœºåˆ¶å‚æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¤šå¤´æ³¨æ„åŠ›</span></span><br><span class="line">attention = <span class="literal">True</span>          <span class="comment"># å¯ç”¨æ³¨æ„åŠ›æœºåˆ¶</span></span><br><span class="line">num_heads = <span class="number">8</span>            <span class="comment"># æ³¨æ„åŠ›å¤´æ•°é‡</span></span><br><span class="line">attention_dropout = <span class="number">0.1</span>   <span class="comment"># æ³¨æ„åŠ›dropout</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ¯-è®­ç»ƒç­–ç•¥ä¼˜åŒ–"><a href="#ğŸ¯-è®­ç»ƒç­–ç•¥ä¼˜åŒ–" class="headerlink" title="ğŸ¯ è®­ç»ƒç­–ç•¥ä¼˜åŒ–"></a>ğŸ¯ è®­ç»ƒç­–ç•¥ä¼˜åŒ–</h2><h3 id="1-ç»¼åˆæŸå¤±å‡½æ•°"><a href="#1-ç»¼åˆæŸå¤±å‡½æ•°" class="headerlink" title="1. ç»¼åˆæŸå¤±å‡½æ•°"></a>1. ç»¼åˆæŸå¤±å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">compute_loss</span>(<span class="params">self, model_outputs, targets, speaker_targets, alpha=<span class="number">1.0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ç»¼åˆæŸå¤±å‡½æ•°</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ç»„æˆï¼š</span></span><br><span class="line"><span class="string">    1. ä¸»ä»»åŠ¡æŸå¤±ï¼šæƒ…æ„Ÿåˆ†ç±»äº¤å‰ç†µæŸå¤±</span></span><br><span class="line"><span class="string">    2. å¯¹æŠ—æŸå¤±ï¼šè¯´è¯äººæ··æ·†æŸå¤±</span></span><br><span class="line"><span class="string">    3. æ­£åˆ™åŒ–æŸå¤±ï¼šL2æƒé‡è¡°å‡</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        model_outputs: æ¨¡å‹è¾“å‡ºå­—å…¸</span></span><br><span class="line"><span class="string">        targets: æƒ…æ„Ÿæ ‡ç­¾</span></span><br><span class="line"><span class="string">        speaker_targets: è¯´è¯äººæ ‡ç­¾</span></span><br><span class="line"><span class="string">        alpha: æ¢¯åº¦åè½¬å¼ºåº¦</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        total_loss: æ€»æŸå¤±</span></span><br><span class="line"><span class="string">        loss_dict: å„é¡¹æŸå¤±è¯¦æƒ…</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    emotion_logits = model_outputs[<span class="string">&#x27;emotion_logits&#x27;</span>]</span><br><span class="line">    speaker_logits = model_outputs[<span class="string">&#x27;speaker_logits&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. æƒ…æ„Ÿåˆ†ç±»æŸå¤±ï¼ˆä¸»è¦ä»»åŠ¡ï¼‰</span></span><br><span class="line">    emotion_loss = F.cross_entropy(emotion_logits, targets)</span><br><span class="line">    </span><br><span class="line">    total_loss = emotion_loss</span><br><span class="line">    loss_dict = &#123;<span class="string">&#x27;emotion_loss&#x27;</span>: emotion_loss.item()&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. è¯´è¯äººå¯¹æŠ—æŸå¤±</span></span><br><span class="line">    <span class="keyword">if</span> speaker_logits <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="variable language_">self</span>.args.speaker_adversarial:</span><br><span class="line">        speaker_loss = F.cross_entropy(speaker_logits, speaker_targets)</span><br><span class="line">        total_loss += <span class="variable language_">self</span>.args.adversarial_weight * speaker_loss</span><br><span class="line">        loss_dict[<span class="string">&#x27;speaker_loss&#x27;</span>] = speaker_loss.item()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. æ­£åˆ™åŒ–æŸå¤±</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.args.l2_reg &gt; <span class="number">0</span>:</span><br><span class="line">        l2_loss = <span class="built_in">sum</span>(torch.norm(p, <span class="number">2</span>) <span class="keyword">for</span> p <span class="keyword">in</span> model_outputs.get(<span class="string">&#x27;regularization_params&#x27;</span>, []))</span><br><span class="line">        total_loss += <span class="variable language_">self</span>.args.l2_reg * l2_loss</span><br><span class="line">        loss_dict[<span class="string">&#x27;l2_loss&#x27;</span>] = l2_loss.item() <span class="keyword">if</span> <span class="built_in">isinstance</span>(l2_loss, torch.Tensor) <span class="keyword">else</span> l2_loss</span><br><span class="line">    </span><br><span class="line">    loss_dict[<span class="string">&#x27;total_loss&#x27;</span>] = total_loss.item()</span><br><span class="line">    <span class="keyword">return</span> total_loss, loss_dict</span><br></pre></td></tr></table></figure>

<h3 id="2-åŠ¨æ€å¯¹æŠ—è®­ç»ƒç­–ç•¥"><a href="#2-åŠ¨æ€å¯¹æŠ—è®­ç»ƒç­–ç•¥" class="headerlink" title="2. åŠ¨æ€å¯¹æŠ—è®­ç»ƒç­–ç•¥"></a>2. åŠ¨æ€å¯¹æŠ—è®­ç»ƒç­–ç•¥</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_alpha_schedule</span>(<span class="params">self, epoch, total_epochs</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    åŠ¨æ€è°ƒæ•´æ¢¯åº¦åè½¬å¼ºåº¦</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ç­–ç•¥ï¼š</span></span><br><span class="line"><span class="string">    1. å‰æœŸï¼ˆepoch &lt; 5ï¼‰ï¼šÎ± = 0ï¼Œä¸“æ³¨æƒ…æ„Ÿåˆ†ç±»</span></span><br><span class="line"><span class="string">    2. ä¸­æœŸï¼ˆ5 â‰¤ epoch &lt; total_epochs*0.7ï¼‰ï¼šçº¿æ€§å¢é•¿</span></span><br><span class="line"><span class="string">    3. åæœŸï¼šä¿æŒæœ€å¤§å€¼</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> epoch &lt; <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.0</span>  <span class="comment"># å‰æœŸä¸ä½¿ç”¨å¯¹æŠ—è®­ç»ƒ</span></span><br><span class="line">    <span class="keyword">elif</span> epoch &lt; total_epochs * <span class="number">0.7</span>:</span><br><span class="line">        <span class="comment"># çº¿æ€§å¢é•¿é˜¶æ®µ</span></span><br><span class="line">        progress = (epoch - <span class="number">5</span>) / (total_epochs * <span class="number">0.7</span> - <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">return</span> progress * <span class="variable language_">self</span>.args.max_alpha</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.args.max_alpha  <span class="comment"># åæœŸä¿æŒæœ€å¤§å€¼</span></span><br></pre></td></tr></table></figure>

<h3 id="3-å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥"><a href="#3-å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥" class="headerlink" title="3. å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥"></a>3. å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">create_lr_scheduler</span>(<span class="params">self, optimizer, total_steps</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    åˆ›å»ºå­¦ä¹ ç‡è°ƒåº¦å™¨</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ç­–ç•¥ï¼šä½™å¼¦é€€ç« + é¢„çƒ­</span></span><br><span class="line"><span class="string">    1. é¢„çƒ­é˜¶æ®µï¼šçº¿æ€§å¢é•¿åˆ°åˆå§‹å­¦ä¹ ç‡</span></span><br><span class="line"><span class="string">    2. ä¸»è®­ç»ƒé˜¶æ®µï¼šä½™å¼¦é€€ç«åˆ°æœ€å°å­¦ä¹ ç‡</span></span><br><span class="line"><span class="string">    3. é‡å¯æœºåˆ¶ï¼šå‘¨æœŸæ€§é‡å¯æå‡æ€§èƒ½</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># é¢„çƒ­è°ƒåº¦å™¨</span></span><br><span class="line">    warmup_scheduler = LinearLR(</span><br><span class="line">        optimizer,</span><br><span class="line">        start_factor=<span class="number">0.1</span>,</span><br><span class="line">        end_factor=<span class="number">1.0</span>,</span><br><span class="line">        total_iters=<span class="variable language_">self</span>.args.warmup_steps</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä½™å¼¦é€€ç«è°ƒåº¦å™¨</span></span><br><span class="line">    cosine_scheduler = CosineAnnealingWarmRestarts(</span><br><span class="line">        optimizer,</span><br><span class="line">        T_0=total_steps // <span class="number">4</span>,  <span class="comment"># ç¬¬ä¸€ä¸ªå‘¨æœŸé•¿åº¦</span></span><br><span class="line">        T_mult=<span class="number">2</span>,              <span class="comment"># å‘¨æœŸå€å¢å› å­</span></span><br><span class="line">        eta_min=<span class="variable language_">self</span>.args.min_lr</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç»„åˆè°ƒåº¦å™¨</span></span><br><span class="line">    scheduler = SequentialLR(</span><br><span class="line">        optimizer,</span><br><span class="line">        schedulers=[warmup_scheduler, cosine_scheduler],</span><br><span class="line">        milestones=[<span class="variable language_">self</span>.args.warmup_steps]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> scheduler</span><br></pre></td></tr></table></figure>

<h3 id="4-æ•°æ®å¢å¼ºç­–ç•¥"><a href="#4-æ•°æ®å¢å¼ºç­–ç•¥" class="headerlink" title="4. æ•°æ®å¢å¼ºç­–ç•¥"></a>4. æ•°æ®å¢å¼ºç­–ç•¥</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">apply_augmentation</span>(<span class="params">self, audio_features</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è®­ç»ƒæ—¶æ•°æ®å¢å¼º</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ç­–ç•¥ï¼š</span></span><br><span class="line"><span class="string">    1. é«˜æ–¯å™ªå£°ï¼šå¢åŠ é²æ£’æ€§</span></span><br><span class="line"><span class="string">    2. æ—¶é—´æ‹‰ä¼¸ï¼šæ¨¡æ‹Ÿè¯­é€Ÿå˜åŒ–</span></span><br><span class="line"><span class="string">    3. ç‰¹å¾æ©è”½ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆ</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.is_training:</span><br><span class="line">        <span class="comment"># 1. æ·»åŠ é«˜æ–¯å™ªå£°</span></span><br><span class="line">        <span class="keyword">if</span> torch.rand(<span class="number">1</span>) &lt; <span class="number">0.3</span>:</span><br><span class="line">            noise = torch.randn_like(audio_features) * <span class="variable language_">self</span>.noise_factor</span><br><span class="line">            audio_features = audio_features + noise</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. æ—¶é—´ç»´åº¦æ‹‰ä¼¸ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> torch.rand(<span class="number">1</span>) &lt; <span class="number">0.2</span>:</span><br><span class="line">            stretch_factor = <span class="number">1.0</span> + torch.rand(<span class="number">1</span>) * <span class="variable language_">self</span>.time_stretch_factor * <span class="number">2</span> - <span class="variable language_">self</span>.time_stretch_factor</span><br><span class="line">            <span class="comment"># å®é™…å®ç°éœ€è¦æ’å€¼æ“ä½œ</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 3. ç‰¹å¾æ©è”½</span></span><br><span class="line">        <span class="keyword">if</span> torch.rand(<span class="number">1</span>) &lt; <span class="number">0.2</span>:</span><br><span class="line">            mask_size = <span class="built_in">int</span>(audio_features.size(<span class="number">0</span>) * <span class="number">0.1</span>)</span><br><span class="line">            mask_start = torch.randint(<span class="number">0</span>, <span class="built_in">max</span>(<span class="number">1</span>, audio_features.size(<span class="number">0</span>) - mask_size), (<span class="number">1</span>,))</span><br><span class="line">            audio_features[mask_start:mask_start + mask_size] *= <span class="number">0.1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> audio_features</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ“Š-æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–"><a href="#ğŸ“Š-æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–" class="headerlink" title="ğŸ“Š æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–"></a>ğŸ“Š æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–</h2><h3 id="1-è®­ç»ƒç›‘æ§æŒ‡æ ‡"><a href="#1-è®­ç»ƒç›‘æ§æŒ‡æ ‡" class="headerlink" title="1. è®­ç»ƒç›‘æ§æŒ‡æ ‡"></a>1. è®­ç»ƒç›‘æ§æŒ‡æ ‡</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TrainingMonitor</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®­ç»ƒè¿‡ç¨‹ç›‘æ§å™¨&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.metrics = &#123;</span><br><span class="line">            <span class="string">&#x27;train_loss&#x27;</span>: [],</span><br><span class="line">            <span class="string">&#x27;val_loss&#x27;</span>: [],</span><br><span class="line">            <span class="string">&#x27;train_acc&#x27;</span>: [],</span><br><span class="line">            <span class="string">&#x27;val_acc&#x27;</span>: [],</span><br><span class="line">            <span class="string">&#x27;train_f1&#x27;</span>: [],</span><br><span class="line">            <span class="string">&#x27;val_f1&#x27;</span>: [],</span><br><span class="line">            <span class="string">&#x27;learning_rate&#x27;</span>: [],</span><br><span class="line">            <span class="string">&#x27;alpha_values&#x27;</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_metrics</span>(<span class="params">self, epoch, train_metrics, val_metrics, lr, alpha</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ›´æ–°è®­ç»ƒæŒ‡æ ‡&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.metrics[<span class="string">&#x27;train_loss&#x27;</span>].append(train_metrics[<span class="string">&#x27;loss&#x27;</span>])</span><br><span class="line">        <span class="variable language_">self</span>.metrics[<span class="string">&#x27;val_loss&#x27;</span>].append(val_metrics[<span class="string">&#x27;loss&#x27;</span>])</span><br><span class="line">        <span class="variable language_">self</span>.metrics[<span class="string">&#x27;train_acc&#x27;</span>].append(train_metrics[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line">        <span class="variable language_">self</span>.metrics[<span class="string">&#x27;val_acc&#x27;</span>].append(val_metrics[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line">        <span class="variable language_">self</span>.metrics[<span class="string">&#x27;train_f1&#x27;</span>].append(train_metrics[<span class="string">&#x27;f1_score&#x27;</span>])</span><br><span class="line">        <span class="variable language_">self</span>.metrics[<span class="string">&#x27;val_f1&#x27;</span>].append(val_metrics[<span class="string">&#x27;f1_score&#x27;</span>])</span><br><span class="line">        <span class="variable language_">self</span>.metrics[<span class="string">&#x27;learning_rate&#x27;</span>].append(lr)</span><br><span class="line">        <span class="variable language_">self</span>.metrics[<span class="string">&#x27;alpha_values&#x27;</span>].append(alpha)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">plot_training_curves</span>(<span class="params">self, save_path</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç»˜åˆ¶è®­ç»ƒæ›²çº¿&quot;&quot;&quot;</span></span><br><span class="line">        fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">3</span>, figsize=(<span class="number">18</span>, <span class="number">12</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æŸå¤±æ›²çº¿</span></span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">0</span>].plot(<span class="variable language_">self</span>.metrics[<span class="string">&#x27;train_loss&#x27;</span>], label=<span class="string">&#x27;Train Loss&#x27;</span>, color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">0</span>].plot(<span class="variable language_">self</span>.metrics[<span class="string">&#x27;val_loss&#x27;</span>], label=<span class="string">&#x27;Val Loss&#x27;</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">0</span>].set_title(<span class="string">&#x27;Loss Curves&#x27;</span>)</span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">0</span>].legend()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å‡†ç¡®ç‡æ›²çº¿</span></span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">1</span>].plot(<span class="variable language_">self</span>.metrics[<span class="string">&#x27;train_acc&#x27;</span>], label=<span class="string">&#x27;Train Acc&#x27;</span>, color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">1</span>].plot(<span class="variable language_">self</span>.metrics[<span class="string">&#x27;val_acc&#x27;</span>], label=<span class="string">&#x27;Val Acc&#x27;</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">1</span>].set_title(<span class="string">&#x27;Accuracy Curves&#x27;</span>)</span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">1</span>].legend()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># F1åˆ†æ•°æ›²çº¿</span></span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">2</span>].plot(<span class="variable language_">self</span>.metrics[<span class="string">&#x27;train_f1&#x27;</span>], label=<span class="string">&#x27;Train F1&#x27;</span>, color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">2</span>].plot(<span class="variable language_">self</span>.metrics[<span class="string">&#x27;val_f1&#x27;</span>], label=<span class="string">&#x27;Val F1&#x27;</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">2</span>].set_title(<span class="string">&#x27;F1 Score Curves&#x27;</span>)</span><br><span class="line">        axes[<span class="number">0</span>, <span class="number">2</span>].legend()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å­¦ä¹ ç‡å˜åŒ–</span></span><br><span class="line">        axes[<span class="number">1</span>, <span class="number">0</span>].plot(<span class="variable language_">self</span>.metrics[<span class="string">&#x27;learning_rate&#x27;</span>], color=<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">        axes[<span class="number">1</span>, <span class="number">0</span>].set_title(<span class="string">&#x27;Learning Rate Schedule&#x27;</span>)</span><br><span class="line">        axes[<span class="number">1</span>, <span class="number">0</span>].set_yscale(<span class="string">&#x27;log&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Alphaå€¼å˜åŒ–</span></span><br><span class="line">        axes[<span class="number">1</span>, <span class="number">1</span>].plot(<span class="variable language_">self</span>.metrics[<span class="string">&#x27;alpha_values&#x27;</span>], color=<span class="string">&#x27;orange&#x27;</span>)</span><br><span class="line">        axes[<span class="number">1</span>, <span class="number">1</span>].set_title(<span class="string">&#x27;Adversarial Alpha Schedule&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># éªŒè¯æŸå¤±æ”¾å¤§å›¾</span></span><br><span class="line">        axes[<span class="number">1</span>, <span class="number">2</span>].plot(<span class="variable language_">self</span>.metrics[<span class="string">&#x27;val_loss&#x27;</span>], color=<span class="string">&#x27;red&#x27;</span>, linewidth=<span class="number">2</span>)</span><br><span class="line">        axes[<span class="number">1</span>, <span class="number">2</span>].set_title(<span class="string">&#x27;Validation Loss (Detailed)&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        plt.tight_layout()</span><br><span class="line">        plt.savefig(save_path, dpi=<span class="number">300</span>, bbox_inches=<span class="string">&#x27;tight&#x27;</span>)</span><br><span class="line">        plt.close()</span><br></pre></td></tr></table></figure>

<h3 id="2-è·¨è¯´è¯äººæ€§èƒ½åˆ†æ"><a href="#2-è·¨è¯´è¯äººæ€§èƒ½åˆ†æ" class="headerlink" title="2. è·¨è¯´è¯äººæ€§èƒ½åˆ†æ"></a>2. è·¨è¯´è¯äººæ€§èƒ½åˆ†æ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_speaker_performance</span>(<span class="params">self, model, test_loader, save_dir</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è·¨è¯´è¯äººæ€§èƒ½åˆ†æ</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    åˆ†æå†…å®¹ï¼š</span></span><br><span class="line"><span class="string">    1. å„è¯´è¯äººå‡†ç¡®ç‡å¯¹æ¯”</span></span><br><span class="line"><span class="string">    2. æ€§èƒ½æ–¹å·®åˆ†æ</span></span><br><span class="line"><span class="string">    3. æ€§åˆ«å·®å¼‚åˆ†æ</span></span><br><span class="line"><span class="string">    4. ä¼šè¯å·®å¼‚åˆ†æ</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    speaker_results = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> batch <span class="keyword">in</span> test_loader:</span><br><span class="line">            features = batch[<span class="string">&#x27;audio_features&#x27;</span>].to(<span class="variable language_">self</span>.device)</span><br><span class="line">            labels = batch[<span class="string">&#x27;emotion_label&#x27;</span>].to(<span class="variable language_">self</span>.device)</span><br><span class="line">            speakers = batch[<span class="string">&#x27;speaker&#x27;</span>]</span><br><span class="line">            </span><br><span class="line">            outputs = model(features)</span><br><span class="line">            predictions = torch.argmax(outputs[<span class="string">&#x27;emotion_logits&#x27;</span>], dim=<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> pred, label, speaker <span class="keyword">in</span> <span class="built_in">zip</span>(predictions.cpu(), labels.cpu(), speakers):</span><br><span class="line">                speaker_results[speaker].append(&#123;</span><br><span class="line">                    <span class="string">&#x27;prediction&#x27;</span>: pred.item(),</span><br><span class="line">                    <span class="string">&#x27;label&#x27;</span>: label.item(),</span><br><span class="line">                    <span class="string">&#x27;correct&#x27;</span>: pred.item() == label.item()</span><br><span class="line">                &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®¡ç®—å„è¯´è¯äººæ€§èƒ½</span></span><br><span class="line">    speaker_metrics = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> speaker, results <span class="keyword">in</span> speaker_results.items():</span><br><span class="line">        correct = <span class="built_in">sum</span>(r[<span class="string">&#x27;correct&#x27;</span>] <span class="keyword">for</span> r <span class="keyword">in</span> results)</span><br><span class="line">        total = <span class="built_in">len</span>(results)</span><br><span class="line">        accuracy = correct / total <span class="keyword">if</span> total &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è®¡ç®—F1åˆ†æ•°</span></span><br><span class="line">        y_true = [r[<span class="string">&#x27;label&#x27;</span>] <span class="keyword">for</span> r <span class="keyword">in</span> results]</span><br><span class="line">        y_pred = [r[<span class="string">&#x27;prediction&#x27;</span>] <span class="keyword">for</span> r <span class="keyword">in</span> results]</span><br><span class="line">        f1 = f1_score(y_true, y_pred, average=<span class="string">&#x27;weighted&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        speaker_metrics[speaker] = &#123;</span><br><span class="line">            <span class="string">&#x27;accuracy&#x27;</span>: accuracy,</span><br><span class="line">            <span class="string">&#x27;f1_score&#x27;</span>: f1,</span><br><span class="line">            <span class="string">&#x27;total_samples&#x27;</span>: total</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¯è§†åŒ–ç»“æœ</span></span><br><span class="line">    <span class="variable language_">self</span>.plot_speaker_performance(speaker_metrics, save_dir)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> speaker_metrics</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">plot_speaker_performance</span>(<span class="params">self, speaker_metrics, save_dir</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç»˜åˆ¶è¯´è¯äººæ€§èƒ½å¯¹æ¯”å›¾&quot;&quot;&quot;</span></span><br><span class="line">    speakers = <span class="built_in">list</span>(speaker_metrics.keys())</span><br><span class="line">    accuracies = [speaker_metrics[s][<span class="string">&#x27;accuracy&#x27;</span>] <span class="keyword">for</span> s <span class="keyword">in</span> speakers]</span><br><span class="line">    f1_scores = [speaker_metrics[s][<span class="string">&#x27;f1_score&#x27;</span>] <span class="keyword">for</span> s <span class="keyword">in</span> speakers]</span><br><span class="line">    </span><br><span class="line">    fig, (ax1, ax2) = plt.subplots(<span class="number">1</span>, <span class="number">2</span>, figsize=(<span class="number">15</span>, <span class="number">6</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‡†ç¡®ç‡å¯¹æ¯”</span></span><br><span class="line">    bars1 = ax1.bar(speakers, accuracies, color=<span class="string">&#x27;skyblue&#x27;</span>, alpha=<span class="number">0.7</span>)</span><br><span class="line">    ax1.set_title(<span class="string">&#x27;Speaker-wise Accuracy Comparison&#x27;</span>)</span><br><span class="line">    ax1.set_ylabel(<span class="string">&#x27;Accuracy&#x27;</span>)</span><br><span class="line">    ax1.set_ylim(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ·»åŠ æ•°å€¼æ ‡ç­¾</span></span><br><span class="line">    <span class="keyword">for</span> bar, acc <span class="keyword">in</span> <span class="built_in">zip</span>(bars1, accuracies):</span><br><span class="line">        ax1.text(bar.get_x() + bar.get_width()/<span class="number">2</span>, bar.get_height() + <span class="number">0.01</span>, </span><br><span class="line">                <span class="string">f&#x27;<span class="subst">&#123;acc:<span class="number">.3</span>f&#125;</span>&#x27;</span>, ha=<span class="string">&#x27;center&#x27;</span>, va=<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># F1åˆ†æ•°å¯¹æ¯”</span></span><br><span class="line">    bars2 = ax2.bar(speakers, f1_scores, color=<span class="string">&#x27;lightcoral&#x27;</span>, alpha=<span class="number">0.7</span>)</span><br><span class="line">    ax2.set_title(<span class="string">&#x27;Speaker-wise F1 Score Comparison&#x27;</span>)</span><br><span class="line">    ax2.set_ylabel(<span class="string">&#x27;F1 Score&#x27;</span>)</span><br><span class="line">    ax2.set_ylim(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ·»åŠ æ•°å€¼æ ‡ç­¾</span></span><br><span class="line">    <span class="keyword">for</span> bar, f1 <span class="keyword">in</span> <span class="built_in">zip</span>(bars2, f1_scores):</span><br><span class="line">        ax2.text(bar.get_x() + bar.get_width()/<span class="number">2</span>, bar.get_height() + <span class="number">0.01</span>, </span><br><span class="line">                <span class="string">f&#x27;<span class="subst">&#123;f1:<span class="number">.3</span>f&#125;</span>&#x27;</span>, ha=<span class="string">&#x27;center&#x27;</span>, va=<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    plt.tight_layout()</span><br><span class="line">    plt.savefig(<span class="string">f&#x27;<span class="subst">&#123;save_dir&#125;</span>/speaker_performance_comparison.png&#x27;</span>, dpi=<span class="number">300</span>, bbox_inches=<span class="string">&#x27;tight&#x27;</span>)</span><br><span class="line">    plt.close()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ¯-ä½¿ç”¨ç¤ºä¾‹"><a href="#ğŸ¯-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ğŸ¯ ä½¿ç”¨ç¤ºä¾‹"></a>ğŸ¯ ä½¿ç”¨ç¤ºä¾‹</h2><h3 id="1-æ¨¡å‹åˆå§‹åŒ–"><a href="#1-æ¨¡å‹åˆå§‹åŒ–" class="headerlink" title="1. æ¨¡å‹åˆå§‹åŒ–"></a>1. æ¨¡å‹åˆå§‹åŒ–</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå‚æ•°å¯¹è±¡</span></span><br><span class="line">args = argparse.Namespace(</span><br><span class="line">    input_size=<span class="number">768</span>,</span><br><span class="line">    hidden_size=<span class="number">256</span>,</span><br><span class="line">    output_size=<span class="number">4</span>,</span><br><span class="line">    dia_layers=<span class="number">3</span>,</span><br><span class="line">    dropout=<span class="number">0.3</span>,</span><br><span class="line">    attention=<span class="literal">True</span>,</span><br><span class="line">    speaker_norm=<span class="literal">True</span>,</span><br><span class="line">    speaker_adversarial=<span class="literal">True</span>,</span><br><span class="line">    adversarial_weight=<span class="number">0.05</span>,</span><br><span class="line">    max_alpha=<span class="number">1.0</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æ¨¡å‹</span></span><br><span class="line">model = EnhancedGRUModel(</span><br><span class="line">    input_size=args.input_size,</span><br><span class="line">    hidden_size=args.hidden_size,</span><br><span class="line">    output_size=args.output_size,</span><br><span class="line">    args=args</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ¨¡å‹å‚æ•°é‡: <span class="subst">&#123;<span class="built_in">sum</span>(p.numel() <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters()):,&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-è®­ç»ƒæµç¨‹"><a href="#2-è®­ç»ƒæµç¨‹" class="headerlink" title="2. è®­ç»ƒæµç¨‹"></a>2. è®­ç»ƒæµç¨‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè®­ç»ƒå™¨</span></span><br><span class="line">trainer = AdvancedTrainer(args)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">best_model_path = trainer.train_model(</span><br><span class="line">    model=model,</span><br><span class="line">    train_loader=train_loader,</span><br><span class="line">    val_loader=val_loader,</span><br><span class="line">    save_dir=<span class="string">&#x27;./experiments&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æœ€ä½³æ¨¡å‹ä¿å­˜åœ¨: <span class="subst">&#123;best_model_path&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-æ€§èƒ½è¯„ä¼°"><a href="#3-æ€§èƒ½è¯„ä¼°" class="headerlink" title="3. æ€§èƒ½è¯„ä¼°"></a>3. æ€§èƒ½è¯„ä¼°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½æœ€ä½³æ¨¡å‹</span></span><br><span class="line">model.load_state_dict(torch.load(best_model_path))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯„ä¼°è·¨è¯´è¯äººæ€§èƒ½</span></span><br><span class="line">evaluator = SpeakerIndependenceEvaluator(model, args)</span><br><span class="line">results = evaluator.evaluate(test_loader, save_dir=<span class="string">&#x27;./evaluation_results&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è·¨è¯´è¯äººæ€§èƒ½è¯„ä¼°å®Œæˆï¼&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ€»ä½“å‡†ç¡®ç‡: <span class="subst">&#123;results[<span class="string">&#x27;overall_accuracy&#x27;</span>]:<span class="number">.4</span>f&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å¹³å‡F1åˆ†æ•°: <span class="subst">&#123;results[<span class="string">&#x27;average_f1&#x27;</span>]:<span class="number">.4</span>f&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ€§èƒ½æ ‡å‡†å·®: <span class="subst">&#123;results[<span class="string">&#x27;performance_std&#x27;</span>]:<span class="number">.4</span>f&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ“ˆ-é¢„æœŸæ”¹è¿›æ•ˆæœ"><a href="#ğŸ“ˆ-é¢„æœŸæ”¹è¿›æ•ˆæœ" class="headerlink" title="ğŸ“ˆ é¢„æœŸæ”¹è¿›æ•ˆæœ"></a>ğŸ“ˆ é¢„æœŸæ”¹è¿›æ•ˆæœ</h2><h3 id="æ€§èƒ½æå‡é¢„æœŸ"><a href="#æ€§èƒ½æå‡é¢„æœŸ" class="headerlink" title="æ€§èƒ½æå‡é¢„æœŸ"></a>æ€§èƒ½æå‡é¢„æœŸ</h3><table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>åŸå§‹æ¨¡å‹</th>
<th>å¢å¼ºæ¨¡å‹</th>
<th>æ”¹è¿›å¹…åº¦</th>
</tr>
</thead>
<tbody><tr>
<td>æ€»ä½“å‡†ç¡®ç‡</td>
<td>65-70%</td>
<td>75-80%</td>
<td>+10-15%</td>
</tr>
<tr>
<td>è·¨è¯´è¯äººF1</td>
<td>0.62-0.67</td>
<td>0.72-0.77</td>
<td>+0.10-0.15</td>
</tr>
<tr>
<td>æ€§èƒ½æ–¹å·®</td>
<td>0.08-0.12</td>
<td>0.04-0.08</td>
<td>-50%â†“</td>
</tr>
<tr>
<td>æ”¶æ•›é€Ÿåº¦</td>
<td>30-40è½®</td>
<td>20-25è½®</td>
<td>å¿«25-50%</td>
</tr>
</tbody></table>
<h3 id="æŠ€æœ¯ä¼˜åŠ¿"><a href="#æŠ€æœ¯ä¼˜åŠ¿" class="headerlink" title="æŠ€æœ¯ä¼˜åŠ¿"></a>æŠ€æœ¯ä¼˜åŠ¿</h3><ol>
<li><strong>ğŸ¯ è¯´è¯äººæ— å…³æ€§</strong>ï¼šAdaINå½’ä¸€åŒ– + å¯¹æŠ—è®­ç»ƒæ˜¾è‘—å‡å°‘è¯´è¯äººåè§</li>
<li><strong>ğŸš€ è®­ç»ƒæ•ˆç‡</strong>ï¼šåŠ¨æ€å­¦ä¹ ç‡è°ƒåº¦ + æ—©åœæœºåˆ¶åŠ é€Ÿæ”¶æ•›</li>
<li><strong>ğŸ’ª æ¨¡å‹é²æ£’æ€§</strong>ï¼šå¤šç§æ­£åˆ™åŒ–æŠ€æœ¯æå‡æ³›åŒ–èƒ½åŠ›</li>
<li><strong>ğŸ“Š å…¨é¢ç›‘æ§</strong>ï¼šå®æ—¶å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹å’Œæ€§èƒ½æŒ‡æ ‡</li>
</ol>
<hr>
<h2 id="ğŸ”§-æ•…éšœæ’é™¤"><a href="#ğŸ”§-æ•…éšœæ’é™¤" class="headerlink" title="ğŸ”§ æ•…éšœæ’é™¤"></a>ğŸ”§ æ•…éšœæ’é™¤</h2><h3 id="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h3><ol>
<li><p><strong>å†…å­˜ä¸è¶³</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡å°‘æ‰¹æ¬¡å¤§å°</span></span><br><span class="line">args.batch_size = <span class="number">16</span>  <span class="comment"># ä»32é™åˆ°16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨æ¢¯åº¦ç´¯ç§¯</span></span><br><span class="line">args.gradient_accumulation_steps = <span class="number">2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è®­ç»ƒä¸ç¨³å®š</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é™ä½å­¦ä¹ ç‡</span></span><br><span class="line">args.learning_rate = <span class="number">0.0001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ æ¢¯åº¦è£å‰ª</span></span><br><span class="line">args.max_grad_norm = <span class="number">0.5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è¿‡æ‹Ÿåˆä¸¥é‡</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¢åŠ Dropout</span></span><br><span class="line">args.dropout = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ L2æ­£åˆ™åŒ–</span></span><br><span class="line">args.l2_reg = <span class="number">1e-4</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¯¹æŠ—è®­ç»ƒä¸æ”¶æ•›</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é™ä½å¯¹æŠ—æƒé‡</span></span><br><span class="line">args.adversarial_weight = <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å»¶è¿Ÿå¯¹æŠ—è®­ç»ƒå¼€å§‹æ—¶é—´</span></span><br><span class="line">args.adversarial_start_epoch = <span class="number">10</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="ğŸ“š-å‚è€ƒæ–‡çŒ®"><a href="#ğŸ“š-å‚è€ƒæ–‡çŒ®" class="headerlink" title="ğŸ“š å‚è€ƒæ–‡çŒ®"></a>ğŸ“š å‚è€ƒæ–‡çŒ®</h2><ol>
<li><strong>AdaIN</strong>: Huang, X., &amp; Belongie, S. (2017). Arbitrary style transfer in real-time with adaptive instance normalization.</li>
<li><strong>Gradient Reversal</strong>: Ganin, Y., &amp; Lempitsky, V. (2015). Unsupervised domain adaptation by backpropagation.</li>
<li><strong>Multi-Head Attention</strong>: Vaswani, A., et al. (2017). Attention is all you need.</li>
<li><strong>HuBERT</strong>: Hsu, W. N., et al. (2021). HuBERT: Self-supervised speech representation learning by masked prediction.</li>
</ol>
<hr>
<p><em>ğŸ“ æ–‡æ¡£ç‰ˆæœ¬: v2.0 | æ›´æ–°æ—¥æœŸ: 2024-09-26 | ä½œè€…: AI Assistant</em></p>
<hr>
<h1 id="IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿæ·±åº¦æºç è§£æ"><a href="#IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿæ·±åº¦æºç è§£æ" class="headerlink" title="IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿæ·±åº¦æºç è§£æ"></a>IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿæ·±åº¦æºç è§£æ</h1><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ol>
<li><a href="#1-%E9%A1%B9%E7%9B%AE%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E4%B8%8E%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86">é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†</a></li>
<li><a href="#2-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E5%8A%9F%E8%83%BD%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90">æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ</a></li>
<li><a href="#3-%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%B5%81%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90">å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ</a></li>
<li><a href="#4-%E5%85%B3%E9%94%AE%E5%8F%82%E6%95%B0%E5%90%AB%E4%B9%89%E4%B8%8E%E6%80%A7%E8%83%BD%E5%BD%B1%E5%93%8D">å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“</a></li>
<li><a href="#5-%E6%A8%A1%E5%9E%8B%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3">æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£</a></li>
<li><a href="#6-%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8A%BF%E4%B8%8E%E6%8A%80%E6%9C%AF%E5%88%9B%E6%96%B0">ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°</a></li>
</ol>
<hr>
<h2 id="1-é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†"><a href="#1-é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†" class="headerlink" title="1. é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†"></a>1. é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†</h2><h3 id="1-1-ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ"><a href="#1-1-ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ" class="headerlink" title="1.1 ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ"></a>1.1 ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ</h3><p>è¯¥IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿé‡‡ç”¨ç«¯åˆ°ç«¯çš„æ·±åº¦å­¦ä¹ æ¶æ„ï¼Œå®ç°ä»åŸå§‹éŸ³é¢‘ä¿¡å·åˆ°æƒ…æ„Ÿç±»åˆ«çš„ç›´æ¥æ˜ å°„ã€‚æ•´ä½“æ•°æ®æµéµå¾ªç°ä»£è¯­éŸ³å¤„ç†çš„æœ€ä½³å®è·µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸå§‹éŸ³é¢‘ â†’ é¢„å¤„ç†æ ‡å‡†åŒ– â†’ HuBERTç‰¹å¾ç¼–ç  â†’ åŒå‘GRUåºåˆ—å»ºæ¨¡ â†’ æ³¨æ„åŠ›æœºåˆ¶å¢å¼º â†’ å…¨å±€æ± åŒ– â†’ åˆ†ç±»è¾“å‡º</span><br></pre></td></tr></table></figure>

<p>è¿™ç§è®¾è®¡å……åˆ†åˆ©ç”¨äº†è‡ªç›‘ç£é¢„è®­ç»ƒæ¨¡å‹çš„å¼ºå¤§ç‰¹å¾æå–èƒ½åŠ›ï¼Œç»“åˆå¾ªç¯ç¥ç»ç½‘ç»œå¯¹æ—¶åºä¿¡æ¯çš„ç²¾ç¡®å»ºæ¨¡ï¼Œæœ€ç»ˆé€šè¿‡æ³¨æ„åŠ›æœºåˆ¶å®ç°å¯¹æƒ…æ„Ÿå…³é”®ä¿¡æ¯çš„åŠ¨æ€èšç„¦ã€‚</p>
<h3 id="1-2-æ ¸å¿ƒæ¨¡å—åˆ’åˆ†"><a href="#1-2-æ ¸å¿ƒæ¨¡å—åˆ’åˆ†" class="headerlink" title="1.2 æ ¸å¿ƒæ¨¡å—åˆ’åˆ†"></a>1.2 æ ¸å¿ƒæ¨¡å—åˆ’åˆ†</h3><p><strong>æ•°æ®é¢„å¤„ç†æ¨¡å—</strong> (<code>Data_prepocessing.py</code>)</p>
<ul>
<li><strong>åŠŸèƒ½èŒè´£</strong>ï¼šè´Ÿè´£IEMOCAPæ•°æ®é›†çš„æ ‡å‡†åŒ–å¤„ç†ï¼ŒåŒ…æ‹¬éŸ³é¢‘é•¿åº¦ç»Ÿä¸€ã€é‡‡æ ·ç‡æ ‡å‡†åŒ–ã€æƒ…æ„Ÿæ ‡ç­¾æ˜ å°„</li>
<li><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šç¡®ä¿æ¨¡å‹è¾“å…¥çš„ä¸€è‡´æ€§ï¼Œä¸ºåç»­ç‰¹å¾æå–æä¾›æ ‡å‡†åŒ–çš„æ•°æ®åŸºç¡€</li>
<li><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼šé‡‡ç”¨å›ºå®š3ç§’æ—¶é•¿ç­–ç•¥ï¼Œå¹³è¡¡ä¿¡æ¯ä¿ç•™ä¸è®¡ç®—æ•ˆç‡</li>
</ul>
<p><strong>æ¨¡å‹æ¶æ„æ¨¡å—</strong> (<code>models/GRU.py</code>)</p>
<ul>
<li><strong>SpeechRecognitionModel</strong>ï¼šä¸»æ¨¡å‹å®¹å™¨ï¼Œæ•´åˆHuBERTç‰¹å¾æå–å™¨ä¸GRUåºåˆ—å»ºæ¨¡å™¨</li>
<li><strong>GRUModel</strong>ï¼šåºåˆ—å»ºæ¨¡æ ¸å¿ƒï¼Œè´Ÿè´£æ—¶åºç‰¹å¾çš„æ·±åº¦å­¦ä¹ ä¸æƒ…æ„Ÿåˆ†ç±»</li>
<li><strong>MatchingAttention</strong>ï¼šæ³¨æ„åŠ›æœºåˆ¶å®ç°ï¼Œæä¾›åŠ¨æ€ç‰¹å¾åŠ æƒèƒ½åŠ›</li>
</ul>
<p><strong>è®­ç»ƒä¸éªŒè¯æ¨¡å—</strong> (<code>train.py</code>)</p>
<ul>
<li><strong>äº¤å‰éªŒè¯ç­–ç•¥</strong>ï¼šé‡‡ç”¨5æŠ˜äº¤å‰éªŒè¯ï¼Œç¡®ä¿æ¨¡å‹æ³›åŒ–èƒ½åŠ›çš„å¯é è¯„ä¼°</li>
<li><strong>ä¼˜åŒ–ç­–ç•¥</strong>ï¼šä½¿ç”¨AdamWä¼˜åŒ–å™¨ï¼Œç»“åˆé€‚å½“çš„å­¦ä¹ ç‡è°ƒåº¦</li>
<li><strong>æ€§èƒ½è¯„ä¼°</strong>ï¼šå¤šæŒ‡æ ‡ç»¼åˆè¯„ä¼°ï¼ŒåŒ…æ‹¬å‡†ç¡®ç‡ã€å¬å›ç‡ã€F1åˆ†æ•°</li>
</ul>
<p><strong>æ¨ç†ä¸åº”ç”¨æ¨¡å—</strong> (<code>DEMO.py</code>, <code>GUIæƒ…æ„Ÿè¯†åˆ«2.py</code>)</p>
<ul>
<li><strong>å•æ ·æœ¬æ¨ç†</strong>ï¼šæä¾›ç®€æ´çš„æ¨¡å‹æµ‹è¯•æ¥å£</li>
<li><strong>å®æ—¶éŸ³é¢‘å¤„ç†</strong>ï¼šæ”¯æŒéº¦å…‹é£å®æ—¶å½•éŸ³ä¸æƒ…æ„Ÿè¯†åˆ«</li>
<li><strong>ç”¨æˆ·ç•Œé¢</strong>ï¼šå®Œæ•´çš„PyQt5å›¾å½¢ç•Œé¢ï¼Œæä¾›ç›´è§‚çš„äº¤äº’ä½“éªŒ</li>
</ul>
<hr>
<h2 id="2-æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ"><a href="#2-æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ" class="headerlink" title="2. æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ"></a>2. æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ</h2><h3 id="2-1-HubertModelè¯­éŸ³ç‰¹å¾ç¼–ç å™¨"><a href="#2-1-HubertModelè¯­éŸ³ç‰¹å¾ç¼–ç å™¨" class="headerlink" title="2.1 HubertModelè¯­éŸ³ç‰¹å¾ç¼–ç å™¨"></a>2.1 HubertModelè¯­éŸ³ç‰¹å¾ç¼–ç å™¨</h3><h4 id="2-1-1-æ¨¡å‹é€‰æ‹©çš„æ·±å±‚è€ƒé‡"><a href="#2-1-1-æ¨¡å‹é€‰æ‹©çš„æ·±å±‚è€ƒé‡" class="headerlink" title="2.1.1 æ¨¡å‹é€‰æ‹©çš„æ·±å±‚è€ƒé‡"></a>2.1.1 æ¨¡å‹é€‰æ‹©çš„æ·±å±‚è€ƒé‡</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">self</span>.feature_extractor = HubertModel.from_pretrained(<span class="string">&quot;facebook/hubert-base-ls960&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>HuBERT (Hidden-Unit BERT) çš„é€‰æ‹©ä½“ç°äº†å¯¹è¯­éŸ³è¡¨ç¤ºå­¦ä¹ å‰æ²¿æŠ€æœ¯çš„æ·±åˆ»ç†è§£ï¼š</p>
<p><strong>è‡ªç›‘ç£å­¦ä¹ ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>HuBERTé€šè¿‡æ©ç é¢„æµ‹ä»»åŠ¡åœ¨å¤§è§„æ¨¡æ— æ ‡æ³¨è¯­éŸ³æ•°æ®ä¸Šé¢„è®­ç»ƒï¼Œå­¦ä¹ åˆ°äº†ä¸°å¯Œçš„è¯­éŸ³è¡¨ç¤º</li>
<li>ç›¸æ¯”ä¼ ç»Ÿçš„MFCCã€Melé¢‘è°±ç­‰æ‰‹å·¥ç‰¹å¾ï¼ŒHuBERTèƒ½å¤Ÿè‡ªåŠ¨å‘ç°è¯­éŸ³ä¸­çš„å±‚æ¬¡åŒ–æ¨¡å¼</li>
<li>é¢„è®­ç»ƒåœ¨960å°æ—¶LibriSpeechæ•°æ®ä¸Šè¿›è¡Œï¼Œæ¶µç›–äº†å¤šæ ·åŒ–çš„è¯­éŸ³æ¨¡å¼å’Œå£°å­¦ç¯å¢ƒ</li>
</ul>
<p><strong>åˆ†å±‚ç‰¹å¾è¡¨ç¤º</strong>ï¼š</p>
<ul>
<li>åº•å±‚ï¼šæ•è·éŸ³ç´ çº§åˆ«çš„å£°å­¦ç‰¹å¾ï¼Œå¦‚å…±æŒ¯å³°ã€åŸºé¢‘å˜åŒ–</li>
<li>ä¸­å±‚ï¼šå»ºæ¨¡éŸ³èŠ‚å’Œè¯æ±‡çº§åˆ«çš„è¯­éŸ³æ¨¡å¼</li>
<li>é«˜å±‚ï¼šç¼–ç è¯­ä¹‰å’ŒéŸµå¾‹ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯¹æƒ…æ„Ÿè¯†åˆ«è‡³å…³é‡è¦</li>
</ul>
<p><strong>768ç»´ç‰¹å¾å‘é‡çš„ä¿¡æ¯å¯†åº¦</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªæ—¶é—´æ­¥è¾“å‡º768ç»´å¯†é›†å‘é‡ï¼Œç›¸æ¯”ä¼ ç»Ÿç‰¹å¾ï¼ˆå¦‚39ç»´MFCCï¼‰å…·æœ‰æ›´å¼ºçš„è¡¨è¾¾èƒ½åŠ›</li>
<li>é«˜ç»´ç‰¹å¾ç©ºé—´èƒ½å¤Ÿæ›´ç²¾ç»†åœ°åŒºåˆ†ä¸åŒæƒ…æ„ŸçŠ¶æ€ä¸‹çš„è¯­éŸ³å˜åŒ–</li>
</ul>
<h4 id="2-1-2-ç‰¹å¾æå–çš„æŠ€æœ¯å®ç°"><a href="#2-1-2-ç‰¹å¾æå–çš„æŠ€æœ¯å®ç°" class="headerlink" title="2.1.2 ç‰¹å¾æå–çš„æŠ€æœ¯å®ç°"></a>2.1.2 ç‰¹å¾æå–çš„æŠ€æœ¯å®ç°</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, input_waveform</span>):</span><br><span class="line">    features = <span class="variable language_">self</span>.feature_extractor(input_waveform).last_hidden_state  <span class="comment"># [batch, seq_len, 768]</span></span><br><span class="line">    logits = <span class="variable language_">self</span>.Utterance_net(features)</span><br><span class="line">    <span class="keyword">return</span> logits, features</span><br></pre></td></tr></table></figure>

<p><strong>å¤„ç†æµç¨‹çš„æŠ€æœ¯ç»†èŠ‚</strong>ï¼š</p>
<ol>
<li><p><strong>å·ç§¯ç‰¹å¾æå–</strong>ï¼š</p>
<ul>
<li>HuBERTé¦–å…ˆé€šè¿‡7å±‚1Då·ç§¯ç½‘ç»œå¤„ç†åŸå§‹æ³¢å½¢</li>
<li>æ¯å±‚å·ç§¯é€æ­¥é™ä½æ—¶é—´åˆ†è¾¨ç‡ï¼Œæé«˜ç‰¹å¾æŠ½è±¡å±‚æ¬¡</li>
<li>å·ç§¯æ ¸è®¾è®¡è€ƒè™‘äº†è¯­éŸ³ä¿¡å·çš„æ—¶é¢‘ç‰¹æ€§</li>
</ul>
</li>
<li><p><strong>Transformerç¼–ç </strong>ï¼š</p>
<ul>
<li>12å±‚Transformerç¼–ç å™¨è¿›è¡Œåºåˆ—å»ºæ¨¡</li>
<li>è‡ªæ³¨æ„åŠ›æœºåˆ¶æ•è·é•¿è·ç¦»ä¾èµ–å…³ç³»</li>
<li>ä½ç½®ç¼–ç ä¿æŒæ—¶åºä¿¡æ¯çš„å®Œæ•´æ€§</li>
</ul>
</li>
<li><p><strong>ç‰¹å¾é€‰æ‹©ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><code>last_hidden_state</code>æä¾›æœ€é«˜å±‚çš„è¯­ä¹‰è¡¨ç¤º</li>
<li>è¿™ä¸€å±‚ç‰¹å¾æœ€é€‚åˆä¸‹æ¸¸åˆ†ç±»ä»»åŠ¡ï¼Œå¹³è¡¡äº†ç‰¹å¾æŠ½è±¡ç¨‹åº¦ä¸ä»»åŠ¡ç›¸å…³æ€§</li>
</ul>
</li>
</ol>
<h4 id="2-1-3-éŸ³é¢‘é¢„å¤„ç†çš„å·¥ç¨‹è€ƒé‡"><a href="#2-1-3-éŸ³é¢‘é¢„å¤„ç†çš„å·¥ç¨‹è€ƒé‡" class="headerlink" title="2.1.3 éŸ³é¢‘é¢„å¤„ç†çš„å·¥ç¨‹è€ƒé‡"></a>2.1.3 éŸ³é¢‘é¢„å¤„ç†çš„å·¥ç¨‹è€ƒé‡</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">process_wav_file</span>(<span class="params">wav_file, time_seconds</span>):</span><br><span class="line">    waveform, sample_rate = torchaudio.load(wav_file)</span><br><span class="line">    target_length = <span class="built_in">int</span>(time_seconds * sample_rate)</span><br><span class="line">    <span class="keyword">if</span> waveform.size(<span class="number">1</span>) &gt; target_length:</span><br><span class="line">        waveform = waveform[:, :target_length]  <span class="comment"># æ—¶é—´è£å‰ª</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        padding_length = target_length - waveform.size(<span class="number">1</span>)</span><br><span class="line">        waveform = torch.nn.functional.pad(waveform, (<span class="number">0</span>, padding_length))  <span class="comment"># é›¶å¡«å……</span></span><br><span class="line">    <span class="keyword">return</span> waveform, sample_rate</span><br></pre></td></tr></table></figure>

<p><strong>3ç§’å›ºå®šé•¿åº¦çš„è®¾è®¡rationale</strong>ï¼š</p>
<ul>
<li><strong>è®¡ç®—æ•ˆç‡</strong>ï¼šå›ºå®šé•¿åº¦ä¾¿äºæ‰¹å¤„ç†ï¼Œæé«˜GPUåˆ©ç”¨ç‡</li>
<li><strong>ä¿¡æ¯å……åˆ†æ€§</strong>ï¼š3ç§’è¶³ä»¥åŒ…å«å®Œæ•´çš„æƒ…æ„Ÿè¡¨è¾¾ï¼Œæ¶µç›–è¯æ±‡ã€éŸµå¾‹ã€è¯­è°ƒå˜åŒ–</li>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼šé¿å…å˜é•¿åºåˆ—å¸¦æ¥çš„å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜</li>
<li><strong>æ¨¡å‹ä¸€è‡´æ€§</strong>ï¼šç¡®ä¿è®­ç»ƒå’Œæ¨ç†é˜¶æ®µçš„è¾“å…¥æ ¼å¼å®Œå…¨ä¸€è‡´</li>
</ul>
<p><strong>é›¶å¡«å…… vs é‡å¤å¡«å……çš„é€‰æ‹©</strong>ï¼š</p>
<ul>
<li>é›¶å¡«å……é¿å…äº†äººå·¥å¼•å…¥çš„å‘¨æœŸæ€§æ¨¡å¼</li>
<li>ä¿æŒäº†åŸå§‹è¯­éŸ³çš„è‡ªç„¶è¾¹ç•Œç‰¹æ€§</li>
<li>ä¸HuBERTé¢„è®­ç»ƒæ—¶çš„å¤„ç†æ–¹å¼ä¿æŒä¸€è‡´</li>
</ul>
<h3 id="2-2-GRUModelåŒå‘åºåˆ—å»ºæ¨¡å™¨"><a href="#2-2-GRUModelåŒå‘åºåˆ—å»ºæ¨¡å™¨" class="headerlink" title="2.2 GRUModelåŒå‘åºåˆ—å»ºæ¨¡å™¨"></a>2.2 GRUModelåŒå‘åºåˆ—å»ºæ¨¡å™¨</h3><h4 id="2-2-1-æ¶æ„è®¾è®¡çš„æ·±å±‚é€»è¾‘"><a href="#2-2-1-æ¶æ„è®¾è®¡çš„æ·±å±‚é€»è¾‘" class="headerlink" title="2.2.1 æ¶æ„è®¾è®¡çš„æ·±å±‚é€»è¾‘"></a>2.2.1 æ¶æ„è®¾è®¡çš„æ·±å±‚é€»è¾‘</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GRUModel</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_size, hidden_size, output_size, args</span>):</span><br><span class="line">        <span class="variable language_">self</span>.bigru = nn.GRU(input_size, hidden_size, batch_first=<span class="literal">True</span>, </span><br><span class="line">                           num_layers=<span class="variable language_">self</span>.num_layers, bidirectional=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.input2hidden = nn.Linear(<span class="number">512</span>, hidden_size * <span class="number">2</span>)</span><br><span class="line">        <span class="variable language_">self</span>.hidden2label = nn.Linear(hidden_size * <span class="number">2</span>, output_size)</span><br></pre></td></tr></table></figure>

<p><strong>åŒå‘GRUçš„ç†è®ºåŸºç¡€</strong>ï¼š</p>
<ul>
<li><strong>å‰å‘ä¿¡æ¯æµ</strong>ï¼šæ•è·ä»è¯­éŸ³å¼€å§‹åˆ°å½“å‰æ—¶åˆ»çš„æƒ…æ„Ÿå‘å±•è½¨è¿¹</li>
<li><strong>åå‘ä¿¡æ¯æµ</strong>ï¼šåˆ©ç”¨æœªæ¥ä¿¡æ¯ä¸ºå½“å‰æ—¶åˆ»æä¾›ä¸Šä¸‹æ–‡çº¦æŸ</li>
<li><strong>ä¿¡æ¯èåˆ</strong>ï¼šå‰åå‘éšçŠ¶æ€çš„æ‹¼æ¥æä¾›äº†æ›´å®Œæ•´çš„æ—¶åºè¡¨ç¤º</li>
</ul>
<p><strong>å¤šå±‚è®¾è®¡çš„å¿…è¦æ€§</strong>ï¼š</p>
<ul>
<li><strong>å±‚æ¬¡åŒ–æŠ½è±¡</strong>ï¼šåº•å±‚æ•è·å±€éƒ¨æ—¶åºæ¨¡å¼ï¼Œé«˜å±‚å»ºæ¨¡å…¨å±€æƒ…æ„ŸåŠ¨æ€</li>
<li><strong>éçº¿æ€§å¢å¼º</strong>ï¼šå¤šå±‚ç»“æ„å¢åŠ æ¨¡å‹çš„éçº¿æ€§è¡¨è¾¾èƒ½åŠ›</li>
<li><strong>æ¢¯åº¦æµä¼˜åŒ–</strong>ï¼šé€‚å½“çš„å±‚æ•°å¹³è¡¡äº†è¡¨è¾¾èƒ½åŠ›ä¸æ¢¯åº¦ä¼ æ’­æ•ˆç‡</li>
</ul>
<h4 id="2-2-2-å‰å‘ä¼ æ’­çš„ç²¾å¯†è®¾è®¡"><a href="#2-2-2-å‰å‘ä¼ æ’­çš„ç²¾å¯†è®¾è®¡" class="headerlink" title="2.2.2 å‰å‘ä¼ æ’­çš„ç²¾å¯†è®¾è®¡"></a>2.2.2 å‰å‘ä¼ æ’­çš„ç²¾å¯†è®¾è®¡</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, U</span>):</span><br><span class="line">    U = <span class="variable language_">self</span>.dropout(U)  <span class="comment"># è¾“å…¥æ­£åˆ™åŒ–</span></span><br><span class="line">    emotions, hidden = <span class="variable language_">self</span>.bigru(U)  <span class="comment"># [batch, seq, 512]</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ³¨æ„åŠ›æœºåˆ¶å¢å¼º</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.attention:</span><br><span class="line">        att_emotions = []</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> emotions:</span><br><span class="line">            att_em, alpha_ = <span class="variable language_">self</span>.matchatt(emotions, t, mask=<span class="literal">None</span>)</span><br><span class="line">            att_emotions.append(att_em.unsqueeze(<span class="number">0</span>))</span><br><span class="line">        att_emotions = torch.cat(att_emotions, dim=<span class="number">0</span>)</span><br><span class="line">        emotions = att_emotions</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å…¨å±€ç‰¹å¾èšåˆ</span></span><br><span class="line">    gru_out = torch.transpose(emotions, <span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># [batch, 512, seq]</span></span><br><span class="line">    gru_out = F.tanh(gru_out)</span><br><span class="line">    gru_out = F.max_pool1d(gru_out, gru_out.size(<span class="number">2</span>)).squeeze(<span class="number">2</span>)  <span class="comment"># å…¨å±€æœ€å¤§æ± åŒ–</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆ†ç±»æ˜ å°„</span></span><br><span class="line">    Out_in = <span class="variable language_">self</span>.relu(gru_out)</span><br><span class="line">    Out_in = <span class="variable language_">self</span>.dropout(Out_in)</span><br><span class="line">    Out_out = <span class="variable language_">self</span>.hidden2label(Out_in)  <span class="comment"># [batch, num_classes]</span></span><br><span class="line">    <span class="keyword">return</span> Out_out</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®å¤„ç†æ­¥éª¤çš„æŠ€æœ¯åˆ†æ</strong>ï¼š</p>
<ol>
<li><p><strong>è¾“å…¥Dropout</strong>ï¼š</p>
<ul>
<li>åœ¨ç‰¹å¾å±‚é¢å¼•å…¥éšæœºæ€§ï¼Œå¢å¼ºæ¨¡å‹æ³›åŒ–èƒ½åŠ›</li>
<li>é˜²æ­¢æ¨¡å‹è¿‡åº¦ä¾èµ–HuBERTç‰¹å¾çš„ç‰¹å®šç»´åº¦</li>
</ul>
</li>
<li><p><strong>åŒå‘GRUå¤„ç†</strong>ï¼š</p>
<ul>
<li>è¾“å‡ºç»´åº¦ä¸º512ï¼ˆ256Ã—2ï¼‰ï¼Œèåˆå‰åå‘ä¿¡æ¯</li>
<li><code>batch_first=True</code>è®¾è®¡ä¾¿äºåç»­å¤„ç†å’Œè°ƒè¯•</li>
</ul>
</li>
<li><p><strong>æ³¨æ„åŠ›å¢å¼ºï¼ˆå¯é€‰ï¼‰</strong>ï¼š</p>
<ul>
<li>ä¸ºæ¯ä¸ªæ—¶é—´æ­¥è®¡ç®—å…¨å±€æ³¨æ„åŠ›æƒé‡</li>
<li>åŠ¨æ€è°ƒæ•´ä¸åŒæ—¶åˆ»ç‰¹å¾çš„é‡è¦æ€§</li>
<li>ç¼“è§£é•¿åºåˆ—ä¿¡æ¯è¡°å‡é—®é¢˜</li>
</ul>
</li>
<li><p><strong>å…¨å±€æœ€å¤§æ± åŒ–</strong>ï¼š</p>
<ul>
<li>æå–åºåˆ—ä¸­çš„æœ€æ˜¾è‘—ç‰¹å¾</li>
<li>å®ç°ä»å˜é•¿åºåˆ—åˆ°å›ºå®šé•¿åº¦è¡¨ç¤ºçš„è½¬æ¢</li>
<li>ä¿ç•™æœ€å¼ºçš„æƒ…æ„Ÿæ¿€æ´»ä¿¡å·</li>
</ul>
</li>
<li><p><strong>åˆ†ç±»å¤´æ˜ å°„</strong>ï¼š</p>
<ul>
<li>çº¿æ€§å˜æ¢å°†512ç»´ç‰¹å¾æ˜ å°„åˆ°4ç±»æƒ…æ„Ÿè¾“å‡º</li>
<li>æ— åç½®è®¾è®¡ç®€åŒ–æ¨¡å‹ï¼Œå‡å°‘è¿‡æ‹Ÿåˆé£é™©</li>
</ul>
</li>
</ol>
<h3 id="2-3-MatchingAttentionæ³¨æ„åŠ›æœºåˆ¶"><a href="#2-3-MatchingAttentionæ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="2.3 MatchingAttentionæ³¨æ„åŠ›æœºåˆ¶"></a>2.3 MatchingAttentionæ³¨æ„åŠ›æœºåˆ¶</h3><h4 id="2-3-1-æ³¨æ„åŠ›è®¾è®¡çš„ç†è®ºåŸºç¡€"><a href="#2-3-1-æ³¨æ„åŠ›è®¾è®¡çš„ç†è®ºåŸºç¡€" class="headerlink" title="2.3.1 æ³¨æ„åŠ›è®¾è®¡çš„ç†è®ºåŸºç¡€"></a>2.3.1 æ³¨æ„åŠ›è®¾è®¡çš„ç†è®ºåŸºç¡€</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MatchingAttention</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, mem_dim, cand_dim, alpha_dim=<span class="literal">None</span>, att_type=<span class="string">&#x27;general&#x27;</span></span>):</span><br><span class="line">        <span class="keyword">if</span> att_type==<span class="string">&#x27;general&#x27;</span>:</span><br><span class="line">            <span class="variable language_">self</span>.transform = nn.Linear(cand_dim, mem_dim, bias=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„åŠ›æœºåˆ¶çš„æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p>
<ul>
<li><strong>æŸ¥è¯¢-é”®-å€¼æ¨¡å¼</strong>ï¼šå°†å½“å‰æ—¶åˆ»ä½œä¸ºæŸ¥è¯¢ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºé”®å’Œå€¼</li>
<li><strong>ç›¸ä¼¼åº¦è®¡ç®—</strong>ï¼šé€šè¿‡å­¦ä¹ åˆ°çš„å˜æ¢çŸ©é˜µè®¡ç®—æŸ¥è¯¢ä¸é”®çš„åŒ¹é…ç¨‹åº¦</li>
<li><strong>åŠ¨æ€æƒé‡åˆ†é…</strong>ï¼šæ ¹æ®ç›¸ä¼¼åº¦ä¸ºä¸åŒæ—¶åˆ»åˆ†é…æ³¨æ„åŠ›æƒé‡</li>
</ul>
<p><strong>General Attentionçš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>ç»´åº¦çµæ´»æ€§</strong>ï¼šé€šè¿‡çº¿æ€§å˜æ¢å¤„ç†ä¸åŒç»´åº¦çš„è¾“å…¥</li>
<li><strong>å‚æ•°æ•ˆç‡</strong>ï¼šç›¸æ¯”concat attentionå‚æ•°æ›´å°‘ï¼Œè®­ç»ƒæ›´ç¨³å®š</li>
<li><strong>è®¡ç®—æ•ˆç‡</strong>ï¼šçŸ©é˜µä¹˜æ³•æ“ä½œä¾¿äºGPUå¹¶è¡ŒåŠ é€Ÿ</li>
</ul>
<h4 id="2-3-2-æ³¨æ„åŠ›è®¡ç®—çš„æ•°å­¦å®ç°"><a href="#2-3-2-æ³¨æ„åŠ›è®¡ç®—çš„æ•°å­¦å®ç°" class="headerlink" title="2.3.2 æ³¨æ„åŠ›è®¡ç®—çš„æ•°å­¦å®ç°"></a>2.3.2 æ³¨æ„åŠ›è®¡ç®—çš„æ•°å­¦å®ç°</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, M, x, mask=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="comment"># M: [seq_len, batch, mem_dim] - è®°å¿†åºåˆ—ï¼ˆæ‰€æœ‰æ—¶åˆ»çš„éšçŠ¶æ€ï¼‰</span></span><br><span class="line">    <span class="comment"># x: [batch, cand_dim] - æŸ¥è¯¢å‘é‡ï¼ˆå½“å‰æ—¶åˆ»çš„éšçŠ¶æ€ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.att_type==<span class="string">&#x27;general&#x27;</span>:</span><br><span class="line">        M_ = M.permute(<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>)  <span class="comment"># [batch, mem_dim, seq_len]</span></span><br><span class="line">        x_ = <span class="variable language_">self</span>.transform(x).unsqueeze(<span class="number">1</span>)  <span class="comment"># [batch, 1, mem_dim]</span></span><br><span class="line">        alpha = F.softmax(torch.bmm(x_, M_), dim=<span class="number">2</span>)  <span class="comment"># [batch, 1, seq_len]</span></span><br><span class="line">    </span><br><span class="line">    attn_pool = torch.bmm(alpha, M.transpose(<span class="number">0</span>,<span class="number">1</span>))[:,<span class="number">0</span>,:]  <span class="comment"># [batch, mem_dim]</span></span><br><span class="line">    <span class="keyword">return</span> attn_pool, alpha</span><br></pre></td></tr></table></figure>

<p><strong>è®¡ç®—æµç¨‹çš„æ·±å±‚è§£æ</strong>ï¼š</p>
<ol>
<li><p><strong>æŸ¥è¯¢å˜æ¢</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x_ = <span class="variable language_">self</span>.transform(x).unsqueeze(<span class="number">1</span>)  <span class="comment"># [batch, 1, mem_dim]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å°†å½“å‰æ—¶åˆ»ç‰¹å¾å˜æ¢åˆ°è®°å¿†ç©ºé—´</li>
<li>å­¦ä¹ æŸ¥è¯¢ä¸è®°å¿†ä¹‹é—´çš„æœ€ä¼˜åŒ¹é…å…³ç³»</li>
</ul>
</li>
<li><p><strong>ç›¸ä¼¼åº¦è®¡ç®—</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">alpha = F.softmax(torch.bmm(x_, M_), dim=<span class="number">2</span>)  <span class="comment"># [batch, 1, seq_len]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ‰¹é‡çŸ©é˜µä¹˜æ³•è®¡ç®—æ‰€æœ‰æ—¶åˆ»çš„ç›¸ä¼¼åº¦åˆ†æ•°</li>
<li>Softmaxå½’ä¸€åŒ–ç¡®ä¿æƒé‡å’Œä¸º1</li>
</ul>
</li>
<li><p><strong>åŠ æƒèšåˆ</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">attn_pool = torch.bmm(alpha, M.transpose(<span class="number">0</span>,<span class="number">1</span>))[:,<span class="number">0</span>,:]  <span class="comment"># [batch, mem_dim]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ ¹æ®æ³¨æ„åŠ›æƒé‡å¯¹æ‰€æœ‰æ—¶åˆ»ç‰¹å¾è¿›è¡ŒåŠ æƒå¹³å‡</li>
<li>ç”Ÿæˆèåˆå…¨å±€ä¿¡æ¯çš„ä¸Šä¸‹æ–‡å‘é‡</li>
</ul>
</li>
</ol>
<h4 id="2-3-3-æ³¨æ„åŠ›åœ¨æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä½œç”¨æœºåˆ¶"><a href="#2-3-3-æ³¨æ„åŠ›åœ¨æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä½œç”¨æœºåˆ¶" class="headerlink" title="2.3.3 æ³¨æ„åŠ›åœ¨æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä½œç”¨æœºåˆ¶"></a>2.3.3 æ³¨æ„åŠ›åœ¨æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä½œç”¨æœºåˆ¶</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="variable language_">self</span>.attention:</span><br><span class="line">    att_emotions = []</span><br><span class="line">    alpha = []</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> emotions:  <span class="comment"># å¯¹åºåˆ—ä¸­æ¯ä¸ªæ—¶é—´æ­¥</span></span><br><span class="line">        att_em, alpha_ = <span class="variable language_">self</span>.matchatt(emotions, t, mask=<span class="literal">None</span>)</span><br><span class="line">        att_emotions.append(att_em.unsqueeze(<span class="number">0</span>))</span><br><span class="line">        alpha.append(alpha_[:, <span class="number">0</span>, :])</span><br><span class="line">    att_emotions = torch.cat(att_emotions, dim=<span class="number">0</span>)</span><br><span class="line">    emotions = att_emotions</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„åŠ›å¢å¼ºçš„æƒ…æ„Ÿå»ºæ¨¡ä»·å€¼</strong>ï¼š</p>
<ol>
<li><p><strong>å…³é”®æ—¶åˆ»è¯†åˆ«</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨è¯†åˆ«è¯­éŸ³ä¸­æƒ…æ„Ÿè¡¨è¾¾æœ€å¼ºçƒˆçš„æ—¶é—´æ®µ</li>
<li>ä¾‹å¦‚ï¼šè¯­è°ƒå˜åŒ–å‰§çƒˆçš„è¯æ±‡ã€åœé¡¿å‰åçš„é‡éŸ³</li>
</ul>
</li>
<li><p><strong>ä¸Šä¸‹æ–‡æ•´åˆ</strong>ï¼š</p>
<ul>
<li>ä¸ºæ¯ä¸ªæ—¶åˆ»æä¾›å…¨åºåˆ—çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
<li>é¿å…å±€éƒ¨ç‰¹å¾çš„è¯¯å¯¼ï¼Œæé«˜åˆ†ç±»ç¨³å®šæ€§</li>
</ul>
</li>
<li><p><strong>é•¿è·ç¦»ä¾èµ–å»ºæ¨¡</strong>ï¼š</p>
<ul>
<li>ç¼“è§£GRUåœ¨é•¿åºåˆ—ä¸Šçš„ä¿¡æ¯è¡°å‡é—®é¢˜</li>
<li>ä¿æŒåºåˆ—å¼€å§‹å’Œç»“æŸéƒ¨åˆ†ä¿¡æ¯çš„æœ‰æ•ˆä¼ é€’</li>
</ul>
</li>
<li><p><strong>å¯è§£é‡Šæ€§å¢å¼º</strong>ï¼š</p>
<ul>
<li>æ³¨æ„åŠ›æƒé‡æä¾›æ¨¡å‹å†³ç­–çš„å¯è§†åŒ–ä¾æ®</li>
<li>å¸®åŠ©ç†è§£æ¨¡å‹å…³æ³¨çš„è¯­éŸ³ç‰¹å¾æ¨¡å¼</li>
</ul>
</li>
</ol>
<h3 id="2-4-åˆ†ç±»å¤´ä¸æ¿€æ´»å‡½æ•°çš„ç²¾å¿ƒè®¾è®¡"><a href="#2-4-åˆ†ç±»å¤´ä¸æ¿€æ´»å‡½æ•°çš„ç²¾å¿ƒè®¾è®¡" class="headerlink" title="2.4 åˆ†ç±»å¤´ä¸æ¿€æ´»å‡½æ•°çš„ç²¾å¿ƒè®¾è®¡"></a>2.4 åˆ†ç±»å¤´ä¸æ¿€æ´»å‡½æ•°çš„ç²¾å¿ƒè®¾è®¡</h3><h4 id="2-4-1-åˆ†ç±»å¤´çš„æ¶æ„é€‰æ‹©"><a href="#2-4-1-åˆ†ç±»å¤´çš„æ¶æ„é€‰æ‹©" class="headerlink" title="2.4.1 åˆ†ç±»å¤´çš„æ¶æ„é€‰æ‹©"></a>2.4.1 åˆ†ç±»å¤´çš„æ¶æ„é€‰æ‹©</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">self</span>.hidden2label = nn.Linear(hidden_size * <span class="number">2</span>, output_size)  <span class="comment"># 512 -&gt; 4</span></span><br></pre></td></tr></table></figure>

<p><strong>çº¿æ€§åˆ†ç±»å¤´çš„è®¾è®¡è€ƒé‡</strong>ï¼š</p>
<ul>
<li><strong>ç®€æ´æ€§åŸåˆ™</strong>ï¼šé¿å…è¿‡åº¦å¤æ‚çš„åˆ†ç±»å™¨ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</li>
<li><strong>ç‰¹å¾å……åˆ†æ€§</strong>ï¼š512ç»´GRUè¾“å‡ºå·²åŒ…å«ä¸°å¯Œçš„æƒ…æ„Ÿåˆ¤åˆ«ä¿¡æ¯</li>
<li><strong>è®¡ç®—æ•ˆç‡</strong>ï¼šçº¿æ€§å˜æ¢è®¡ç®—ç®€å•ï¼Œä¾¿äºå®æ—¶åº”ç”¨</li>
</ul>
<h4 id="2-4-2-æ¿€æ´»å‡½æ•°çš„å±‚æ¬¡åŒ–åº”ç”¨"><a href="#2-4-2-æ¿€æ´»å‡½æ•°çš„å±‚æ¬¡åŒ–åº”ç”¨" class="headerlink" title="2.4.2 æ¿€æ´»å‡½æ•°çš„å±‚æ¬¡åŒ–åº”ç”¨"></a>2.4.2 æ¿€æ´»å‡½æ•°çš„å±‚æ¬¡åŒ–åº”ç”¨</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gru_out = F.tanh(gru_out)      <span class="comment"># åºåˆ—ç‰¹å¾æ¿€æ´»</span></span><br><span class="line">Out_in = <span class="variable language_">self</span>.relu(gru_out)    <span class="comment"># åˆ†ç±»å‰æ¿€æ´»</span></span><br><span class="line"><span class="comment"># åˆ†ç±»å±‚æ— æ¿€æ´»ï¼Œè¾“å‡ºåŸå§‹logits</span></span><br></pre></td></tr></table></figure>

<p><strong>æ¿€æ´»å‡½æ•°é€‰æ‹©çš„æ·±å±‚é€»è¾‘</strong>ï¼š</p>
<ol>
<li><p><strong>Tanhæ¿€æ´»</strong>ï¼š</p>
<ul>
<li>å°†åºåˆ—ç‰¹å¾å‹ç¼©åˆ°[-1,1]åŒºé—´</li>
<li>å¢å¼ºç‰¹å¾çš„å¯¹æ¯”åº¦ï¼Œçªå‡ºæ˜¾è‘—å˜åŒ–</li>
<li>å¯¹ç§°æ€§è´¨é€‚åˆåŒå‘GRUçš„è¾“å‡ºç‰¹å¾</li>
</ul>
</li>
<li><p><strong>LeakyReLUæ¿€æ´»</strong>ï¼š</p>
<ul>
<li>ä¿æŒæ¢¯åº¦æµåŠ¨ï¼Œé¿å…æ­»ç¥ç»å…ƒé—®é¢˜</li>
<li>è´Ÿæ–œç‡å‚æ•°å…è®¸è´Ÿå€¼ä¿¡æ¯çš„éƒ¨åˆ†ä¿ç•™</li>
<li>åœ¨åˆ†ç±»å‰æä¾›éçº¿æ€§å˜æ¢èƒ½åŠ›</li>
</ul>
</li>
<li><p><strong>æ— æ¿€æ´»è¾“å‡º</strong>ï¼š</p>
<ul>
<li>åˆ†ç±»å±‚è¾“å‡ºåŸå§‹logitsï¼Œä¾¿äºäº¤å‰ç†µæŸå¤±è®¡ç®—</li>
<li>ä¿æŒæ•°å€¼ç¨³å®šæ€§ï¼Œé¿å…æ¢¯åº¦æ¶ˆå¤±</li>
</ul>
</li>
</ol>
<hr>
<h2 id="3-å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ"><a href="#3-å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ" class="headerlink" title="3. å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ"></a>3. å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ</h2><h3 id="3-1-è®­ç»ƒé˜¶æ®µæ•°æ®æµ"><a href="#3-1-è®­ç»ƒé˜¶æ®µæ•°æ®æµ" class="headerlink" title="3.1 è®­ç»ƒé˜¶æ®µæ•°æ®æµ"></a>3.1 è®­ç»ƒé˜¶æ®µæ•°æ®æµ</h3><p><strong>è®­ç»ƒæµç¨‹çš„å…³é”®ç¯èŠ‚åˆ†æ</strong>ï¼š</p>
<ol>
<li><p><strong>æ•°æ®é¢„å¤„ç†é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>IEMOCAPæ•°æ®é›†åŒ…å«å¤šç§æƒ…æ„Ÿç±»åˆ«ï¼Œéœ€è¦æ ‡å‡†åŒ–æ˜ å°„</li>
<li>éŸ³é¢‘é•¿åº¦ä¸ä¸€è‡´é—®é¢˜é€šè¿‡3ç§’å›ºå®šé•¿åº¦ç­–ç•¥è§£å†³</li>
<li>é‡‡æ ·ç‡ç»Ÿä¸€ä¸º16kHzï¼ŒåŒ¹é…HuBERTé¢„è®­ç»ƒé…ç½®</li>
</ul>
</li>
<li><p><strong>ç‰¹å¾æå–é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>HuBERTæ¨¡å‹å†»ç»“å‚æ•°ï¼Œä»…ç”¨äºç‰¹å¾æå–</li>
<li>768ç»´ç‰¹å¾å‘é‡åŒ…å«ä¸°å¯Œçš„è¯­éŸ³è¯­ä¹‰ä¿¡æ¯</li>
<li>æ‰¹å¤„ç†æ–¹å¼æé«˜ç‰¹å¾æå–æ•ˆç‡</li>
</ul>
</li>
<li><p><strong>æ¨¡å‹è®­ç»ƒé˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>5æŠ˜äº¤å‰éªŒè¯ç¡®ä¿ç»“æœçš„ç»Ÿè®¡æ˜¾è‘—æ€§</li>
<li>æ‰¹æ¬¡å¤§å°32å¹³è¡¡å†…å­˜å ç”¨ä¸æ¢¯åº¦ä¼°è®¡è´¨é‡</li>
<li>AdamWä¼˜åŒ–å™¨ç»“åˆæƒé‡è¡°å‡ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</li>
</ul>
</li>
<li><p><strong>æ¨¡å‹ä¿å­˜é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>ä¿å­˜å®Œæ•´çš„state_dictï¼Œä¾¿äºåç»­åŠ è½½</li>
<li>æ¨¡å‹æ–‡ä»¶åŒ…å«æ‰€æœ‰å¯è®­ç»ƒå‚æ•°</li>
</ul>
</li>
</ol>
<h3 id="3-2-æ¨ç†é˜¶æ®µæ•°æ®æµ"><a href="#3-2-æ¨ç†é˜¶æ®µæ•°æ®æµ" class="headerlink" title="3.2 æ¨ç†é˜¶æ®µæ•°æ®æµ"></a>3.2 æ¨ç†é˜¶æ®µæ•°æ®æµ</h3><p><strong>æ¨ç†æµç¨‹çš„æŠ€æœ¯ç»†èŠ‚</strong>ï¼š</p>
<ol>
<li><p><strong>è¾“å…¥å¤„ç†å¤šæ ·æ€§</strong>ï¼š</p>
<ul>
<li>æ”¯æŒWAVæ–‡ä»¶å’Œå®æ—¶éº¦å…‹é£ä¸¤ç§è¾“å…¥æ¨¡å¼</li>
<li>ç»Ÿä¸€çš„é¢„å¤„ç†æµç¨‹ç¡®ä¿è¾“å…¥æ ¼å¼ä¸€è‡´æ€§</li>
</ul>
</li>
<li><p><strong>ç‰¹å¾æå–ä¸€è‡´æ€§</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ä¸è®­ç»ƒæ—¶ç›¸åŒçš„processorå’Œé¢„å¤„ç†å‚æ•°</li>
<li>ç¡®ä¿ç‰¹å¾åˆ†å¸ƒçš„ä¸€è‡´æ€§</li>
</ul>
</li>
<li><p><strong>æ¨¡å‹æ¨ç†ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li><code>torch.no_grad()</code>ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡å°‘å†…å­˜å ç”¨</li>
<li>æ‰¹å¤„ç†ç»´åº¦çš„åŠ¨æ€è°ƒæ•´é€‚åº”ä¸åŒè¾“å…¥æ ¼å¼</li>
</ul>
</li>
<li><p><strong>ç»“æœåå¤„ç†</strong>ï¼š</p>
<ul>
<li>Softmaxæä¾›æ¦‚ç‡åˆ†å¸ƒï¼Œå¢å¼ºç»“æœå¯ä¿¡åº¦</li>
<li>ç½®ä¿¡åº¦è®¡ç®—å¸®åŠ©è¯„ä¼°é¢„æµ‹è´¨é‡</li>
</ul>
</li>
</ol>
<h3 id="3-3-GUIå®æ—¶å¤„ç†æµ"><a href="#3-3-GUIå®æ—¶å¤„ç†æµ" class="headerlink" title="3.3 GUIå®æ—¶å¤„ç†æµ"></a>3.3 GUIå®æ—¶å¤„ç†æµ</h3><p><strong>å®æ—¶å¤„ç†çš„å·¥ç¨‹æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li><p><strong>çº¿ç¨‹å®‰å…¨è®¾è®¡</strong>ï¼š</p>
<ul>
<li>AudioRecorderç‹¬ç«‹çº¿ç¨‹é¿å…UIé˜»å¡</li>
<li>ä¿¡å·-æ§½æœºåˆ¶ç¡®ä¿çº¿ç¨‹é—´å®‰å…¨é€šä¿¡</li>
</ul>
</li>
<li><p><strong>éŸ³é¢‘ç¼“å†²ç®¡ç†</strong>ï¼š</p>
<ul>
<li>æ»‘åŠ¨çª—å£æœºåˆ¶ä¿æŒæœ€æ–°5ç§’éŸ³é¢‘</li>
<li>è‡ªåŠ¨å†…å­˜ç®¡ç†é¿å…ç¼“å†²åŒºæº¢å‡º</li>
</ul>
</li>
<li><p><strong>å®æ—¶æ€§èƒ½ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>æ¨¡å‹é¢„åŠ è½½å‡å°‘æ¨ç†å»¶è¿Ÿ</li>
<li>å¼‚æ­¥å¤„ç†æé«˜å“åº”é€Ÿåº¦</li>
</ul>
</li>
<li><p><strong>ç”¨æˆ·ä½“éªŒè®¾è®¡</strong>ï¼š</p>
<ul>
<li>å®æ—¶åé¦ˆæä¾›å³æ—¶æƒ…æ„Ÿè¯†åˆ«ç»“æœ</li>
<li>å†å²è®°å½•åŠŸèƒ½æ”¯æŒç»“æœå›é¡¾</li>
</ul>
</li>
</ol>
<hr>
<h2 id="4-å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“"><a href="#4-å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“" class="headerlink" title="4. å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“"></a>4. å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“</h2><h3 id="4-1-æ¨¡å‹ç»“æ„å‚æ•°æ·±åº¦åˆ†æ"><a href="#4-1-æ¨¡å‹ç»“æ„å‚æ•°æ·±åº¦åˆ†æ" class="headerlink" title="4.1 æ¨¡å‹ç»“æ„å‚æ•°æ·±åº¦åˆ†æ"></a>4.1 æ¨¡å‹ç»“æ„å‚æ•°æ·±åº¦åˆ†æ</h3><table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>é»˜è®¤å€¼</th>
<th>å‚æ•°å«ä¹‰</th>
<th>æ€§èƒ½å½±å“æœºåˆ¶</th>
<th>è°ƒä¼˜å»ºè®®</th>
</tr>
</thead>
<tbody><tr>
<td><code>hidden_size</code></td>
<td>256</td>
<td>GRUéšçŠ¶æ€ç»´åº¦</td>
<td><strong>è¡¨è¾¾èƒ½åŠ›</strong>ï¼šæ›´å¤§ç»´åº¦æä¾›æ›´å¼ºç‰¹å¾è¡¨è¾¾<br><strong>è®¡ç®—å¤æ‚åº¦</strong>ï¼šçº¿æ€§å½±å“å‚æ•°é‡å’Œè®¡ç®—æ—¶é—´<br><strong>è¿‡æ‹Ÿåˆé£é™©</strong>ï¼šè¿‡å¤§å¯èƒ½å¯¼è‡´è®­ç»ƒè¿‡æ‹Ÿåˆ</td>
<td>128-512èŒƒå›´å†…è°ƒä¼˜<br>ç»“åˆdropouté˜²è¿‡æ‹Ÿåˆ</td>
</tr>
<tr>
<td><code>dia_layers</code></td>
<td>2</td>
<td>GRUå †å å±‚æ•°</td>
<td><strong>æŠ½è±¡å±‚æ¬¡</strong>ï¼šå¤šå±‚æä¾›æ›´æ·±å±‚æ¬¡çš„ç‰¹å¾æŠ½è±¡<br><strong>æ¢¯åº¦ä¼ æ’­</strong>ï¼šè¿‡æ·±å¯èƒ½å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±<br><strong>è®­ç»ƒç¨³å®šæ€§</strong>ï¼šå±‚æ•°é€‚ä¸­ä¿è¯è®­ç»ƒç¨³å®š</td>
<td>1-4å±‚ä¸ºå®œ<br>é…åˆæ¢¯åº¦è£å‰ªä½¿ç”¨</td>
</tr>
<tr>
<td><code>utt_insize</code></td>
<td>768</td>
<td>HuBERTè¾“å‡ºç»´åº¦</td>
<td><strong>ç‰¹å¾ä¸°å¯Œåº¦</strong>ï¼šå›ºå®šå€¼ï¼Œç”±é¢„è®­ç»ƒæ¨¡å‹å†³å®š<br><strong>åŒ¹é…è¦æ±‚</strong>ï¼šå¿…é¡»ä¸HuBERTè¾“å‡ºç»´åº¦ä¸€è‡´</td>
<td>ä¸å¯è°ƒæ•´<br>ç”±é¢„è®­ç»ƒæ¨¡å‹å†³å®š</td>
</tr>
<tr>
<td><code>out_class</code></td>
<td>4</td>
<td>æƒ…æ„Ÿç±»åˆ«æ•°é‡</td>
<td><strong>ä»»åŠ¡å¤æ‚åº¦</strong>ï¼šç±»åˆ«æ•°ç›´æ¥å½±å“åˆ†ç±»éš¾åº¦<br><strong>æ•°æ®å¹³è¡¡</strong>ï¼šéœ€è¦å„ç±»åˆ«æ ·æœ¬ç›¸å¯¹å¹³è¡¡</td>
<td>æ ¹æ®å…·ä½“ä»»åŠ¡ç¡®å®š<br>è€ƒè™‘ç±»åˆ«å¹³è¡¡ç­–ç•¥</td>
</tr>
</tbody></table>
<h3 id="4-2-è®­ç»ƒè¶…å‚æ•°æ·±åº¦åˆ†æ"><a href="#4-2-è®­ç»ƒè¶…å‚æ•°æ·±åº¦åˆ†æ" class="headerlink" title="4.2 è®­ç»ƒè¶…å‚æ•°æ·±åº¦åˆ†æ"></a>4.2 è®­ç»ƒè¶…å‚æ•°æ·±åº¦åˆ†æ</h3><table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>é»˜è®¤å€¼</th>
<th>å‚æ•°å«ä¹‰</th>
<th>æ€§èƒ½å½±å“æœºåˆ¶</th>
<th>è°ƒä¼˜ç­–ç•¥</th>
</tr>
</thead>
<tbody><tr>
<td><code>learning_rate</code></td>
<td>1e-5</td>
<td>å­¦ä¹ ç‡</td>
<td><strong>æ”¶æ•›é€Ÿåº¦</strong>ï¼šè¿‡å¤§æ˜“éœ‡è¡ï¼Œè¿‡å°æ”¶æ•›æ…¢<br><strong>æœ€ç»ˆæ€§èƒ½</strong>ï¼šå½±å“æ¨¡å‹æ”¶æ•›åˆ°çš„å±€éƒ¨æœ€ä¼˜è§£<br><strong>è®­ç»ƒç¨³å®šæ€§</strong>ï¼šé€‚å½“å­¦ä¹ ç‡ä¿è¯è®­ç»ƒç¨³å®š</td>
<td>1e-6åˆ°1e-4èŒƒå›´<br>ä½¿ç”¨å­¦ä¹ ç‡è°ƒåº¦</td>
</tr>
<tr>
<td><code>dropout</code></td>
<td>0.2</td>
<td>éšæœºå¤±æ´»æ¦‚ç‡</td>
<td><strong>æ­£åˆ™åŒ–å¼ºåº¦</strong>ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆçš„å…³é”®å‚æ•°<br><strong>æ¨¡å‹å®¹é‡</strong>ï¼šè¿‡å¤§å½±å“æ¨¡å‹è¡¨è¾¾èƒ½åŠ›<br><strong>æ³›åŒ–èƒ½åŠ›</strong>ï¼šé€‚å½“dropoutæå‡æ³›åŒ–æ€§èƒ½</td>
<td>0.1-0.5èŒƒå›´è°ƒä¼˜<br>æ ¹æ®æ•°æ®é›†å¤§å°è°ƒæ•´</td>
</tr>
<tr>
<td><code>batch_size</code></td>
<td>32</td>
<td>æ‰¹æ¬¡å¤§å°</td>
<td><strong>æ¢¯åº¦ä¼°è®¡</strong>ï¼šå½±å“æ¢¯åº¦ä¼°è®¡çš„å‡†ç¡®æ€§<br><strong>å†…å­˜å ç”¨</strong>ï¼šç›´æ¥å½±å“GPUå†…å­˜éœ€æ±‚<br><strong>è®­ç»ƒé€Ÿåº¦</strong>ï¼šå½±å“æ¯ä¸ªepochçš„è®­ç»ƒæ—¶é—´</td>
<td>16-64æ ¹æ®æ˜¾å­˜è°ƒæ•´<br>è€ƒè™‘æ¢¯åº¦ç´¯ç§¯</td>
</tr>
<tr>
<td><code>attention</code></td>
<td>True</td>
<td>æ³¨æ„åŠ›æœºåˆ¶å¼€å…³</td>
<td><strong>é•¿åºåˆ—å»ºæ¨¡</strong>ï¼šæå‡é•¿è·ç¦»ä¾èµ–æ•è·èƒ½åŠ›<br><strong>è®¡ç®—å¼€é”€</strong>ï¼šå¢åŠ çº¦20%çš„è®¡ç®—æ—¶é—´<br><strong>æ¨¡å‹å¤æ‚åº¦</strong>ï¼šå¢åŠ æ¨¡å‹å‚æ•°é‡</td>
<td>æ ¹æ®åºåˆ—é•¿åº¦å†³å®š<br>çŸ­åºåˆ—å¯å…³é—­</td>
</tr>
</tbody></table>
<h3 id="4-3-æ•°æ®å¤„ç†å‚æ•°æ·±åº¦åˆ†æ"><a href="#4-3-æ•°æ®å¤„ç†å‚æ•°æ·±åº¦åˆ†æ" class="headerlink" title="4.3 æ•°æ®å¤„ç†å‚æ•°æ·±åº¦åˆ†æ"></a>4.3 æ•°æ®å¤„ç†å‚æ•°æ·±åº¦åˆ†æ</h3><table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>é»˜è®¤å€¼</th>
<th>å‚æ•°å«ä¹‰</th>
<th>æ€§èƒ½å½±å“æœºåˆ¶</th>
<th>è®¾è®¡è€ƒé‡</th>
</tr>
</thead>
<tbody><tr>
<td><code>time_seconds</code></td>
<td>3</td>
<td>éŸ³é¢‘å›ºå®šé•¿åº¦</td>
<td><strong>ä¿¡æ¯å®Œæ•´æ€§</strong>ï¼šæ—¶é•¿å½±å“æƒ…æ„Ÿä¿¡æ¯çš„å®Œæ•´æ€§<br><strong>è®¡ç®—æ•ˆç‡</strong>ï¼šé•¿åº¦ç›´æ¥å½±å“è®¡ç®—å¤æ‚åº¦<br><strong>å†…å­˜å ç”¨</strong>ï¼šå½±å“æ‰¹å¤„ç†çš„å†…å­˜éœ€æ±‚</td>
<td>2-5ç§’èŒƒå›´å†…<br>å¹³è¡¡ä¿¡æ¯ä¸æ•ˆç‡</td>
</tr>
<tr>
<td><code>sample_rate</code></td>
<td>16000</td>
<td>éŸ³é¢‘é‡‡æ ·ç‡</td>
<td><strong>é¢‘ç‡åˆ†è¾¨ç‡</strong>ï¼šå½±å“é«˜é¢‘ä¿¡æ¯çš„ä¿ç•™<br><strong>å…¼å®¹æ€§</strong>ï¼šéœ€åŒ¹é…é¢„è®­ç»ƒæ¨¡å‹è¦æ±‚<br><strong>æ•°æ®å¤§å°</strong>ï¼šå½±å“éŸ³é¢‘æ•°æ®çš„å­˜å‚¨ç©ºé—´</td>
<td>å›ºå®š16kHz<br>åŒ¹é…HuBERTè¦æ±‚</td>
</tr>
<tr>
<td><code>num_folds</code></td>
<td>5</td>
<td>äº¤å‰éªŒè¯æŠ˜æ•°</td>
<td><strong>è¯„ä¼°å¯é æ€§</strong>ï¼šæŠ˜æ•°è¶Šå¤šè¯„ä¼°è¶Šå¯é <br><strong>è®¡ç®—æˆæœ¬</strong>ï¼šæŠ˜æ•°å½±å“æ€»è®­ç»ƒæ—¶é—´<br><strong>ç»Ÿè®¡æ˜¾è‘—æ€§</strong>ï¼šå½±å“ç»“æœçš„ç»Ÿè®¡æ„ä¹‰</td>
<td>5-10æŠ˜ä¸ºå®œ<br>å¹³è¡¡å¯é æ€§ä¸æˆæœ¬</td>
</tr>
</tbody></table>
<h3 id="4-4-å‚æ•°è°ƒä¼˜çš„ç³»ç»Ÿæ€§æ–¹æ³•"><a href="#4-4-å‚æ•°è°ƒä¼˜çš„ç³»ç»Ÿæ€§æ–¹æ³•" class="headerlink" title="4.4 å‚æ•°è°ƒä¼˜çš„ç³»ç»Ÿæ€§æ–¹æ³•"></a>4.4 å‚æ•°è°ƒä¼˜çš„ç³»ç»Ÿæ€§æ–¹æ³•</h3><p><strong>å±‚æ¬¡åŒ–è°ƒä¼˜ç­–ç•¥</strong>ï¼š</p>
<ol>
<li><strong>æ¶æ„å‚æ•°</strong>ï¼šå…ˆç¡®å®šhidden_sizeå’Œdia_layers</li>
<li><strong>è®­ç»ƒå‚æ•°</strong>ï¼šå†è°ƒä¼˜learning_rateå’Œdropout</li>
<li><strong>æ•°æ®å‚æ•°</strong>ï¼šæœ€åä¼˜åŒ–batch_sizeå’Œtime_seconds</li>
</ol>
<p><strong>æ€§èƒ½ç›‘æ§æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><strong>è®­ç»ƒæŒ‡æ ‡</strong>ï¼šæŸå¤±å‡½æ•°æ”¶æ•›æ›²çº¿ã€æ¢¯åº¦èŒƒæ•°</li>
<li><strong>éªŒè¯æŒ‡æ ‡</strong>ï¼šå‡†ç¡®ç‡ã€F1åˆ†æ•°ã€æ··æ·†çŸ©é˜µ</li>
<li><strong>æ•ˆç‡æŒ‡æ ‡</strong>ï¼šè®­ç»ƒæ—¶é—´ã€å†…å­˜å ç”¨ã€æ¨ç†é€Ÿåº¦</li>
</ul>
<hr>
<h2 id="5-æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£"><a href="#5-æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£" class="headerlink" title="5. æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£"></a>5. æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£</h2><h3 id="5-1-è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ·±å±‚ä»·å€¼"><a href="#5-1-è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ·±å±‚ä»·å€¼" class="headerlink" title="5.1 è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ·±å±‚ä»·å€¼"></a>5.1 è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ·±å±‚ä»·å€¼</h3><p>HuBERTæ¨¡å‹çš„é¢„è®­ç»ƒæœºåˆ¶ä½“ç°äº†ç°ä»£è¯­éŸ³å¤„ç†çš„æ ¸å¿ƒæ€æƒ³ï¼š</p>
<p><strong>æ©ç é¢„æµ‹ä»»åŠ¡çš„è®¾è®¡æ™ºæ…§</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># HuBERTé¢„è®­ç»ƒä¼ªä»£ç ç¤ºä¾‹</span></span><br><span class="line">masked_features = mask_features(input_features, mask_prob=<span class="number">0.15</span>)</span><br><span class="line">predicted_features = hubert_model(masked_features)</span><br><span class="line">loss = mse_loss(predicted_features, target_features)</span><br></pre></td></tr></table></figure>

<p><strong>å¤šå±‚æ¬¡ç‰¹å¾å­¦ä¹ æœºåˆ¶</strong>ï¼š</p>
<ul>
<li><strong>å£°å­¦å±‚é¢</strong>ï¼šåº•å±‚Transformerå±‚å­¦ä¹ éŸ³ç´ ã€éŸ³è°ƒã€è¯­é€Ÿç­‰åŸºç¡€å£°å­¦ç‰¹å¾</li>
<li><strong>è¯­è¨€å±‚é¢</strong>ï¼šä¸­å±‚å­¦ä¹ è¯æ±‡è¾¹ç•Œã€è¯­æ³•ç»“æ„ã€è¯­ä¹‰å…³ç³»</li>
<li><strong>éŸµå¾‹å±‚é¢</strong>ï¼šé«˜å±‚æ•è·èŠ‚å¥ã€é‡éŸ³ã€è¯­è°ƒå˜åŒ–ï¼Œè¿™äº›ç‰¹å¾ä¸æƒ…æ„Ÿè¡¨è¾¾å¯†åˆ‡ç›¸å…³</li>
</ul>
<p><strong>è¿ç§»å­¦ä¹ çš„æœ‰æ•ˆæ€§</strong>ï¼š</p>
<ul>
<li>é¢„è®­ç»ƒç‰¹å¾åŒ…å«ä¸°å¯Œçš„è¯­éŸ³é€šç”¨è¡¨ç¤º</li>
<li>åœ¨æƒ…æ„Ÿè¯†åˆ«ä»»åŠ¡ä¸Šå¾®è°ƒæ—¶ï¼Œæ¨¡å‹èƒ½å¿«é€Ÿé€‚åº”ç‰¹å®šé¢†åŸŸç‰¹å¾</li>
<li>ç›¸æ¯”ä»é›¶è®­ç»ƒï¼Œæ˜¾è‘—å‡å°‘äº†æ‰€éœ€çš„æ ‡æ³¨æ•°æ®é‡</li>
</ul>
<h3 id="5-2-åºåˆ—å»ºæ¨¡çš„æ—¶åºä¾èµ–æœºåˆ¶"><a href="#5-2-åºåˆ—å»ºæ¨¡çš„æ—¶åºä¾èµ–æœºåˆ¶" class="headerlink" title="5.2 åºåˆ—å»ºæ¨¡çš„æ—¶åºä¾èµ–æœºåˆ¶"></a>5.2 åºåˆ—å»ºæ¨¡çš„æ—¶åºä¾èµ–æœºåˆ¶</h3><p>åŒå‘GRUçš„é—¨æ§æœºåˆ¶å®ç°äº†å¯¹æ—¶åºä¿¡æ¯çš„ç²¾ç¡®æ§åˆ¶ï¼š</p>
<p><strong>é—¨æ§æœºåˆ¶çš„æ•°å­¦è¡¨è¾¾</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># GRUé—¨æ§æœºåˆ¶ä¼ªä»£ç </span></span><br><span class="line">reset_gate = sigmoid(W_r @ [h_prev, x_t])</span><br><span class="line">update_gate = sigmoid(W_u @ [h_prev, x_t])</span><br><span class="line">candidate_h = tanh(W_h @ [reset_gate * h_prev, x_t])</span><br><span class="line">h_t = (<span class="number">1</span> - update_gate) * h_prev + update_gate * candidate_h</span><br></pre></td></tr></table></figure>

<p><strong>åŒå‘ä¿¡æ¯èåˆçš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>å‰å‘æµ</strong>ï¼šæ•è·ä»è¯­éŸ³å¼€å§‹åˆ°å½“å‰ä½ç½®çš„æƒ…æ„Ÿå‘å±•è¶‹åŠ¿</li>
<li><strong>åå‘æµ</strong>ï¼šåˆ©ç”¨æœªæ¥ä¿¡æ¯ä¸ºå½“å‰åˆ¤æ–­æä¾›ä¸Šä¸‹æ–‡çº¦æŸ</li>
<li><strong>ä¿¡æ¯äº’è¡¥</strong>ï¼šå‰åå‘ä¿¡æ¯çš„ç»“åˆæä¾›äº†æ›´å…¨é¢çš„æ—¶åºè¡¨ç¤º</li>
</ul>
<p><strong>æƒ…æ„Ÿæ—¶åºæ¨¡å¼çš„å»ºæ¨¡</strong>ï¼š</p>
<ul>
<li><strong>æƒ…æ„Ÿèµ·ä¼</strong>ï¼šGRUèƒ½å¤Ÿè®°å¿†æƒ…æ„Ÿçš„å˜åŒ–è½¨è¿¹</li>
<li><strong>å…³é”®è½¬æŠ˜</strong>ï¼šé—¨æ§æœºåˆ¶è‡ªåŠ¨è¯†åˆ«æƒ…æ„Ÿè¡¨è¾¾çš„é‡è¦æ—¶åˆ»</li>
<li><strong>ä¸Šä¸‹æ–‡ä¾èµ–</strong>ï¼šåŒå‘è®¾è®¡ç¡®ä¿æ¯ä¸ªæ—¶åˆ»éƒ½èƒ½è·å¾—å……åˆ†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
</ul>
<h3 id="5-3-æ³¨æ„åŠ›æœºåˆ¶çš„åŠ¨æ€èšç„¦åŸç†"><a href="#5-3-æ³¨æ„åŠ›æœºåˆ¶çš„åŠ¨æ€èšç„¦åŸç†" class="headerlink" title="5.3 æ³¨æ„åŠ›æœºåˆ¶çš„åŠ¨æ€èšç„¦åŸç†"></a>5.3 æ³¨æ„åŠ›æœºåˆ¶çš„åŠ¨æ€èšç„¦åŸç†</h3><p>æ³¨æ„åŠ›æœºåˆ¶å®ç°äº†å¯¹åºåˆ—ä¿¡æ¯çš„æ™ºèƒ½é€‰æ‹©ï¼š</p>
<p><strong>æ³¨æ„åŠ›æƒé‡çš„å­¦ä¹ æœºåˆ¶</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„åŠ›æƒé‡è®¡ç®—çš„æ ¸å¿ƒé€»è¾‘</span></span><br><span class="line">similarity_scores = query @ keys.T  <span class="comment"># è®¡ç®—ç›¸ä¼¼åº¦</span></span><br><span class="line">attention_weights = softmax(similarity_scores)  <span class="comment"># å½’ä¸€åŒ–æƒé‡</span></span><br><span class="line">attended_features = attention_weights @ values  <span class="comment"># åŠ æƒèšåˆ</span></span><br></pre></td></tr></table></figure>

<p><strong>åŠ¨æ€èšç„¦çš„å®ç°åŸç†</strong>ï¼š</p>
<ul>
<li><strong>æŸ¥è¯¢é©±åŠ¨</strong>ï¼šæ¯ä¸ªæ—¶é—´æ­¥ä½œä¸ºæŸ¥è¯¢ï¼ŒåŠ¨æ€å…³æ³¨æ•´ä¸ªåºåˆ—</li>
<li><strong>ç›¸ä¼¼åº¦åŒ¹é…</strong>ï¼šå­¦ä¹ åˆ°çš„å˜æ¢çŸ©é˜µæ•è·æŸ¥è¯¢ä¸é”®çš„åŒ¹é…æ¨¡å¼</li>
<li><strong>è‡ªé€‚åº”æƒé‡</strong>ï¼šä¸åŒæƒ…æ„Ÿç±»åˆ«ä¸‹çš„æ³¨æ„åŠ›æ¨¡å¼è‡ªåŠ¨åˆ†åŒ–</li>
</ul>
<p><strong>æƒ…æ„Ÿå…³é”®ä¿¡æ¯çš„è¯†åˆ«</strong>ï¼š</p>
<ul>
<li><strong>éŸµå¾‹é‡ç‚¹</strong>ï¼šè‡ªåŠ¨å…³æ³¨è¯­è°ƒå˜åŒ–å‰§çƒˆçš„æ—¶é—´æ®µ</li>
<li><strong>è¯­ä¹‰å…³é”®è¯</strong>ï¼šèšç„¦äºå¸¦æœ‰å¼ºæƒ…æ„Ÿè‰²å½©çš„è¯æ±‡</li>
<li><strong>åœé¡¿æ¨¡å¼</strong>ï¼šè¯†åˆ«æƒ…æ„Ÿè¡¨è¾¾ä¸­çš„åœé¡¿å’ŒèŠ‚å¥å˜åŒ–</li>
</ul>
<h3 id="5-4-å…¨å±€æ± åŒ–çš„ä¿¡æ¯èšåˆç­–ç•¥"><a href="#5-4-å…¨å±€æ± åŒ–çš„ä¿¡æ¯èšåˆç­–ç•¥" class="headerlink" title="5.4 å…¨å±€æ± åŒ–çš„ä¿¡æ¯èšåˆç­–ç•¥"></a>5.4 å…¨å±€æ± åŒ–çš„ä¿¡æ¯èšåˆç­–ç•¥</h3><p>æœ€å¤§æ± åŒ–æ“ä½œå®ç°äº†ä»åºåˆ—åˆ°å…¨å±€ç‰¹å¾çš„è½¬æ¢ï¼š</p>
<p><strong>æœ€å¤§æ± åŒ–çš„é€‰æ‹©rationale</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ€å¤§æ± åŒ– vs å¹³å‡æ± åŒ–çš„å¯¹æ¯”</span></span><br><span class="line">max_pooled = F.max_pool1d(features, kernel_size=seq_len)  <span class="comment"># ä¿ç•™æœ€å¼ºä¿¡å·</span></span><br><span class="line">avg_pooled = F.avg_pool1d(features, kernel_size=seq_len)  <span class="comment"># å¹³å‡æ‰€æœ‰ä¿¡å·</span></span><br></pre></td></tr></table></figure>

<p><strong>æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>æ˜¾è‘—æ€§ä¿ç•™</strong>ï¼šæœ€å¤§æ± åŒ–ä¿ç•™æœ€å¼ºçš„æƒ…æ„Ÿæ¿€æ´»ä¿¡å·</li>
<li><strong>å™ªå£°æŠ‘åˆ¶</strong>ï¼šå¿½ç•¥å¼±æ¿€æ´»çš„å™ªå£°ä¿¡æ¯</li>
<li><strong>ä¸å˜æ€§</strong>ï¼šå¯¹åºåˆ—é•¿åº¦å˜åŒ–å…·æœ‰ä¸€å®šçš„é²æ£’æ€§</li>
</ul>
<hr>
<h2 id="6-ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°"><a href="#6-ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°" class="headerlink" title="6. ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°"></a>6. ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°</h2><h3 id="6-1-ç«¯åˆ°ç«¯å­¦ä¹ èŒƒå¼çš„æŠ€æœ¯çªç ´"><a href="#6-1-ç«¯åˆ°ç«¯å­¦ä¹ èŒƒå¼çš„æŠ€æœ¯çªç ´" class="headerlink" title="6.1 ç«¯åˆ°ç«¯å­¦ä¹ èŒƒå¼çš„æŠ€æœ¯çªç ´"></a>6.1 ç«¯åˆ°ç«¯å­¦ä¹ èŒƒå¼çš„æŠ€æœ¯çªç ´</h3><p><strong>ä¼ ç»Ÿæ–¹æ³•çš„å±€é™æ€§</strong>ï¼š</p>
<ul>
<li>æ‰‹å·¥ç‰¹å¾è®¾è®¡ä¾èµ–é¢†åŸŸä¸“å®¶çŸ¥è¯†</li>
<li>ç‰¹å¾æå–ä¸åˆ†ç±»å™¨åˆ†ç¦»è®­ç»ƒï¼Œæ— æ³•å®ç°å…¨å±€ä¼˜åŒ–</li>
<li>ç‰¹å¾è¡¨è¾¾èƒ½åŠ›å—é™äºäººå·¥è®¾è®¡çš„æƒ³è±¡åŠ›</li>
</ul>
<p><strong>ç«¯åˆ°ç«¯å­¦ä¹ çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>è‡ªåŠ¨ç‰¹å¾å­¦ä¹ </strong>ï¼šæ¨¡å‹è‡ªåŠ¨å‘ç°æœ€ä¼˜çš„ç‰¹å¾è¡¨ç¤º</li>
<li><strong>å…¨å±€ä¼˜åŒ–</strong>ï¼šä»åŸå§‹è¾“å…¥åˆ°æœ€ç»ˆè¾“å‡ºçš„è”åˆä¼˜åŒ–</li>
<li><strong>é€‚åº”æ€§å¼º</strong>ï¼šèƒ½å¤Ÿé€‚åº”ä¸åŒçš„æ•°æ®åˆ†å¸ƒå’Œä»»åŠ¡éœ€æ±‚</li>
</ul>
<h3 id="6-2-å¤šå±‚æ¬¡ç‰¹å¾èåˆçš„åˆ›æ–°è®¾è®¡"><a href="#6-2-å¤šå±‚æ¬¡ç‰¹å¾èåˆçš„åˆ›æ–°è®¾è®¡" class="headerlink" title="6.2 å¤šå±‚æ¬¡ç‰¹å¾èåˆçš„åˆ›æ–°è®¾è®¡"></a>6.2 å¤šå±‚æ¬¡ç‰¹å¾èåˆçš„åˆ›æ–°è®¾è®¡</h3><p><strong>ç‰¹å¾èåˆçš„å±‚æ¬¡ç»“æ„</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HuBERTç‰¹å¾(768ç»´) â†’ GRUæ—¶åºå»ºæ¨¡(512ç»´) â†’ æ³¨æ„åŠ›å¢å¼º â†’ å…¨å±€æ± åŒ– â†’ åˆ†ç±»è¾“å‡º</span><br></pre></td></tr></table></figure>

<p><strong>èåˆæœºåˆ¶çš„æŠ€æœ¯åˆ›æ–°</strong>ï¼š</p>
<ul>
<li><strong>è¯­ä¹‰-æ—¶åºèåˆ</strong>ï¼šHuBERTçš„è¯­ä¹‰ç‰¹å¾ä¸GRUçš„æ—¶åºå»ºæ¨¡ç›¸ç»“åˆ</li>
<li><strong>å±€éƒ¨-å…¨å±€èåˆ</strong>ï¼šæ³¨æ„åŠ›æœºåˆ¶å®ç°å±€éƒ¨ç‰¹å¾ä¸å…¨å±€ä¸Šä¸‹æ–‡çš„èåˆ</li>
<li><strong>é™æ€-åŠ¨æ€èåˆ</strong>ï¼šé™æ€çš„é¢„è®­ç»ƒç‰¹å¾ä¸åŠ¨æ€çš„åºåˆ—å»ºæ¨¡ç›¸ç»“åˆ</li>
</ul>
<h3 id="6-3-æ³¨æ„åŠ›å¢å¼ºæœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨"><a href="#6-3-æ³¨æ„åŠ›å¢å¼ºæœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨" class="headerlink" title="6.3 æ³¨æ„åŠ›å¢å¼ºæœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨"></a>6.3 æ³¨æ„åŠ›å¢å¼ºæœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨</h3><p><strong>æ³¨æ„åŠ›æœºåˆ¶åœ¨è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ä¸­çš„åˆ›æ–°åº”ç”¨</strong>ï¼š</p>
<ul>
<li><strong>æ—¶åºæ³¨æ„åŠ›</strong>ï¼šé’ˆå¯¹è¯­éŸ³çš„æ—¶åºç‰¹æ€§è®¾è®¡çš„æ³¨æ„åŠ›æœºåˆ¶</li>
<li><strong>æƒ…æ„Ÿèšç„¦</strong>ï¼šè‡ªåŠ¨è¯†åˆ«æƒ…æ„Ÿè¡¨è¾¾çš„å…³é”®æ—¶é—´æ®µ</li>
<li><strong>å¯è§£é‡Šæ€§</strong>ï¼šæ³¨æ„åŠ›æƒé‡æä¾›æ¨¡å‹å†³ç­–çš„å¯è§†åŒ–è§£é‡Š</li>
</ul>
<h3 id="6-4-å·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘"><a href="#6-4-å·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘" class="headerlink" title="6.4 å·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘"></a>6.4 å·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘</h3><p><strong>ç³»ç»Ÿå·¥ç¨‹åŒ–çš„å®Œæ•´æ€§</strong>ï¼š</p>
<ul>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šæ¸…æ™°çš„ä»£ç ç»“æ„ä¾¿äºç»´æŠ¤å’Œæ‰©å±•</li>
<li><strong>å®æ—¶å¤„ç†èƒ½åŠ›</strong>ï¼šæ”¯æŒéº¦å…‹é£å®æ—¶å½•éŸ³å’Œæƒ…æ„Ÿè¯†åˆ«</li>
<li><strong>ç”¨æˆ·å‹å¥½ç•Œé¢</strong>ï¼šå®Œæ•´çš„PyQt5å›¾å½¢ç•Œé¢</li>
<li><strong>è·¨å¹³å°å…¼å®¹</strong>ï¼šæ”¯æŒä¸åŒæ“ä½œç³»ç»Ÿçš„éƒ¨ç½²</li>
</ul>
<p><strong>éƒ¨ç½²ä¼˜åŒ–çš„æŠ€æœ¯ç»†èŠ‚</strong>ï¼š</p>
<ul>
<li><strong>æ¨¡å‹å‹ç¼©</strong>ï¼šé€šè¿‡é‡åŒ–ç­‰æŠ€æœ¯å‡å°‘æ¨¡å‹å¤§å°</li>
<li><strong>æ¨ç†åŠ é€Ÿ</strong>ï¼šGPUåŠ é€Ÿå’Œæ‰¹å¤„ç†ä¼˜åŒ–</li>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼šé«˜æ•ˆçš„éŸ³é¢‘ç¼“å†²å’Œç‰¹å¾ç¼“å­˜æœºåˆ¶</li>
</ul>
<h3 id="6-5-è¯„ä¼°æ–¹æ³•çš„ç§‘å­¦æ€§"><a href="#6-5-è¯„ä¼°æ–¹æ³•çš„ç§‘å­¦æ€§" class="headerlink" title="6.5 è¯„ä¼°æ–¹æ³•çš„ç§‘å­¦æ€§"></a>6.5 è¯„ä¼°æ–¹æ³•çš„ç§‘å­¦æ€§</h3><p><strong>5æŠ˜äº¤å‰éªŒè¯çš„ç»Ÿè®¡ä¸¥è°¨æ€§</strong>ï¼š</p>
<ul>
<li>ç¡®ä¿ç»“æœçš„ç»Ÿè®¡æ˜¾è‘—æ€§å’Œå¯é‡ç°æ€§</li>
<li>é¿å…æ•°æ®åˆ’åˆ†å¶ç„¶æ€§å¯¹ç»“æœçš„å½±å“</li>
<li>æä¾›æ¨¡å‹æ³›åŒ–èƒ½åŠ›çš„å¯é ä¼°è®¡</li>
</ul>
<p><strong>å¤šæŒ‡æ ‡è¯„ä¼°çš„å…¨é¢æ€§</strong>ï¼š</p>
<ul>
<li>å‡†ç¡®ç‡ã€å¬å›ç‡ã€F1åˆ†æ•°çš„ç»¼åˆè¯„ä¼°</li>
<li>æ··æ·†çŸ©é˜µåˆ†æå„ç±»åˆ«çš„è¯†åˆ«æ€§èƒ½</li>
<li>ç»Ÿè®¡æ£€éªŒç¡®ä¿ç»“æœçš„ç§‘å­¦æ€§</li>
</ul>
<hr>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¯¥IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿå±•ç°äº†ç°ä»£æ·±åº¦å­¦ä¹ åœ¨è¯­éŸ³å¤„ç†é¢†åŸŸçš„å…ˆè¿›æŠ€æœ¯åº”ç”¨ã€‚é€šè¿‡HuBERTé¢„è®­ç»ƒæ¨¡å‹çš„å¼ºå¤§ç‰¹å¾æå–èƒ½åŠ›ã€åŒå‘GRUçš„ç²¾ç¡®æ—¶åºå»ºæ¨¡ã€æ³¨æ„åŠ›æœºåˆ¶çš„æ™ºèƒ½èšç„¦ï¼Œä»¥åŠå…¨å±€æ± åŒ–çš„æœ‰æ•ˆä¿¡æ¯èšåˆï¼Œç³»ç»Ÿå®ç°äº†ä»åŸå§‹éŸ³é¢‘åˆ°æƒ…æ„Ÿç±»åˆ«çš„ç«¯åˆ°ç«¯å­¦ä¹ ã€‚</p>
<p>ç³»ç»Ÿçš„æŠ€æœ¯åˆ›æ–°ä½“ç°åœ¨å¤šä¸ªæ–¹é¢ï¼šè‡ªç›‘ç£é¢„è®­ç»ƒä¸ä¸‹æ¸¸ä»»åŠ¡çš„æœ‰æ•ˆç»“åˆã€å¤šå±‚æ¬¡ç‰¹å¾çš„æ·±åº¦èåˆã€æ³¨æ„åŠ›æœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨ï¼Œä»¥åŠå·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘ã€‚è¿™äº›è®¾è®¡ä¸ä»…ä¿è¯äº†æ¨¡å‹çš„é«˜æ€§èƒ½ï¼Œä¹Ÿä¸ºå®é™…åº”ç”¨æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚</p>
<p>é€šè¿‡æ·±å…¥çš„æºç åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç³»ç»Ÿä¸ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯å®ç°ï¼Œæ›´æ˜¯å¯¹è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«é¢†åŸŸå‰æ²¿æŠ€æœ¯çš„ç³»ç»Ÿæ€§æ•´åˆå’Œåˆ›æ–°æ€§åº”ç”¨ã€‚å®ƒä¸ºç›¸å…³ç ”ç©¶å’Œåº”ç”¨å¼€å‘æä¾›äº†å®è´µçš„å‚è€ƒå’Œå€Ÿé‰´ä»·å€¼ã€‚</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ«</p><p><a href="https://huangzhongqi978.top/2025/10/01/ä»£ç ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£/">https://huangzhongqi978.top/2025/10/01/ä»£ç ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>ä½œè€…</h6><p>HuangZhongqi</p></div></div><div class="level-item is-narrow"><div><h6>å‘å¸ƒäº</h6><p>2025-10-01</p></div></div><div class="level-item is-narrow"><div><h6>æ›´æ–°äº</h6><p>2025-10-01</p></div></div><div class="level-item is-narrow"><div><h6>è®¸å¯åè®®</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/GRU%E7%BB%93%E6%9E%84/">GRUç»“æ„</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=xxxx" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Ÿæ‰“èµä¸€ä¸‹ä½œè€…å§</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>æ”¯ä»˜å®</span><span class="qrcode"><img src="/img/alipay-qrcode.png" alt="æ”¯ä»˜å®"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>å¾®ä¿¡</span><span class="qrcode"><img src="/img/wechat-qrcode.png" alt="å¾®ä¿¡"></span></a><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="huangzhongqi978@gmail.com"><input type="hidden" name="currency_code" value="USD"></form></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2025/10/01/Yolo11%E4%BA%A4%E9%80%9A%E6%A0%87%E5%BF%97%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F/"><span class="level-item">Yolo11äº¤é€šæ ‡å¿—æ£€æµ‹ç³»ç»Ÿ</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">è¯„è®º</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://huangzhongqi978.top/2025/10/01/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3/';
            this.page.identifier = '2025/10/01/ä»£ç ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'huangzhongqi' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="HuangZhongqi"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">HuangZhongqi</p><p class="is-size-6 is-block">Deep Learning &amp; Computer Vision</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shandong, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">3</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Huangzhongqi978" target="_blank" rel="me noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/Huangzhongqi978"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="WeChat" href="/img/wechat.png"><i class="fab fa-weixin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="LinkedIn" href="https://linkedin.com/in/huangzhongqi"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Email" href="mailto:huangzhongqi978@gmail.com"><i class="fas fa-envelope"></i></a></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-10-01T08:40:31.000Z">2025-10-01</time></p><p class="title"><a href="/2025/10/01/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3/">åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ«</a></p><p class="categories"><a href="/categories/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86/">è‡ªç„¶è¯­è¨€å¤„ç†</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-10-01T07:59:31.000Z">2025-10-01</time></p><p class="title"><a href="/2025/10/01/Yolo11%E4%BA%A4%E9%80%9A%E6%A0%87%E5%BF%97%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F/">Yolo11äº¤é€šæ ‡å¿—æ£€æµ‹ç³»ç»Ÿ</a></p><p class="categories"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/">è®¡ç®—æœºè§†è§‰</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-10-01T07:14:18.591Z">2025-10-01</time></p><p class="title"><a href="/2025/10/01/hello-world/">Hello World</a></p></div></article></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">åˆ†ç±»</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86/"><span class="level-start"><span class="level-item">è‡ªç„¶è¯­è¨€å¤„ç†</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"><span class="level-start"><span class="level-item">è®¡ç®—æœºè§†è§‰</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/GRU%E7%BB%93%E6%9E%84/"><span class="tag">GRUç»“æ„</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/me/"><span class="tag">me</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/yolo%E6%A8%A1%E5%9E%8B/"><span class="tag">yoloæ¨¡å‹</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Brahmacaryaå¥‡å¥‡" height="28"></a><p class="is-size-7"><span>&copy; 2025 HuangZhongqi</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">Â© 2025 Brahmacaryaå¥‡å¥‡</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/Huangzhongqi978"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'folded'
                }
            }
        };</script><script><script data-particles-config type="application/json">{"particleCount":80,"particleColor":"#1e88e5","particleSize":2,"lineColor":"#1e88e5","lineWidth":1,"lineDistance":120,"speed":0.5,"opacity":0.6,"mobileOptimized":true,"interactive":true,"hoverEffect":true}</script></script><script data-pjax src="/js/column.js"></script><!--!--><script data-pjax src="/js/main.js" defer></script><script data-pjax src="/js/particles.js" defer></script><script data-pjax src="/js/modern-effects.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>