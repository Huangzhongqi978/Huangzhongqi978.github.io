<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><meta name="referrer" content="no-referrer"><title>åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ« | å¥‡ç‚¹æ™ºåº“ SingularityMind</title><meta name="author" content="HuangZhongqi"><meta name="copyright" content="HuangZhongqi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f5f0fa"><meta name="description" content="GRUæ¶æ„ä¸‹çš„è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«">
<meta property="og:type" content="article">
<meta property="og:title" content="åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ«">
<meta property="og:url" content="https://huangzhongqi978.top/2024/10/05/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3/">
<meta property="og:site_name" content="å¥‡ç‚¹æ™ºåº“ SingularityMind">
<meta property="og:description" content="GRUæ¶æ„ä¸‹çš„è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/huangzhongqi776/my-images/raw/master/20251103161022855.png">
<meta property="article:published_time" content="2024-10-05T08:40:31.000Z">
<meta property="article:modified_time" content="2025-11-03T08:35:31.262Z">
<meta property="article:author" content="HuangZhongqi">
<meta property="article:tag" content="GRUç»“æ„">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/huangzhongqi776/my-images/raw/master/20251103161022855.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ«",
  "url": "https://huangzhongqi978.top/2024/10/05/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3/",
  "image": "https://gitee.com/huangzhongqi776/my-images/raw/master/20251103161022855.png",
  "datePublished": "2024-10-05T08:40:31.000Z",
  "dateModified": "2025-11-03T08:35:31.262Z",
  "author": [
    {
      "@type": "Person",
      "name": "HuangZhongqi",
      "url": "https://huangzhongqi978.top"
    }
  ]
}</script><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/img/logo.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/logo.png"><link rel="icon" type="image/png" href="/img/logo.png"><link rel="apple-touch-icon" sizes="180x180" href="/img/logo.png"><link rel="apple-touch-icon" href="/img/logo.png"><link rel="canonical" href="https://huangzhongqi978.top/2024/10/05/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3/"><link rel="preconnect" href="//unpkg.com"/><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="/css/qr-modal.css"><link rel="stylesheet" href="/css/reading-progress.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        try {
          const parsed = JSON.parse(itemStr)
          // å¦‚æœæ˜¯æ–°æ ¼å¼ï¼ˆåŒ…å« value å’Œ expiryï¼‰
          if (parsed && typeof parsed === 'object' && 'value' in parsed) {
            if ('expiry' in parsed && Date.now() > parsed.expiry) {
              localStorage.removeItem(key)
              return undefined
            }
            return parsed.value
          }
          // å¦‚æœæ˜¯æ—§æ ¼å¼ï¼ˆçº¯å­—ç¬¦ä¸²ï¼‰ï¼Œç›´æ¥è¿”å›
          return parsed
        } catch (e) {
          // å¦‚æœä¸æ˜¯æœ‰æ•ˆçš„ JSONï¼Œå¯èƒ½æ˜¯æ—§æ ¼å¼çš„å­—ç¬¦ä¸²å€¼ï¼Œç›´æ¥è¿”å›
          return itemStr
        }
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#2d0a3d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f5f0fa')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":true,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://unpkg.com/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ«',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}
window.mouseTrailConfig = { enable: true, lineWidth: 2, trailLength: 20, mobile: false };</script><link rel="stylesheet" href="/css/custom-font.css"><link rel="stylesheet" href="/css/index-header-fix.css"><link rel="stylesheet" href="/css/background-fix.css"><link rel="stylesheet" href="/css/header-transparent.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(https://raw.githubusercontent.com/Huangzhongqi978/my-images/main/img/bg.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://gitee.com/huangzhongqi776/my-images/raw/master/ff71db1967b4c412f794ffe33ef624f.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/ referrerpolicy="no-referrer"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">48</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">20</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/tags/YOLO/"><i class="fa-fw fas fa-eye"></i><span> YOLO</span></a></div><div class="menus_item"><a class="site-page" href="/tags/NLP/"><i class="fa-fw fas fa-language"></i><span> NLP</span></a></div><div class="menus_item"><a class="site-page" href="/tags/LLM/"><i class="fa-fw fas fa-brain"></i><span> LLM</span></a></div><div class="menus_item"><a class="site-page" href="/tags/Python/"><i class="fa-fw fab fa-python"></i><span> Python</span></a></div><div class="menus_item"><a class="site-page" href="/tags/Java/"><i class="fa-fw fab fa-java"></i><span> Java</span></a></div><div class="menus_item"><a class="site-page" href="/tags/C++.html"><i class="fa-fw fas fa-code"></i><span> C++</span></a></div><div class="menus_item"><a class="site-page" href="/tags/CV.html"><i class="fa-fw fas fa-camera"></i><span> CV</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user-circle"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://gitee.com/huangzhongqi776/my-images/raw/master/20251103161022855.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">å¥‡ç‚¹æ™ºåº“ SingularityMind</span></a><a class="nav-page-title" href="/"><span class="site-name">åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ«</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/tags/YOLO/"><i class="fa-fw fas fa-eye"></i><span> YOLO</span></a></div><div class="menus_item"><a class="site-page" href="/tags/NLP/"><i class="fa-fw fas fa-language"></i><span> NLP</span></a></div><div class="menus_item"><a class="site-page" href="/tags/LLM/"><i class="fa-fw fas fa-brain"></i><span> LLM</span></a></div><div class="menus_item"><a class="site-page" href="/tags/Python/"><i class="fa-fw fab fa-python"></i><span> Python</span></a></div><div class="menus_item"><a class="site-page" href="/tags/Java/"><i class="fa-fw fab fa-java"></i><span> Java</span></a></div><div class="menus_item"><a class="site-page" href="/tags/C++.html"><i class="fa-fw fas fa-code"></i><span> C++</span></a></div><div class="menus_item"><a class="site-page" href="/tags/CV.html"><i class="fa-fw fas fa-camera"></i><span> CV</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user-circle"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">åŸºäºGRUçš„è¯­éŸ³æƒ…æ„Ÿåˆ†æè¯†åˆ«</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-10-05T08:40:31.000Z" title="å‘è¡¨äº 2024-10-05 16:40:31">2024-10-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-11-03T08:35:31.262Z" title="æ›´æ–°äº 2025-11-03 16:35:31">2025-11-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86/">è‡ªç„¶è¯­è¨€å¤„ç†</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">10.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>39åˆ†é’Ÿ</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>GRUæ¶æ„ä¸‹çš„è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«</p>
<span id="more"></span>

<h1 id="æƒ…æ„Ÿè¯†åˆ«æ¨¡å‹ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£"><a href="#æƒ…æ„Ÿè¯†åˆ«æ¨¡å‹ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£" class="headerlink" title="æƒ…æ„Ÿè¯†åˆ«æ¨¡å‹ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£"></a>æƒ…æ„Ÿè¯†åˆ«æ¨¡å‹ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£</h1><h2 id="ğŸ“‹-ç›®å½•"><a href="#ğŸ“‹-ç›®å½•" class="headerlink" title="ğŸ“‹ ç›®å½•"></a>ğŸ“‹ ç›®å½•</h2><ol>
<li><a href="#%E6%A6%82%E8%BF%B0">æ¦‚è¿°</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8C%96%E6%8A%80%E6%9C%AF">æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E8%AF%A6%E8%A7%A3">ä»£ç å®ç°è¯¦è§£</a></li>
<li><a href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E">å‚æ•°é…ç½®è¯´æ˜</a></li>
<li><a href="#%E8%AE%AD%E7%BB%83%E7%AD%96%E7%95%A5%E4%BC%98%E5%8C%96">è®­ç»ƒç­–ç•¥ä¼˜åŒ–</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96">æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–</a></li>
</ol>
<hr>
<h2 id="ğŸ“–-æ¦‚è¿°"><a href="#ğŸ“–-æ¦‚è¿°" class="headerlink" title="ğŸ“– æ¦‚è¿°"></a>ğŸ“– æ¦‚è¿°</h2><p>æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†IEMOCAPæƒ…æ„Ÿè¯†åˆ«æ¨¡å‹çš„æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯ï¼Œä¸»è¦è§£å†³è·¨è¯´è¯äººæƒ…æ„Ÿè¯†åˆ«ä¸­çš„æ³›åŒ–èƒ½åŠ›é—®é¢˜ã€‚ä¼˜åŒ–ç­–ç•¥åŒ…æ‹¬è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯ã€é«˜çº§è®­ç»ƒç­–ç•¥å’Œç»¼åˆæŸå¤±å‡½æ•°è®¾è®¡ã€‚</p>
<h3 id="ä¸»è¦ä¼˜åŒ–ç›®æ ‡"><a href="#ä¸»è¦ä¼˜åŒ–ç›®æ ‡" class="headerlink" title="ä¸»è¦ä¼˜åŒ–ç›®æ ‡"></a>ä¸»è¦ä¼˜åŒ–ç›®æ ‡</h3><ul>
<li>ğŸ¯ <strong>æå‡è·¨è¯´è¯äººæ³›åŒ–èƒ½åŠ›</strong>ï¼šæ¶ˆé™¤è¯´è¯äººç‰¹å¾å¯¹æƒ…æ„Ÿè¯†åˆ«çš„å¹²æ‰°</li>
<li>ğŸ“ˆ <strong>å¢å¼ºæ¨¡å‹é²æ£’æ€§</strong>ï¼šé€šè¿‡å¤šç§æ­£åˆ™åŒ–å’Œæ•°æ®å¢å¼ºæŠ€æœ¯</li>
<li>âš¡ <strong>ä¼˜åŒ–è®­ç»ƒæ•ˆç‡</strong>ï¼šé‡‡ç”¨å…ˆè¿›çš„å­¦ä¹ ç‡è°ƒåº¦å’Œæ—©åœç­–ç•¥</li>
<li>ğŸ” <strong>æä¾›å…¨é¢ç›‘æ§</strong>ï¼šå®æ—¶å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹å’Œæ¨¡å‹æ€§èƒ½</li>
</ul>
<hr>
<h2 id="ğŸ”§-æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯"><a href="#ğŸ”§-æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯" class="headerlink" title="ğŸ”§ æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯"></a>ğŸ”§ æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯</h2><h3 id="1-è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯"><a href="#1-è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯" class="headerlink" title="1. è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯"></a>1. è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯</h3><h4 id="1-1-è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ–-AdaIN"><a href="#1-1-è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ–-AdaIN" class="headerlink" title="1.1 è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ– (AdaIN)"></a>1.1 è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ– (AdaIN)</h4><p><strong>åŸç†</strong>ï¼šé€šè¿‡å®ä¾‹çº§åˆ«çš„å½’ä¸€åŒ–æ¶ˆé™¤ä¸åŒè¯´è¯äººçš„éŸ³é¢‘ç‰¹å¾å·®å¼‚ï¼Œä¿ç•™æƒ…æ„Ÿç›¸å…³ä¿¡æ¯ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">AdaptiveInstanceNormalization</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ– - è¯´è¯äººå½’ä¸€åŒ–å±‚
    
    åŸç†ï¼š
    1. è®¡ç®—æ¯ä¸ªæ ·æœ¬åœ¨æ—¶åºç»´åº¦ä¸Šçš„å‡å€¼å’Œæ–¹å·®
    2. è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œæ¶ˆé™¤è¯´è¯äººç‰¹å¾å·®å¼‚
    3. é€šè¿‡å¯å­¦ä¹ å‚æ•°é‡æ–°ç¼©æ”¾ï¼Œä¿ç•™æƒ…æ„Ÿä¿¡æ¯
    
    æ•°å­¦å…¬å¼ï¼š
    Î¼ = mean(x, dim=1)  # æ—¶åºç»´åº¦å‡å€¼
    ÏƒÂ² = var(x, dim=1)  # æ—¶åºç»´åº¦æ–¹å·®
    x_norm = (x - Î¼) / âˆš(ÏƒÂ² + Îµ)  # å½’ä¸€åŒ–
    output = Î³ * x_norm + Î²  # ä»¿å°„å˜æ¢
    """</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_features<span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e-5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>AdaptiveInstanceNormalization<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>num_features <span class="token operator">=</span> num_features
        self<span class="token punctuation">.</span>eps <span class="token operator">=</span> eps  <span class="token comment"># æ•°å€¼ç¨³å®šæ€§å‚æ•°</span>
        
        <span class="token comment"># å¯å­¦ä¹ çš„ç¼©æ”¾å’Œåç§»å‚æ•°</span>
        self<span class="token punctuation">.</span>weight <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>num_features<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># Î³ ç¼©æ”¾å‚æ•°</span>
        self<span class="token punctuation">.</span>bias <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>num_features<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># Î² åç§»å‚æ•°</span>
        
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        å‰å‘ä¼ æ’­
        Args:
            x: [batch_size, seq_len, num_features] è¾“å…¥ç‰¹å¾
        Returns:
            å½’ä¸€åŒ–åçš„ç‰¹å¾
        """</span>
        <span class="token comment"># è®¡ç®—å®ä¾‹çº§åˆ«çš„å‡å€¼å’Œæ–¹å·®ï¼ˆè·¨åºåˆ—ç»´åº¦ï¼‰</span>
        mean <span class="token operator">=</span> x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># [batch_size, 1, num_features]</span>
        var <span class="token operator">=</span> x<span class="token punctuation">.</span>var<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> unbiased<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># [batch_size, 1, num_features]</span>
        
        <span class="token comment"># å½’ä¸€åŒ–å¤„ç†</span>
        x_norm <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">/</span> torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>var <span class="token operator">+</span> self<span class="token punctuation">.</span>eps<span class="token punctuation">)</span>
        
        <span class="token comment"># åº”ç”¨å¯å­¦ä¹ çš„ä»¿å°„å˜æ¢</span>
        out <span class="token operator">=</span> x_norm <span class="token operator">*</span> self<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> out<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å…³é”®å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>num_features</code>: ç‰¹å¾ç»´åº¦æ•°é‡</li>
<li><code>eps</code>: æ•°å€¼ç¨³å®šæ€§å‚æ•°ï¼Œé˜²æ­¢é™¤é›¶é”™è¯¯</li>
<li><code>weight</code>: å¯å­¦ä¹ çš„ç¼©æ”¾å‚æ•°Î³</li>
<li><code>bias</code>: å¯å­¦ä¹ çš„åç§»å‚æ•°Î²</li>
</ul>
<h4 id="1-2-æ¢¯åº¦åè½¬å¯¹æŠ—è®­ç»ƒ"><a href="#1-2-æ¢¯åº¦åè½¬å¯¹æŠ—è®­ç»ƒ" class="headerlink" title="1.2 æ¢¯åº¦åè½¬å¯¹æŠ—è®­ç»ƒ"></a>1.2 æ¢¯åº¦åè½¬å¯¹æŠ—è®­ç»ƒ</h4><p><strong>åŸç†</strong>ï¼šé€šè¿‡æ¢¯åº¦åè½¬å±‚å®ç°å¯¹æŠ—è®­ç»ƒï¼Œè¿«ä½¿æ¨¡å‹å­¦ä¹ è¯´è¯äººæ— å…³çš„ç‰¹å¾è¡¨ç¤ºã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">GradientReversalLayer</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>autograd<span class="token punctuation">.</span>Function<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    æ¢¯åº¦åè½¬å±‚ - å¯¹æŠ—è®­ç»ƒæ ¸å¿ƒç»„ä»¶
    
    åŸç†ï¼š
    1. å‰å‘ä¼ æ’­ï¼šæ­£å¸¸ä¼ é€’ç‰¹å¾ï¼Œä¸åšä»»ä½•æ”¹å˜
    2. åå‘ä¼ æ’­ï¼šå°†æ¢¯åº¦ä¹˜ä»¥è´Ÿçš„ç¼©æ”¾å› å­Î±
    3. æ•ˆæœï¼šä½¿æ¨¡å‹æ— æ³•ä»ç‰¹å¾ä¸­è¯†åˆ«è¯´è¯äººèº«ä»½
    
    æ•°å­¦è¡¨ç¤ºï¼š
    forward: y = x
    backward: âˆ‚L/âˆ‚x = -Î± * âˆ‚L/âˆ‚y
    """</span>
    
    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> x<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        å‰å‘ä¼ æ’­ï¼šç›´æ¥ä¼ é€’è¾“å…¥
        Args:
            x: è¾“å…¥ç‰¹å¾
            alpha: æ¢¯åº¦åè½¬å¼ºåº¦
        """</span>
        ctx<span class="token punctuation">.</span>alpha <span class="token operator">=</span> alpha  <span class="token comment"># ä¿å­˜alphaç”¨äºåå‘ä¼ æ’­</span>
        <span class="token keyword">return</span> x<span class="token punctuation">.</span>view_as<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    
    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">backward</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> grad_output<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        åå‘ä¼ æ’­ï¼šæ¢¯åº¦ç¬¦å·åè½¬
        Args:
            grad_output: æ¥è‡ªä¸Šå±‚çš„æ¢¯åº¦
        Returns:
            åè½¬åçš„æ¢¯åº¦
        """</span>
        <span class="token keyword">return</span> grad_output<span class="token punctuation">.</span>neg<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> ctx<span class="token punctuation">.</span>alpha<span class="token punctuation">,</span> <span class="token boolean">None</span>

<span class="token keyword">def</span> <span class="token function">gradient_reverse</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""æ¢¯åº¦åè½¬å‡½æ•°åŒ…è£…å™¨"""</span>
    <span class="token keyword">return</span> GradientReversalLayer<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>è¯´è¯äººåˆ†ç±»å™¨</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># è¯´è¯äººåˆ†ç±»å¤´ï¼ˆç”¨äºå¯¹æŠ—è®­ç»ƒï¼‰</span>
<span class="token keyword">if</span> self<span class="token punctuation">.</span>use_adversarial<span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>speaker_classifier <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> hidden_size<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment"># ç‰¹å¾é™ç»´</span>
        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token comment"># éçº¿æ€§æ¿€æ´»</span>
        nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout_rate<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token comment"># é˜²è¿‡æ‹Ÿåˆ</span>
        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size<span class="token punctuation">,</span> hidden_size <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token comment"># è¿›ä¸€æ­¥é™ç»´</span>
        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout_rate<span class="token punctuation">)</span><span class="token punctuation">,</span>
        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>              <span class="token comment"># 10ä¸ªè¯´è¯äººåˆ†ç±»</span>
    <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶"><a href="#2-å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="2. å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶"></a>2. å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶</h3><p><strong>åŸç†</strong>ï¼šé€šè¿‡å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶æ•è·åºåˆ—ä¸­çš„é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œå¢å¼ºæƒ…æ„Ÿç‰¹å¾è¡¨ç¤ºã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MultiHeadSelfAttention</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶
    
    åŸç†ï¼š
    1. å°†è¾“å…¥ç‰¹å¾åˆ†åˆ«æŠ•å½±åˆ°Qã€Kã€Vç©ºé—´
    2. è®¡ç®—å¤šä¸ªæ³¨æ„åŠ›å¤´çš„æ³¨æ„åŠ›æƒé‡
    3. åŠ æƒèšåˆç‰¹å¾ä¿¡æ¯
    4. é€šè¿‡æ®‹å·®è¿æ¥å’Œå±‚å½’ä¸€åŒ–ç¨³å®šè®­ç»ƒ
    
    æ³¨æ„åŠ›å…¬å¼ï¼š
    Attention(Q,K,V) = softmax(QK^T/âˆšd_k)V
    MultiHead = Concat(head_1, ..., head_h)W^O
    """</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>MultiHeadSelfAttention<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> d_model <span class="token operator">%</span> num_heads <span class="token operator">==</span> <span class="token number">0</span>
        
        self<span class="token punctuation">.</span>d_model <span class="token operator">=</span> d_model          <span class="token comment"># æ¨¡å‹ç»´åº¦</span>
        self<span class="token punctuation">.</span>num_heads <span class="token operator">=</span> num_heads      <span class="token comment"># æ³¨æ„åŠ›å¤´æ•°é‡</span>
        self<span class="token punctuation">.</span>d_k <span class="token operator">=</span> d_model <span class="token operator">//</span> num_heads <span class="token comment"># æ¯ä¸ªå¤´çš„ç»´åº¦</span>
        
        <span class="token comment"># çº¿æ€§æŠ•å½±å±‚</span>
        self<span class="token punctuation">.</span>w_q <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>  <span class="token comment"># QueryæŠ•å½±</span>
        self<span class="token punctuation">.</span>w_k <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>  <span class="token comment"># KeyæŠ•å½±</span>
        self<span class="token punctuation">.</span>w_v <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>  <span class="token comment"># ValueæŠ•å½±</span>
        self<span class="token punctuation">.</span>w_o <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>d_model<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>  <span class="token comment"># è¾“å‡ºæŠ•å½±</span>
        
        <span class="token comment"># æ­£åˆ™åŒ–å±‚</span>
        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>dropout<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layer_norm <span class="token operator">=</span> nn<span class="token punctuation">.</span>LayerNorm<span class="token punctuation">(</span>d_model<span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        å‰å‘ä¼ æ’­
        Args:
            x: [batch_size, seq_len, d_model] è¾“å…¥ç‰¹å¾
        Returns:
            æ³¨æ„åŠ›å¢å¼ºåçš„ç‰¹å¾å’Œæ³¨æ„åŠ›æƒé‡
        """</span>
        batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> d_model <span class="token operator">=</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># ä¿å­˜æ®‹å·®è¿æ¥</span>
        residual <span class="token operator">=</span> x
        
        <span class="token comment"># 1. çº¿æ€§æŠ•å½±åˆ°Qã€Kã€V</span>
        Q <span class="token operator">=</span> self<span class="token punctuation">.</span>w_q<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_heads<span class="token punctuation">,</span> self<span class="token punctuation">.</span>d_k<span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        K <span class="token operator">=</span> self<span class="token punctuation">.</span>w_k<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_heads<span class="token punctuation">,</span> self<span class="token punctuation">.</span>d_k<span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        V <span class="token operator">=</span> self<span class="token punctuation">.</span>w_v<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_heads<span class="token punctuation">,</span> self<span class="token punctuation">.</span>d_k<span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 2. è®¡ç®—ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›</span>
        attention_scores <span class="token operator">=</span> torch<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>Q<span class="token punctuation">,</span> K<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>self<span class="token punctuation">.</span>d_k<span class="token punctuation">)</span>
        attention_weights <span class="token operator">=</span> F<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>attention_scores<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        attention_weights <span class="token operator">=</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>attention_weights<span class="token punctuation">)</span>
        
        <span class="token comment"># 3. åŠ æƒèšåˆValue</span>
        context <span class="token operator">=</span> torch<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>attention_weights<span class="token punctuation">,</span> V<span class="token punctuation">)</span>
        
        <span class="token comment"># 4. æ‹¼æ¥å¤šå¤´è¾“å‡º</span>
        context <span class="token operator">=</span> context<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>
            batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> self<span class="token punctuation">.</span>d_model
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 5. è¾“å‡ºæŠ•å½±</span>
        output <span class="token operator">=</span> self<span class="token punctuation">.</span>w_o<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
        
        <span class="token comment"># 6. æ®‹å·®è¿æ¥å’Œå±‚å½’ä¸€åŒ–</span>
        output <span class="token operator">=</span> self<span class="token punctuation">.</span>layer_norm<span class="token punctuation">(</span>output <span class="token operator">+</span> residual<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> output<span class="token punctuation">,</span> attention_weights<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># è¿”å›å¹³å‡æ³¨æ„åŠ›æƒé‡ç”¨äºå¯è§†åŒ–</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-ä½ç½®ç¼–ç "><a href="#3-ä½ç½®ç¼–ç " class="headerlink" title="3. ä½ç½®ç¼–ç "></a>3. ä½ç½®ç¼–ç </h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">PositionalEncoding</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    æ­£å¼¦ä½ç½®ç¼–ç 
    
    åŸç†ï¼š
    ä½¿ç”¨ä¸åŒé¢‘ç‡çš„æ­£å¼¦å’Œä½™å¼¦å‡½æ•°ä¸ºåºåˆ—ä¸­çš„æ¯ä¸ªä½ç½®ç”Ÿæˆå”¯ä¸€çš„ç¼–ç 
    
    å…¬å¼ï¼š
    PE(pos, 2i) = sin(pos / 10000^(2i/d_model))
    PE(pos, 2i+1) = cos(pos / 10000^(2i/d_model))
    """</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>PositionalEncoding<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># åˆ›å»ºä½ç½®ç¼–ç çŸ©é˜µ</span>
        pe <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>max_length<span class="token punctuation">,</span> d_model<span class="token punctuation">)</span>
        position <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> max_length<span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># è®¡ç®—é™¤æ•°é¡¹</span>
        div_term <span class="token operator">=</span> torch<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> d_model<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>
                            <span class="token operator">-</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">10000.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> d_model<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># åº”ç”¨æ­£å¼¦å’Œä½™å¼¦å‡½æ•°</span>
        pe<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>position <span class="token operator">*</span> div_term<span class="token punctuation">)</span>  <span class="token comment"># å¶æ•°ä½ç½®ä½¿ç”¨sin</span>
        pe<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>position <span class="token operator">*</span> div_term<span class="token punctuation">)</span>  <span class="token comment"># å¥‡æ•°ä½ç½®ä½¿ç”¨cos</span>
        
        self<span class="token punctuation">.</span>register_buffer<span class="token punctuation">(</span><span class="token string">'pe'</span><span class="token punctuation">,</span> pe<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""æ·»åŠ ä½ç½®ç¼–ç åˆ°è¾“å…¥ç‰¹å¾"""</span>
        seq_len <span class="token operator">=</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        pos_encoding <span class="token operator">=</span> self<span class="token punctuation">.</span>pe<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>seq_len<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>x<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x <span class="token operator">+</span> pos_encoding<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="ğŸ—ï¸-ä»£ç å®ç°è¯¦è§£"><a href="#ğŸ—ï¸-ä»£ç å®ç°è¯¦è§£" class="headerlink" title="ğŸ—ï¸ ä»£ç å®ç°è¯¦è§£"></a>ğŸ—ï¸ ä»£ç å®ç°è¯¦è§£</h2><h3 id="1-å¢å¼ºGRUæ¨¡å‹æ¶æ„"><a href="#1-å¢å¼ºGRUæ¨¡å‹æ¶æ„" class="headerlink" title="1. å¢å¼ºGRUæ¨¡å‹æ¶æ„"></a>1. å¢å¼ºGRUæ¨¡å‹æ¶æ„</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">EnhancedGRUModel</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    å¢å¼ºçš„GRUæ¨¡å‹ - é’ˆå¯¹è·¨è¯´è¯äººæƒ…æ„Ÿè¯†åˆ«ä¼˜åŒ–
    
    æ¶æ„ç‰¹ç‚¹ï¼š
    1. è¾“å…¥æŠ•å½± + ä½ç½®ç¼–ç 
    2. è¯´è¯äººå½’ä¸€åŒ–å±‚ (AdaIN)
    3. å¤šå±‚åŒå‘GRU + å±‚å½’ä¸€åŒ– + æ®‹å·®è¿æ¥
    4. å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶
    5. ç‰¹å¾å¢å¼ºæ¨¡å—
    6. åŒè·¯åˆ†ç±»å¤´ï¼ˆæƒ…æ„Ÿ + è¯´è¯äººå¯¹æŠ—ï¼‰
    """</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">,</span> output_size<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>EnhancedGRUModel<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># åŸºç¡€å‚æ•°</span>
        self<span class="token punctuation">.</span>input_size <span class="token operator">=</span> input_size
        self<span class="token punctuation">.</span>hidden_size <span class="token operator">=</span> hidden_size
        self<span class="token punctuation">.</span>output_size <span class="token operator">=</span> output_size
        self<span class="token punctuation">.</span>num_layers <span class="token operator">=</span> args<span class="token punctuation">.</span>dia_layers
        self<span class="token punctuation">.</span>dropout_rate <span class="token operator">=</span> args<span class="token punctuation">.</span>dropout
        
        <span class="token comment"># åŠŸèƒ½å¼€å…³</span>
        self<span class="token punctuation">.</span>use_attention <span class="token operator">=</span> args<span class="token punctuation">.</span>attention
        self<span class="token punctuation">.</span>use_speaker_norm <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token string">'speaker_norm'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>use_adversarial <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token string">'speaker_adversarial'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 1. è¾“å…¥å¤„ç†å±‚</span>
        self<span class="token punctuation">.</span>input_projection <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> hidden_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pos_encoding <span class="token operator">=</span> PositionalEncoding<span class="token punctuation">(</span>hidden_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 2. è¯´è¯äººå½’ä¸€åŒ–å±‚</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_speaker_norm<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>speaker_norm <span class="token operator">=</span> AdaptiveInstanceNormalization<span class="token punctuation">(</span>hidden_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 3. å¤šå±‚åŒå‘GRU</span>
        self<span class="token punctuation">.</span>gru_layers <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>layer_norms <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_layers<span class="token punctuation">)</span><span class="token punctuation">:</span>
            input_dim <span class="token operator">=</span> hidden_size <span class="token operator">*</span> <span class="token number">2</span> <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> hidden_size <span class="token operator">*</span> <span class="token number">4</span>
            self<span class="token punctuation">.</span>gru_layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                nn<span class="token punctuation">.</span>GRU<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> hidden_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                      bidirectional<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> dropout<span class="token operator">=</span>self<span class="token punctuation">.</span>dropout_rate <span class="token keyword">if</span> i <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>num_layers<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>layer_norms<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>LayerNorm<span class="token punctuation">(</span>hidden_size <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 4. å¤šå¤´è‡ªæ³¨æ„åŠ›</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_attention<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>self_attention <span class="token operator">=</span> MultiHeadSelfAttention<span class="token punctuation">(</span>
                d_model<span class="token operator">=</span>hidden_size <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> 
                num_heads<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> 
                dropout<span class="token operator">=</span>self<span class="token punctuation">.</span>dropout_rate
            <span class="token punctuation">)</span>
        
        <span class="token comment"># 5. ç‰¹å¾å¢å¼ºæ¨¡å—</span>
        self<span class="token punctuation">.</span>feature_enhancement <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> hidden_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout_rate<span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> hidden_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout_rate<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 6. å…¨å±€æ± åŒ–ç­–ç•¥</span>
        self<span class="token punctuation">.</span>global_pooling <span class="token operator">=</span> nn<span class="token punctuation">.</span>AdaptiveAvgPool1d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>      <span class="token comment"># å¹³å‡æ± åŒ–</span>
        self<span class="token punctuation">.</span>global_max_pooling <span class="token operator">=</span> nn<span class="token punctuation">.</span>AdaptiveMaxPool1d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment"># æœ€å¤§æ± åŒ–</span>
        
        <span class="token comment"># 7. æƒ…æ„Ÿåˆ†ç±»å¤´</span>
        self<span class="token punctuation">.</span>emotion_classifier <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> hidden_size<span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout_rate<span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size<span class="token punctuation">,</span> hidden_size <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout_rate<span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> output_size<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 8. è¯´è¯äººåˆ†ç±»å¤´ï¼ˆå¯¹æŠ—è®­ç»ƒï¼‰</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_adversarial<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>speaker_classifier <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
                nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> hidden_size<span class="token punctuation">)</span><span class="token punctuation">,</span>
                nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout_rate<span class="token punctuation">)</span><span class="token punctuation">,</span>
                nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size<span class="token punctuation">,</span> hidden_size <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout_rate<span class="token punctuation">)</span><span class="token punctuation">,</span>
                nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># IEMOCAPæœ‰10ä¸ªè¯´è¯äºº</span>
            <span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout_rate<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_init_weights<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-å‰å‘ä¼ æ’­æµç¨‹"><a href="#2-å‰å‘ä¼ æ’­æµç¨‹" class="headerlink" title="2. å‰å‘ä¼ æ’­æµç¨‹"></a>2. å‰å‘ä¼ æ’­æµç¨‹</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    å‰å‘ä¼ æ’­
    
    Args:
        x: [batch_size, seq_len, input_size] è¾“å…¥ç‰¹å¾
        alpha: æ¢¯åº¦åè½¬å¼ºåº¦ï¼ˆç”¨äºå¯¹æŠ—è®­ç»ƒï¼‰
    
    Returns:
        dict: åŒ…å«æƒ…æ„Ÿå’Œè¯´è¯äººé¢„æµ‹ç»“æœçš„å­—å…¸
    """</span>
    batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> _ <span class="token operator">=</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. è¾“å…¥æŠ•å½±å’Œä½ç½®ç¼–ç </span>
    x <span class="token operator">=</span> self<span class="token punctuation">.</span>input_projection<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment"># [batch_size, seq_len, hidden_size*2]</span>
    x <span class="token operator">=</span> self<span class="token punctuation">.</span>pos_encoding<span class="token punctuation">(</span>x<span class="token punctuation">)</span>      <span class="token comment"># æ·»åŠ ä½ç½®ä¿¡æ¯</span>
    
    <span class="token comment"># 2. è¯´è¯äººå½’ä¸€åŒ–ï¼ˆæ¶ˆé™¤è¯´è¯äººç‰¹å¾ï¼‰</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_speaker_norm<span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>speaker_norm<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    
    x <span class="token operator">=</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    
    <span class="token comment"># 3. å¤šå±‚åŒå‘GRUå¤„ç†</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>gru_layer<span class="token punctuation">,</span> layer_norm<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>gru_layers<span class="token punctuation">,</span> self<span class="token punctuation">.</span>layer_norms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        residual <span class="token operator">=</span> x <span class="token keyword">if</span> i <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token boolean">None</span>
        
        gru_out<span class="token punctuation">,</span> _ <span class="token operator">=</span> gru_layer<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment"># [batch_size, seq_len, hidden_size*4]</span>
        gru_out <span class="token operator">=</span> layer_norm<span class="token punctuation">(</span>gru_out<span class="token punctuation">)</span>
        
        <span class="token comment"># æ®‹å·®è¿æ¥ï¼ˆä»ç¬¬äºŒå±‚å¼€å§‹ï¼‰</span>
        <span class="token keyword">if</span> residual <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> residual<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> gru_out<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            gru_out <span class="token operator">=</span> gru_out <span class="token operator">+</span> residual
        
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>gru_out<span class="token punctuation">)</span>
    
    <span class="token comment"># 4. å¤šå¤´è‡ªæ³¨æ„åŠ›å¢å¼º</span>
    attention_weights <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_attention<span class="token punctuation">:</span>
        x<span class="token punctuation">,</span> attention_weights <span class="token operator">=</span> self<span class="token punctuation">.</span>self_attention<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    
    <span class="token comment"># 5. ç‰¹å¾å¢å¼º</span>
    enhanced_features <span class="token operator">=</span> self<span class="token punctuation">.</span>feature_enhancement<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    combined_features <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> enhanced_features<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    combined_features <span class="token operator">=</span> combined_features<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>self<span class="token punctuation">.</span>hidden_size<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span>
    
    <span class="token comment"># 6. å…¨å±€æ± åŒ–</span>
    pooling_input <span class="token operator">=</span> combined_features<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    avg_pooled <span class="token operator">=</span> self<span class="token punctuation">.</span>global_pooling<span class="token punctuation">(</span>pooling_input<span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    max_pooled <span class="token operator">=</span> self<span class="token punctuation">.</span>global_max_pooling<span class="token punctuation">(</span>pooling_input<span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># æ‹¼æ¥æ± åŒ–ç»“æœ</span>
    pooled_features <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>avg_pooled<span class="token punctuation">,</span> max_pooled<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    final_features <span class="token operator">=</span> pooled_features<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>self<span class="token punctuation">.</span>hidden_size<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span>
    
    <span class="token comment"># 7. æƒ…æ„Ÿåˆ†ç±»</span>
    emotion_logits <span class="token operator">=</span> self<span class="token punctuation">.</span>emotion_classifier<span class="token punctuation">(</span>final_features<span class="token punctuation">)</span>
    
    <span class="token comment"># 8. è¯´è¯äººå¯¹æŠ—åˆ†ç±»</span>
    speaker_logits <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_adversarial<span class="token punctuation">:</span>
        <span class="token comment"># åº”ç”¨æ¢¯åº¦åè½¬</span>
        adversarial_features <span class="token operator">=</span> gradient_reverse<span class="token punctuation">(</span>final_features<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span>
        speaker_logits <span class="token operator">=</span> self<span class="token punctuation">.</span>speaker_classifier<span class="token punctuation">(</span>adversarial_features<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'emotion_logits'</span><span class="token punctuation">:</span> emotion_logits<span class="token punctuation">,</span>
        <span class="token string">'speaker_logits'</span><span class="token punctuation">:</span> speaker_logits<span class="token punctuation">,</span>
        <span class="token string">'attention_weights'</span><span class="token punctuation">:</span> attention_weights<span class="token punctuation">,</span>
        <span class="token string">'features'</span><span class="token punctuation">:</span> final_features
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="âš™ï¸-å‚æ•°é…ç½®è¯´æ˜"><a href="#âš™ï¸-å‚æ•°é…ç½®è¯´æ˜" class="headerlink" title="âš™ï¸ å‚æ•°é…ç½®è¯´æ˜"></a>âš™ï¸ å‚æ•°é…ç½®è¯´æ˜</h2><h3 id="1-æ¨¡å‹ç»“æ„å‚æ•°"><a href="#1-æ¨¡å‹ç»“æ„å‚æ•°" class="headerlink" title="1. æ¨¡å‹ç»“æ„å‚æ•°"></a>1. æ¨¡å‹ç»“æ„å‚æ•°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># åŸºç¡€æ¶æ„å‚æ•°</span>
input_size <span class="token operator">=</span> <span class="token number">768</span>          <span class="token comment"># HuBERTç‰¹å¾ç»´åº¦</span>
hidden_size <span class="token operator">=</span> <span class="token number">256</span>         <span class="token comment"># GRUéšè—å±‚å¤§å°</span>
output_size <span class="token operator">=</span> <span class="token number">4</span>           <span class="token comment"># æƒ…æ„Ÿç±»åˆ«æ•°é‡ï¼ˆangry, happy, neutral, sadï¼‰</span>
dia_layers <span class="token operator">=</span> <span class="token number">3</span>            <span class="token comment"># GRUå±‚æ•°</span>

<span class="token comment"># æ­£åˆ™åŒ–å‚æ•°</span>
dropout <span class="token operator">=</span> <span class="token number">0.3</span>             <span class="token comment"># Dropoutæ¦‚ç‡</span>
max_grad_norm <span class="token operator">=</span> <span class="token number">1.0</span>       <span class="token comment"># æ¢¯åº¦è£å‰ªé˜ˆå€¼</span>
l2_reg <span class="token operator">=</span> <span class="token number">1e-5</span>            <span class="token comment"># L2æ­£åˆ™åŒ–æƒé‡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-ä¼˜åŒ–ç­–ç•¥å‚æ•°"><a href="#2-ä¼˜åŒ–ç­–ç•¥å‚æ•°" class="headerlink" title="2. ä¼˜åŒ–ç­–ç•¥å‚æ•°"></a>2. ä¼˜åŒ–ç­–ç•¥å‚æ•°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å­¦ä¹ ç‡è°ƒåº¦</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.0005</span>    <span class="token comment"># åˆå§‹å­¦ä¹ ç‡</span>
lr_schedule <span class="token operator">=</span> <span class="token string">'cosine'</span>    <span class="token comment"># å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥</span>
warmup_steps <span class="token operator">=</span> <span class="token number">1000</span>       <span class="token comment"># é¢„çƒ­æ­¥æ•°</span>
min_lr <span class="token operator">=</span> <span class="token number">1e-7</span>            <span class="token comment"># æœ€å°å­¦ä¹ ç‡</span>

<span class="token comment"># è®­ç»ƒç­–ç•¥</span>
batch_size <span class="token operator">=</span> <span class="token number">32</span>          <span class="token comment"># æ‰¹æ¬¡å¤§å°</span>
epochs <span class="token operator">=</span> <span class="token number">50</span>              <span class="token comment"># è®­ç»ƒè½®æ•°</span>
patience <span class="token operator">=</span> <span class="token number">10</span>            <span class="token comment"># æ—©åœè€å¿ƒå€¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-è¯´è¯äººæ— å…³åŒ–å‚æ•°"><a href="#3-è¯´è¯äººæ— å…³åŒ–å‚æ•°" class="headerlink" title="3. è¯´è¯äººæ— å…³åŒ–å‚æ•°"></a>3. è¯´è¯äººæ— å…³åŒ–å‚æ•°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># AdaINå½’ä¸€åŒ–</span>
speaker_norm <span class="token operator">=</span> <span class="token boolean">True</span>       <span class="token comment"># å¯ç”¨è¯´è¯äººå½’ä¸€åŒ–</span>
eps <span class="token operator">=</span> <span class="token number">1e-5</span>               <span class="token comment"># æ•°å€¼ç¨³å®šæ€§å‚æ•°</span>

<span class="token comment"># å¯¹æŠ—è®­ç»ƒ</span>
speaker_adversarial <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token comment"># å¯ç”¨å¯¹æŠ—è®­ç»ƒ</span>
adversarial_weight <span class="token operator">=</span> <span class="token number">0.05</span>     <span class="token comment"># å¯¹æŠ—æŸå¤±æƒé‡</span>
alpha_schedule <span class="token operator">=</span> <span class="token string">'linear'</span>     <span class="token comment"># æ¢¯åº¦åè½¬å¼ºåº¦è°ƒåº¦</span>
max_alpha <span class="token operator">=</span> <span class="token number">1.0</span>              <span class="token comment"># æœ€å¤§æ¢¯åº¦åè½¬å¼ºåº¦</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-æ³¨æ„åŠ›æœºåˆ¶å‚æ•°"><a href="#4-æ³¨æ„åŠ›æœºåˆ¶å‚æ•°" class="headerlink" title="4. æ³¨æ„åŠ›æœºåˆ¶å‚æ•°"></a>4. æ³¨æ„åŠ›æœºåˆ¶å‚æ•°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å¤šå¤´æ³¨æ„åŠ›</span>
attention <span class="token operator">=</span> <span class="token boolean">True</span>          <span class="token comment"># å¯ç”¨æ³¨æ„åŠ›æœºåˆ¶</span>
num_heads <span class="token operator">=</span> <span class="token number">8</span>            <span class="token comment"># æ³¨æ„åŠ›å¤´æ•°é‡</span>
attention_dropout <span class="token operator">=</span> <span class="token number">0.1</span>   <span class="token comment"># æ³¨æ„åŠ›dropout</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="ğŸ¯-è®­ç»ƒç­–ç•¥ä¼˜åŒ–"><a href="#ğŸ¯-è®­ç»ƒç­–ç•¥ä¼˜åŒ–" class="headerlink" title="ğŸ¯ è®­ç»ƒç­–ç•¥ä¼˜åŒ–"></a>ğŸ¯ è®­ç»ƒç­–ç•¥ä¼˜åŒ–</h2><h3 id="1-ç»¼åˆæŸå¤±å‡½æ•°"><a href="#1-ç»¼åˆæŸå¤±å‡½æ•°" class="headerlink" title="1. ç»¼åˆæŸå¤±å‡½æ•°"></a>1. ç»¼åˆæŸå¤±å‡½æ•°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">compute_loss</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_outputs<span class="token punctuation">,</span> targets<span class="token punctuation">,</span> speaker_targets<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç»¼åˆæŸå¤±å‡½æ•°
    
    ç»„æˆï¼š
    1. ä¸»ä»»åŠ¡æŸå¤±ï¼šæƒ…æ„Ÿåˆ†ç±»äº¤å‰ç†µæŸå¤±
    2. å¯¹æŠ—æŸå¤±ï¼šè¯´è¯äººæ··æ·†æŸå¤±
    3. æ­£åˆ™åŒ–æŸå¤±ï¼šL2æƒé‡è¡°å‡
    
    Args:
        model_outputs: æ¨¡å‹è¾“å‡ºå­—å…¸
        targets: æƒ…æ„Ÿæ ‡ç­¾
        speaker_targets: è¯´è¯äººæ ‡ç­¾
        alpha: æ¢¯åº¦åè½¬å¼ºåº¦
    
    Returns:
        total_loss: æ€»æŸå¤±
        loss_dict: å„é¡¹æŸå¤±è¯¦æƒ…
    """</span>
    emotion_logits <span class="token operator">=</span> model_outputs<span class="token punctuation">[</span><span class="token string">'emotion_logits'</span><span class="token punctuation">]</span>
    speaker_logits <span class="token operator">=</span> model_outputs<span class="token punctuation">[</span><span class="token string">'speaker_logits'</span><span class="token punctuation">]</span>
    
    <span class="token comment"># 1. æƒ…æ„Ÿåˆ†ç±»æŸå¤±ï¼ˆä¸»è¦ä»»åŠ¡ï¼‰</span>
    emotion_loss <span class="token operator">=</span> F<span class="token punctuation">.</span>cross_entropy<span class="token punctuation">(</span>emotion_logits<span class="token punctuation">,</span> targets<span class="token punctuation">)</span>
    
    total_loss <span class="token operator">=</span> emotion_loss
    loss_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'emotion_loss'</span><span class="token punctuation">:</span> emotion_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    
    <span class="token comment"># 2. è¯´è¯äººå¯¹æŠ—æŸå¤±</span>
    <span class="token keyword">if</span> speaker_logits <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>speaker_adversarial<span class="token punctuation">:</span>
        speaker_loss <span class="token operator">=</span> F<span class="token punctuation">.</span>cross_entropy<span class="token punctuation">(</span>speaker_logits<span class="token punctuation">,</span> speaker_targets<span class="token punctuation">)</span>
        total_loss <span class="token operator">+=</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>adversarial_weight <span class="token operator">*</span> speaker_loss
        loss_dict<span class="token punctuation">[</span><span class="token string">'speaker_loss'</span><span class="token punctuation">]</span> <span class="token operator">=</span> speaker_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 3. æ­£åˆ™åŒ–æŸå¤±</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>l2_reg <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
        l2_loss <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> p <span class="token keyword">in</span> model_outputs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'regularization_params'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        total_loss <span class="token operator">+=</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>l2_reg <span class="token operator">*</span> l2_loss
        loss_dict<span class="token punctuation">[</span><span class="token string">'l2_loss'</span><span class="token punctuation">]</span> <span class="token operator">=</span> l2_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>l2_loss<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span> <span class="token keyword">else</span> l2_loss
    
    loss_dict<span class="token punctuation">[</span><span class="token string">'total_loss'</span><span class="token punctuation">]</span> <span class="token operator">=</span> total_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> total_loss<span class="token punctuation">,</span> loss_dict<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-åŠ¨æ€å¯¹æŠ—è®­ç»ƒç­–ç•¥"><a href="#2-åŠ¨æ€å¯¹æŠ—è®­ç»ƒç­–ç•¥" class="headerlink" title="2. åŠ¨æ€å¯¹æŠ—è®­ç»ƒç­–ç•¥"></a>2. åŠ¨æ€å¯¹æŠ—è®­ç»ƒç­–ç•¥</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_alpha_schedule</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> epoch<span class="token punctuation">,</span> total_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    åŠ¨æ€è°ƒæ•´æ¢¯åº¦åè½¬å¼ºåº¦
    
    ç­–ç•¥ï¼š
    1. å‰æœŸï¼ˆepoch &lt; 5ï¼‰ï¼šÎ± = 0ï¼Œä¸“æ³¨æƒ…æ„Ÿåˆ†ç±»
    2. ä¸­æœŸï¼ˆ5 â‰¤ epoch &lt; total_epochs*0.7ï¼‰ï¼šçº¿æ€§å¢é•¿
    3. åæœŸï¼šä¿æŒæœ€å¤§å€¼
    """</span>
    <span class="token keyword">if</span> epoch <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0.0</span>  <span class="token comment"># å‰æœŸä¸ä½¿ç”¨å¯¹æŠ—è®­ç»ƒ</span>
    <span class="token keyword">elif</span> epoch <span class="token operator">&lt;</span> total_epochs <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">:</span>
        <span class="token comment"># çº¿æ€§å¢é•¿é˜¶æ®µ</span>
        progress <span class="token operator">=</span> <span class="token punctuation">(</span>epoch <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>total_epochs <span class="token operator">*</span> <span class="token number">0.7</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> progress <span class="token operator">*</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>max_alpha
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>max_alpha  <span class="token comment"># åæœŸä¿æŒæœ€å¤§å€¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥"><a href="#3-å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥" class="headerlink" title="3. å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥"></a>3. å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">create_lr_scheduler</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> total_steps<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    åˆ›å»ºå­¦ä¹ ç‡è°ƒåº¦å™¨
    
    ç­–ç•¥ï¼šä½™å¼¦é€€ç« + é¢„çƒ­
    1. é¢„çƒ­é˜¶æ®µï¼šçº¿æ€§å¢é•¿åˆ°åˆå§‹å­¦ä¹ ç‡
    2. ä¸»è®­ç»ƒé˜¶æ®µï¼šä½™å¼¦é€€ç«åˆ°æœ€å°å­¦ä¹ ç‡
    3. é‡å¯æœºåˆ¶ï¼šå‘¨æœŸæ€§é‡å¯æå‡æ€§èƒ½
    """</span>
    <span class="token comment"># é¢„çƒ­è°ƒåº¦å™¨</span>
    warmup_scheduler <span class="token operator">=</span> LinearLR<span class="token punctuation">(</span>
        optimizer<span class="token punctuation">,</span>
        start_factor<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>
        end_factor<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        total_iters<span class="token operator">=</span>self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>warmup_steps
    <span class="token punctuation">)</span>
    
    <span class="token comment"># ä½™å¼¦é€€ç«è°ƒåº¦å™¨</span>
    cosine_scheduler <span class="token operator">=</span> CosineAnnealingWarmRestarts<span class="token punctuation">(</span>
        optimizer<span class="token punctuation">,</span>
        T_0<span class="token operator">=</span>total_steps <span class="token operator">//</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token comment"># ç¬¬ä¸€ä¸ªå‘¨æœŸé•¿åº¦</span>
        T_mult<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>              <span class="token comment"># å‘¨æœŸå€å¢å› å­</span>
        eta_min<span class="token operator">=</span>self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>min_lr
    <span class="token punctuation">)</span>
    
    <span class="token comment"># ç»„åˆè°ƒåº¦å™¨</span>
    scheduler <span class="token operator">=</span> SequentialLR<span class="token punctuation">(</span>
        optimizer<span class="token punctuation">,</span>
        schedulers<span class="token operator">=</span><span class="token punctuation">[</span>warmup_scheduler<span class="token punctuation">,</span> cosine_scheduler<span class="token punctuation">]</span><span class="token punctuation">,</span>
        milestones<span class="token operator">=</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>warmup_steps<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> scheduler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-æ•°æ®å¢å¼ºç­–ç•¥"><a href="#4-æ•°æ®å¢å¼ºç­–ç•¥" class="headerlink" title="4. æ•°æ®å¢å¼ºç­–ç•¥"></a>4. æ•°æ®å¢å¼ºç­–ç•¥</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">apply_augmentation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> audio_features<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    è®­ç»ƒæ—¶æ•°æ®å¢å¼º
    
    ç­–ç•¥ï¼š
    1. é«˜æ–¯å™ªå£°ï¼šå¢åŠ é²æ£’æ€§
    2. æ—¶é—´æ‹‰ä¼¸ï¼šæ¨¡æ‹Ÿè¯­é€Ÿå˜åŒ–
    3. ç‰¹å¾æ©è”½ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆ
    """</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_training<span class="token punctuation">:</span>
        <span class="token comment"># 1. æ·»åŠ é«˜æ–¯å™ªå£°</span>
        <span class="token keyword">if</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.3</span><span class="token punctuation">:</span>
            noise <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn_like<span class="token punctuation">(</span>audio_features<span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>noise_factor
            audio_features <span class="token operator">=</span> audio_features <span class="token operator">+</span> noise
        
        <span class="token comment"># 2. æ—¶é—´ç»´åº¦æ‹‰ä¼¸ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
        <span class="token keyword">if</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.2</span><span class="token punctuation">:</span>
            stretch_factor <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">+</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>time_stretch_factor <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>time_stretch_factor
            <span class="token comment"># å®é™…å®ç°éœ€è¦æ’å€¼æ“ä½œ</span>
            
        <span class="token comment"># 3. ç‰¹å¾æ©è”½</span>
        <span class="token keyword">if</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.2</span><span class="token punctuation">:</span>
            mask_size <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>audio_features<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
            mask_start <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> audio_features<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> mask_size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            audio_features<span class="token punctuation">[</span>mask_start<span class="token punctuation">:</span>mask_start <span class="token operator">+</span> mask_size<span class="token punctuation">]</span> <span class="token operator">*=</span> <span class="token number">0.1</span>
    
    <span class="token keyword">return</span> audio_features<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="ğŸ“Š-æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–"><a href="#ğŸ“Š-æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–" class="headerlink" title="ğŸ“Š æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–"></a>ğŸ“Š æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–</h2><h3 id="1-è®­ç»ƒç›‘æ§æŒ‡æ ‡"><a href="#1-è®­ç»ƒç›‘æ§æŒ‡æ ‡" class="headerlink" title="1. è®­ç»ƒç›‘æ§æŒ‡æ ‡"></a>1. è®­ç»ƒç›‘æ§æŒ‡æ ‡</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">TrainingMonitor</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""è®­ç»ƒè¿‡ç¨‹ç›‘æ§å™¨"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>metrics <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'train_loss'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'val_loss'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'train_acc'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'val_acc'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'train_f1'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'val_f1'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'learning_rate'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'alpha_values'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">def</span> <span class="token function">update_metrics</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> epoch<span class="token punctuation">,</span> train_metrics<span class="token punctuation">,</span> val_metrics<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""æ›´æ–°è®­ç»ƒæŒ‡æ ‡"""</span>
        self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'train_loss'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_metrics<span class="token punctuation">[</span><span class="token string">'loss'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'val_loss'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>val_metrics<span class="token punctuation">[</span><span class="token string">'loss'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'train_acc'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_metrics<span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'val_acc'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>val_metrics<span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'train_f1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_metrics<span class="token punctuation">[</span><span class="token string">'f1_score'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'val_f1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>val_metrics<span class="token punctuation">[</span><span class="token string">'f1_score'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'learning_rate'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>lr<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'alpha_values'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>alpha<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">plot_training_curves</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> save_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""ç»˜åˆ¶è®­ç»ƒæ›²çº¿"""</span>
        fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># æŸå¤±æ›²çº¿</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'train_loss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Train Loss'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'val_loss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Val Loss'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Loss Curves'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># å‡†ç¡®ç‡æ›²çº¿</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'train_acc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Train Acc'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'val_acc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Val Acc'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Accuracy Curves'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># F1åˆ†æ•°æ›²çº¿</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'train_f1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Train F1'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'val_f1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Val F1'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'F1 Score Curves'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># å­¦ä¹ ç‡å˜åŒ–</span>
        axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'learning_rate'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Learning Rate Schedule'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_yscale<span class="token punctuation">(</span><span class="token string">'log'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Alphaå€¼å˜åŒ–</span>
        axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'alpha_values'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orange'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Adversarial Alpha Schedule'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># éªŒè¯æŸå¤±æ”¾å¤§å›¾</span>
        axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metrics<span class="token punctuation">[</span><span class="token string">'val_loss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Validation Loss (Detailed)'</span><span class="token punctuation">)</span>
        
        plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-è·¨è¯´è¯äººæ€§èƒ½åˆ†æ"><a href="#2-è·¨è¯´è¯äººæ€§èƒ½åˆ†æ" class="headerlink" title="2. è·¨è¯´è¯äººæ€§èƒ½åˆ†æ"></a>2. è·¨è¯´è¯äººæ€§èƒ½åˆ†æ</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">analyze_speaker_performance</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> test_loader<span class="token punctuation">,</span> save_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    è·¨è¯´è¯äººæ€§èƒ½åˆ†æ
    
    åˆ†æå†…å®¹ï¼š
    1. å„è¯´è¯äººå‡†ç¡®ç‡å¯¹æ¯”
    2. æ€§èƒ½æ–¹å·®åˆ†æ
    3. æ€§åˆ«å·®å¼‚åˆ†æ
    4. ä¼šè¯å·®å¼‚åˆ†æ
    """</span>
    model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    speaker_results <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span>
    
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> batch <span class="token keyword">in</span> test_loader<span class="token punctuation">:</span>
            features <span class="token operator">=</span> batch<span class="token punctuation">[</span><span class="token string">'audio_features'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
            labels <span class="token operator">=</span> batch<span class="token punctuation">[</span><span class="token string">'emotion_label'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
            speakers <span class="token operator">=</span> batch<span class="token punctuation">[</span><span class="token string">'speaker'</span><span class="token punctuation">]</span>
            
            outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>features<span class="token punctuation">)</span>
            predictions <span class="token operator">=</span> torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>outputs<span class="token punctuation">[</span><span class="token string">'emotion_logits'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            
            <span class="token keyword">for</span> pred<span class="token punctuation">,</span> label<span class="token punctuation">,</span> speaker <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>predictions<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> speakers<span class="token punctuation">)</span><span class="token punctuation">:</span>
                speaker_results<span class="token punctuation">[</span>speaker<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                    <span class="token string">'prediction'</span><span class="token punctuation">:</span> pred<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'label'</span><span class="token punctuation">:</span> label<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'correct'</span><span class="token punctuation">:</span> pred<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> label<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    
    <span class="token comment"># è®¡ç®—å„è¯´è¯äººæ€§èƒ½</span>
    speaker_metrics <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">for</span> speaker<span class="token punctuation">,</span> results <span class="token keyword">in</span> speaker_results<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        correct <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token string">'correct'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> r <span class="token keyword">in</span> results<span class="token punctuation">)</span>
        total <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
        accuracy <span class="token operator">=</span> correct <span class="token operator">/</span> total <span class="token keyword">if</span> total <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
        
        <span class="token comment"># è®¡ç®—F1åˆ†æ•°</span>
        y_true <span class="token operator">=</span> <span class="token punctuation">[</span>r<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> r <span class="token keyword">in</span> results<span class="token punctuation">]</span>
        y_pred <span class="token operator">=</span> <span class="token punctuation">[</span>r<span class="token punctuation">[</span><span class="token string">'prediction'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> r <span class="token keyword">in</span> results<span class="token punctuation">]</span>
        f1 <span class="token operator">=</span> f1_score<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span> average<span class="token operator">=</span><span class="token string">'weighted'</span><span class="token punctuation">)</span>
        
        speaker_metrics<span class="token punctuation">[</span>speaker<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'accuracy'</span><span class="token punctuation">:</span> accuracy<span class="token punctuation">,</span>
            <span class="token string">'f1_score'</span><span class="token punctuation">:</span> f1<span class="token punctuation">,</span>
            <span class="token string">'total_samples'</span><span class="token punctuation">:</span> total
        <span class="token punctuation">&#125;</span>
    
    <span class="token comment"># å¯è§†åŒ–ç»“æœ</span>
    self<span class="token punctuation">.</span>plot_speaker_performance<span class="token punctuation">(</span>speaker_metrics<span class="token punctuation">,</span> save_dir<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> speaker_metrics

<span class="token keyword">def</span> <span class="token function">plot_speaker_performance</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> speaker_metrics<span class="token punctuation">,</span> save_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""ç»˜åˆ¶è¯´è¯äººæ€§èƒ½å¯¹æ¯”å›¾"""</span>
    speakers <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>speaker_metrics<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    accuracies <span class="token operator">=</span> <span class="token punctuation">[</span>speaker_metrics<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> speakers<span class="token punctuation">]</span>
    f1_scores <span class="token operator">=</span> <span class="token punctuation">[</span>speaker_metrics<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'f1_score'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> speakers<span class="token punctuation">]</span>
    
    fig<span class="token punctuation">,</span> <span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span> <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment"># å‡†ç¡®ç‡å¯¹æ¯”</span>
    bars1 <span class="token operator">=</span> ax1<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>speakers<span class="token punctuation">,</span> accuracies<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'skyblue'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span>
    ax1<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Speaker-wise Accuracy Comparison'</span><span class="token punctuation">)</span>
    ax1<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Accuracy'</span><span class="token punctuation">)</span>
    ax1<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># æ·»åŠ æ•°å€¼æ ‡ç­¾</span>
    <span class="token keyword">for</span> bar<span class="token punctuation">,</span> acc <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>bars1<span class="token punctuation">,</span> accuracies<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ax1<span class="token punctuation">.</span>text<span class="token punctuation">(</span>bar<span class="token punctuation">.</span>get_x<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> bar<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> bar<span class="token punctuation">.</span>get_height<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.01</span><span class="token punctuation">,</span> 
                <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>acc<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'bottom'</span><span class="token punctuation">)</span>
    
    <span class="token comment"># F1åˆ†æ•°å¯¹æ¯”</span>
    bars2 <span class="token operator">=</span> ax2<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>speakers<span class="token punctuation">,</span> f1_scores<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'lightcoral'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span>
    ax2<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Speaker-wise F1 Score Comparison'</span><span class="token punctuation">)</span>
    ax2<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'F1 Score'</span><span class="token punctuation">)</span>
    ax2<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># æ·»åŠ æ•°å€¼æ ‡ç­¾</span>
    <span class="token keyword">for</span> bar<span class="token punctuation">,</span> f1 <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>bars2<span class="token punctuation">,</span> f1_scores<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ax2<span class="token punctuation">.</span>text<span class="token punctuation">(</span>bar<span class="token punctuation">.</span>get_x<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> bar<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> bar<span class="token punctuation">.</span>get_height<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.01</span><span class="token punctuation">,</span> 
                <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>f1<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'bottom'</span><span class="token punctuation">)</span>
    
    plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>save_dir<span class="token punctuation">&#125;</span></span><span class="token string">/speaker_performance_comparison.png'</span></span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="ğŸ¯-ä½¿ç”¨ç¤ºä¾‹"><a href="#ğŸ¯-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ğŸ¯ ä½¿ç”¨ç¤ºä¾‹"></a>ğŸ¯ ä½¿ç”¨ç¤ºä¾‹</h2><h3 id="1-æ¨¡å‹åˆå§‹åŒ–"><a href="#1-æ¨¡å‹åˆå§‹åŒ–" class="headerlink" title="1. æ¨¡å‹åˆå§‹åŒ–"></a>1. æ¨¡å‹åˆå§‹åŒ–</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># åˆ›å»ºå‚æ•°å¯¹è±¡</span>
args <span class="token operator">=</span> argparse<span class="token punctuation">.</span>Namespace<span class="token punctuation">(</span>
    input_size<span class="token operator">=</span><span class="token number">768</span><span class="token punctuation">,</span>
    hidden_size<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
    output_size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
    dia_layers<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
    dropout<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    attention<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    speaker_norm<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    speaker_adversarial<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    adversarial_weight<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span>
    max_alpha<span class="token operator">=</span><span class="token number">1.0</span>
<span class="token punctuation">)</span>

<span class="token comment"># åˆå§‹åŒ–æ¨¡å‹</span>
model <span class="token operator">=</span> EnhancedGRUModel<span class="token punctuation">(</span>
    input_size<span class="token operator">=</span>args<span class="token punctuation">.</span>input_size<span class="token punctuation">,</span>
    hidden_size<span class="token operator">=</span>args<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span>
    output_size<span class="token operator">=</span>args<span class="token punctuation">.</span>output_size<span class="token punctuation">,</span>
    args<span class="token operator">=</span>args
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æ¨¡å‹å‚æ•°é‡: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">sum</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>numel<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> p <span class="token keyword">in</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">,</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-è®­ç»ƒæµç¨‹"><a href="#2-è®­ç»ƒæµç¨‹" class="headerlink" title="2. è®­ç»ƒæµç¨‹"></a>2. è®­ç»ƒæµç¨‹</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># åˆ›å»ºè®­ç»ƒå™¨</span>
trainer <span class="token operator">=</span> AdvancedTrainer<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

<span class="token comment"># è®­ç»ƒæ¨¡å‹</span>
best_model_path <span class="token operator">=</span> trainer<span class="token punctuation">.</span>train_model<span class="token punctuation">(</span>
    model<span class="token operator">=</span>model<span class="token punctuation">,</span>
    train_loader<span class="token operator">=</span>train_loader<span class="token punctuation">,</span>
    val_loader<span class="token operator">=</span>val_loader<span class="token punctuation">,</span>
    save_dir<span class="token operator">=</span><span class="token string">'./experiments'</span>
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æœ€ä½³æ¨¡å‹ä¿å­˜åœ¨: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>best_model_path<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-æ€§èƒ½è¯„ä¼°"><a href="#3-æ€§èƒ½è¯„ä¼°" class="headerlink" title="3. æ€§èƒ½è¯„ä¼°"></a>3. æ€§èƒ½è¯„ä¼°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># åŠ è½½æœ€ä½³æ¨¡å‹</span>
model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>best_model_path<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># è¯„ä¼°è·¨è¯´è¯äººæ€§èƒ½</span>
evaluator <span class="token operator">=</span> SpeakerIndependenceEvaluator<span class="token punctuation">(</span>model<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
results <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>test_loader<span class="token punctuation">,</span> save_dir<span class="token operator">=</span><span class="token string">'./evaluation_results'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"è·¨è¯´è¯äººæ€§èƒ½è¯„ä¼°å®Œæˆï¼"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æ€»ä½“å‡†ç¡®ç‡: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>results<span class="token punctuation">[</span><span class="token string">'overall_accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å¹³å‡F1åˆ†æ•°: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>results<span class="token punctuation">[</span><span class="token string">'average_f1'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æ€§èƒ½æ ‡å‡†å·®: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>results<span class="token punctuation">[</span><span class="token string">'performance_std'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="ğŸ“ˆ-é¢„æœŸæ”¹è¿›æ•ˆæœ"><a href="#ğŸ“ˆ-é¢„æœŸæ”¹è¿›æ•ˆæœ" class="headerlink" title="ğŸ“ˆ é¢„æœŸæ”¹è¿›æ•ˆæœ"></a>ğŸ“ˆ é¢„æœŸæ”¹è¿›æ•ˆæœ</h2><h3 id="æ€§èƒ½æå‡é¢„æœŸ"><a href="#æ€§èƒ½æå‡é¢„æœŸ" class="headerlink" title="æ€§èƒ½æå‡é¢„æœŸ"></a>æ€§èƒ½æå‡é¢„æœŸ</h3><table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>åŸå§‹æ¨¡å‹</th>
<th>å¢å¼ºæ¨¡å‹</th>
<th>æ”¹è¿›å¹…åº¦</th>
</tr>
</thead>
<tbody><tr>
<td>æ€»ä½“å‡†ç¡®ç‡</td>
<td>65-70%</td>
<td>75-80%</td>
<td>+10-15%</td>
</tr>
<tr>
<td>è·¨è¯´è¯äººF1</td>
<td>0.62-0.67</td>
<td>0.72-0.77</td>
<td>+0.10-0.15</td>
</tr>
<tr>
<td>æ€§èƒ½æ–¹å·®</td>
<td>0.08-0.12</td>
<td>0.04-0.08</td>
<td>-50%â†“</td>
</tr>
<tr>
<td>æ”¶æ•›é€Ÿåº¦</td>
<td>30-40è½®</td>
<td>20-25è½®</td>
<td>å¿«25-50%</td>
</tr>
</tbody></table>
<h3 id="æŠ€æœ¯ä¼˜åŠ¿"><a href="#æŠ€æœ¯ä¼˜åŠ¿" class="headerlink" title="æŠ€æœ¯ä¼˜åŠ¿"></a>æŠ€æœ¯ä¼˜åŠ¿</h3><ol>
<li><strong>ğŸ¯ è¯´è¯äººæ— å…³æ€§</strong>ï¼šAdaINå½’ä¸€åŒ– + å¯¹æŠ—è®­ç»ƒæ˜¾è‘—å‡å°‘è¯´è¯äººåè§</li>
<li><strong>ğŸš€ è®­ç»ƒæ•ˆç‡</strong>ï¼šåŠ¨æ€å­¦ä¹ ç‡è°ƒåº¦ + æ—©åœæœºåˆ¶åŠ é€Ÿæ”¶æ•›</li>
<li><strong>ğŸ’ª æ¨¡å‹é²æ£’æ€§</strong>ï¼šå¤šç§æ­£åˆ™åŒ–æŠ€æœ¯æå‡æ³›åŒ–èƒ½åŠ›</li>
<li><strong>ğŸ“Š å…¨é¢ç›‘æ§</strong>ï¼šå®æ—¶å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹å’Œæ€§èƒ½æŒ‡æ ‡</li>
</ol>
<hr>
<h2 id="ğŸ”§-æ•…éšœæ’é™¤"><a href="#ğŸ”§-æ•…éšœæ’é™¤" class="headerlink" title="ğŸ”§ æ•…éšœæ’é™¤"></a>ğŸ”§ æ•…éšœæ’é™¤</h2><h3 id="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h3><ol>
<li><p><strong>å†…å­˜ä¸è¶³</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å‡å°‘æ‰¹æ¬¡å¤§å°</span>
args<span class="token punctuation">.</span>batch_size <span class="token operator">=</span> <span class="token number">16</span>  <span class="token comment"># ä»32é™åˆ°16</span>

<span class="token comment"># å¯ç”¨æ¢¯åº¦ç´¯ç§¯</span>
args<span class="token punctuation">.</span>gradient_accumulation_steps <span class="token operator">=</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>è®­ç»ƒä¸ç¨³å®š</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># é™ä½å­¦ä¹ ç‡</span>
args<span class="token punctuation">.</span>learning_rate <span class="token operator">=</span> <span class="token number">0.0001</span>

<span class="token comment"># å¢åŠ æ¢¯åº¦è£å‰ª</span>
args<span class="token punctuation">.</span>max_grad_norm <span class="token operator">=</span> <span class="token number">0.5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>è¿‡æ‹Ÿåˆä¸¥é‡</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å¢åŠ Dropout</span>
args<span class="token punctuation">.</span>dropout <span class="token operator">=</span> <span class="token number">0.5</span>

<span class="token comment"># å¢åŠ L2æ­£åˆ™åŒ–</span>
args<span class="token punctuation">.</span>l2_reg <span class="token operator">=</span> <span class="token number">1e-4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>å¯¹æŠ—è®­ç»ƒä¸æ”¶æ•›</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># é™ä½å¯¹æŠ—æƒé‡</span>
args<span class="token punctuation">.</span>adversarial_weight <span class="token operator">=</span> <span class="token number">0.01</span>

<span class="token comment"># å»¶è¿Ÿå¯¹æŠ—è®­ç»ƒå¼€å§‹æ—¶é—´</span>
args<span class="token punctuation">.</span>adversarial_start_epoch <span class="token operator">=</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<hr>
<h2 id="ğŸ“š-å‚è€ƒæ–‡çŒ®"><a href="#ğŸ“š-å‚è€ƒæ–‡çŒ®" class="headerlink" title="ğŸ“š å‚è€ƒæ–‡çŒ®"></a>ğŸ“š å‚è€ƒæ–‡çŒ®</h2><ol>
<li><strong>AdaIN</strong>: Huang, X., &amp; Belongie, S. (2017). Arbitrary style transfer in real-time with adaptive instance normalization.</li>
<li><strong>Gradient Reversal</strong>: Ganin, Y., &amp; Lempitsky, V. (2015). Unsupervised domain adaptation by backpropagation.</li>
<li><strong>Multi-Head Attention</strong>: Vaswani, A., et al. (2017). Attention is all you need.</li>
<li><strong>HuBERT</strong>: Hsu, W. N., et al. (2021). HuBERT: Self-supervised speech representation learning by masked prediction.</li>
</ol>
<hr>
<p><em>ğŸ“ æ–‡æ¡£ç‰ˆæœ¬: v2.0 | æ›´æ–°æ—¥æœŸ: 2024-09-26 | ä½œè€…: AI Assistant</em></p>
<hr>
<h1 id="IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿæ·±åº¦æºç è§£æ"><a href="#IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿæ·±åº¦æºç è§£æ" class="headerlink" title="IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿæ·±åº¦æºç è§£æ"></a>IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿæ·±åº¦æºç è§£æ</h1><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ol>
<li><a href="#1-%E9%A1%B9%E7%9B%AE%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E4%B8%8E%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86">é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†</a></li>
<li><a href="#2-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E5%8A%9F%E8%83%BD%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90">æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ</a></li>
<li><a href="#3-%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%B5%81%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90">å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ</a></li>
<li><a href="#4-%E5%85%B3%E9%94%AE%E5%8F%82%E6%95%B0%E5%90%AB%E4%B9%89%E4%B8%8E%E6%80%A7%E8%83%BD%E5%BD%B1%E5%93%8D">å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“</a></li>
<li><a href="#5-%E6%A8%A1%E5%9E%8B%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3">æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£</a></li>
<li><a href="#6-%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8A%BF%E4%B8%8E%E6%8A%80%E6%9C%AF%E5%88%9B%E6%96%B0">ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°</a></li>
</ol>
<hr>
<h2 id="1-é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†"><a href="#1-é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†" class="headerlink" title="1. é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†"></a>1. é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†</h2><h3 id="1-1-ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ"><a href="#1-1-ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ" class="headerlink" title="1.1 ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ"></a>1.1 ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ</h3><p>è¯¥IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿé‡‡ç”¨ç«¯åˆ°ç«¯çš„æ·±åº¦å­¦ä¹ æ¶æ„ï¼Œå®ç°ä»åŸå§‹éŸ³é¢‘ä¿¡å·åˆ°æƒ…æ„Ÿç±»åˆ«çš„ç›´æ¥æ˜ å°„ã€‚æ•´ä½“æ•°æ®æµéµå¾ªç°ä»£è¯­éŸ³å¤„ç†çš„æœ€ä½³å®è·µï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">åŸå§‹éŸ³é¢‘ â†’ é¢„å¤„ç†æ ‡å‡†åŒ– â†’ HuBERTç‰¹å¾ç¼–ç  â†’ åŒå‘GRUåºåˆ—å»ºæ¨¡ â†’ æ³¨æ„åŠ›æœºåˆ¶å¢å¼º â†’ å…¨å±€æ± åŒ– â†’ åˆ†ç±»è¾“å‡º<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¿™ç§è®¾è®¡å……åˆ†åˆ©ç”¨äº†è‡ªç›‘ç£é¢„è®­ç»ƒæ¨¡å‹çš„å¼ºå¤§ç‰¹å¾æå–èƒ½åŠ›ï¼Œç»“åˆå¾ªç¯ç¥ç»ç½‘ç»œå¯¹æ—¶åºä¿¡æ¯çš„ç²¾ç¡®å»ºæ¨¡ï¼Œæœ€ç»ˆé€šè¿‡æ³¨æ„åŠ›æœºåˆ¶å®ç°å¯¹æƒ…æ„Ÿå…³é”®ä¿¡æ¯çš„åŠ¨æ€èšç„¦ã€‚</p>
<h3 id="1-2-æ ¸å¿ƒæ¨¡å—åˆ’åˆ†"><a href="#1-2-æ ¸å¿ƒæ¨¡å—åˆ’åˆ†" class="headerlink" title="1.2 æ ¸å¿ƒæ¨¡å—åˆ’åˆ†"></a>1.2 æ ¸å¿ƒæ¨¡å—åˆ’åˆ†</h3><p><strong>æ•°æ®é¢„å¤„ç†æ¨¡å—</strong> (<code>Data_prepocessing.py</code>)</p>
<ul>
<li><strong>åŠŸèƒ½èŒè´£</strong>ï¼šè´Ÿè´£IEMOCAPæ•°æ®é›†çš„æ ‡å‡†åŒ–å¤„ç†ï¼ŒåŒ…æ‹¬éŸ³é¢‘é•¿åº¦ç»Ÿä¸€ã€é‡‡æ ·ç‡æ ‡å‡†åŒ–ã€æƒ…æ„Ÿæ ‡ç­¾æ˜ å°„</li>
<li><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šç¡®ä¿æ¨¡å‹è¾“å…¥çš„ä¸€è‡´æ€§ï¼Œä¸ºåç»­ç‰¹å¾æå–æä¾›æ ‡å‡†åŒ–çš„æ•°æ®åŸºç¡€</li>
<li><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>ï¼šé‡‡ç”¨å›ºå®š3ç§’æ—¶é•¿ç­–ç•¥ï¼Œå¹³è¡¡ä¿¡æ¯ä¿ç•™ä¸è®¡ç®—æ•ˆç‡</li>
</ul>
<p><strong>æ¨¡å‹æ¶æ„æ¨¡å—</strong> (<code>models/GRU.py</code>)</p>
<ul>
<li><strong>SpeechRecognitionModel</strong>ï¼šä¸»æ¨¡å‹å®¹å™¨ï¼Œæ•´åˆHuBERTç‰¹å¾æå–å™¨ä¸GRUåºåˆ—å»ºæ¨¡å™¨</li>
<li><strong>GRUModel</strong>ï¼šåºåˆ—å»ºæ¨¡æ ¸å¿ƒï¼Œè´Ÿè´£æ—¶åºç‰¹å¾çš„æ·±åº¦å­¦ä¹ ä¸æƒ…æ„Ÿåˆ†ç±»</li>
<li><strong>MatchingAttention</strong>ï¼šæ³¨æ„åŠ›æœºåˆ¶å®ç°ï¼Œæä¾›åŠ¨æ€ç‰¹å¾åŠ æƒèƒ½åŠ›</li>
</ul>
<p><strong>è®­ç»ƒä¸éªŒè¯æ¨¡å—</strong> (<code>train.py</code>)</p>
<ul>
<li><strong>äº¤å‰éªŒè¯ç­–ç•¥</strong>ï¼šé‡‡ç”¨5æŠ˜äº¤å‰éªŒè¯ï¼Œç¡®ä¿æ¨¡å‹æ³›åŒ–èƒ½åŠ›çš„å¯é è¯„ä¼°</li>
<li><strong>ä¼˜åŒ–ç­–ç•¥</strong>ï¼šä½¿ç”¨AdamWä¼˜åŒ–å™¨ï¼Œç»“åˆé€‚å½“çš„å­¦ä¹ ç‡è°ƒåº¦</li>
<li><strong>æ€§èƒ½è¯„ä¼°</strong>ï¼šå¤šæŒ‡æ ‡ç»¼åˆè¯„ä¼°ï¼ŒåŒ…æ‹¬å‡†ç¡®ç‡ã€å¬å›ç‡ã€F1åˆ†æ•°</li>
</ul>
<p><strong>æ¨ç†ä¸åº”ç”¨æ¨¡å—</strong> (<code>DEMO.py</code>, <code>GUIæƒ…æ„Ÿè¯†åˆ«2.py</code>)</p>
<ul>
<li><strong>å•æ ·æœ¬æ¨ç†</strong>ï¼šæä¾›ç®€æ´çš„æ¨¡å‹æµ‹è¯•æ¥å£</li>
<li><strong>å®æ—¶éŸ³é¢‘å¤„ç†</strong>ï¼šæ”¯æŒéº¦å…‹é£å®æ—¶å½•éŸ³ä¸æƒ…æ„Ÿè¯†åˆ«</li>
<li><strong>ç”¨æˆ·ç•Œé¢</strong>ï¼šå®Œæ•´çš„PyQt5å›¾å½¢ç•Œé¢ï¼Œæä¾›ç›´è§‚çš„äº¤äº’ä½“éªŒ</li>
</ul>
<hr>
<h2 id="2-æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ"><a href="#2-æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ" class="headerlink" title="2. æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ"></a>2. æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ</h2><h3 id="2-1-HubertModelè¯­éŸ³ç‰¹å¾ç¼–ç å™¨"><a href="#2-1-HubertModelè¯­éŸ³ç‰¹å¾ç¼–ç å™¨" class="headerlink" title="2.1 HubertModelè¯­éŸ³ç‰¹å¾ç¼–ç å™¨"></a>2.1 HubertModelè¯­éŸ³ç‰¹å¾ç¼–ç å™¨</h3><h4 id="2-1-1-æ¨¡å‹é€‰æ‹©çš„æ·±å±‚è€ƒé‡"><a href="#2-1-1-æ¨¡å‹é€‰æ‹©çš„æ·±å±‚è€ƒé‡" class="headerlink" title="2.1.1 æ¨¡å‹é€‰æ‹©çš„æ·±å±‚è€ƒé‡"></a>2.1.1 æ¨¡å‹é€‰æ‹©çš„æ·±å±‚è€ƒé‡</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">.</span>feature_extractor <span class="token operator">=</span> HubertModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"facebook/hubert-base-ls960"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>HuBERT (Hidden-Unit BERT) çš„é€‰æ‹©ä½“ç°äº†å¯¹è¯­éŸ³è¡¨ç¤ºå­¦ä¹ å‰æ²¿æŠ€æœ¯çš„æ·±åˆ»ç†è§£ï¼š</p>
<p><strong>è‡ªç›‘ç£å­¦ä¹ ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>HuBERTé€šè¿‡æ©ç é¢„æµ‹ä»»åŠ¡åœ¨å¤§è§„æ¨¡æ— æ ‡æ³¨è¯­éŸ³æ•°æ®ä¸Šé¢„è®­ç»ƒï¼Œå­¦ä¹ åˆ°äº†ä¸°å¯Œçš„è¯­éŸ³è¡¨ç¤º</li>
<li>ç›¸æ¯”ä¼ ç»Ÿçš„MFCCã€Melé¢‘è°±ç­‰æ‰‹å·¥ç‰¹å¾ï¼ŒHuBERTèƒ½å¤Ÿè‡ªåŠ¨å‘ç°è¯­éŸ³ä¸­çš„å±‚æ¬¡åŒ–æ¨¡å¼</li>
<li>é¢„è®­ç»ƒåœ¨960å°æ—¶LibriSpeechæ•°æ®ä¸Šè¿›è¡Œï¼Œæ¶µç›–äº†å¤šæ ·åŒ–çš„è¯­éŸ³æ¨¡å¼å’Œå£°å­¦ç¯å¢ƒ</li>
</ul>
<p><strong>åˆ†å±‚ç‰¹å¾è¡¨ç¤º</strong>ï¼š</p>
<ul>
<li>åº•å±‚ï¼šæ•è·éŸ³ç´ çº§åˆ«çš„å£°å­¦ç‰¹å¾ï¼Œå¦‚å…±æŒ¯å³°ã€åŸºé¢‘å˜åŒ–</li>
<li>ä¸­å±‚ï¼šå»ºæ¨¡éŸ³èŠ‚å’Œè¯æ±‡çº§åˆ«çš„è¯­éŸ³æ¨¡å¼</li>
<li>é«˜å±‚ï¼šç¼–ç è¯­ä¹‰å’ŒéŸµå¾‹ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯¹æƒ…æ„Ÿè¯†åˆ«è‡³å…³é‡è¦</li>
</ul>
<p><strong>768ç»´ç‰¹å¾å‘é‡çš„ä¿¡æ¯å¯†åº¦</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªæ—¶é—´æ­¥è¾“å‡º768ç»´å¯†é›†å‘é‡ï¼Œç›¸æ¯”ä¼ ç»Ÿç‰¹å¾ï¼ˆå¦‚39ç»´MFCCï¼‰å…·æœ‰æ›´å¼ºçš„è¡¨è¾¾èƒ½åŠ›</li>
<li>é«˜ç»´ç‰¹å¾ç©ºé—´èƒ½å¤Ÿæ›´ç²¾ç»†åœ°åŒºåˆ†ä¸åŒæƒ…æ„ŸçŠ¶æ€ä¸‹çš„è¯­éŸ³å˜åŒ–</li>
</ul>
<h4 id="2-1-2-ç‰¹å¾æå–çš„æŠ€æœ¯å®ç°"><a href="#2-1-2-ç‰¹å¾æå–çš„æŠ€æœ¯å®ç°" class="headerlink" title="2.1.2 ç‰¹å¾æå–çš„æŠ€æœ¯å®ç°"></a>2.1.2 ç‰¹å¾æå–çš„æŠ€æœ¯å®ç°</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_waveform<span class="token punctuation">)</span><span class="token punctuation">:</span>
    features <span class="token operator">=</span> self<span class="token punctuation">.</span>feature_extractor<span class="token punctuation">(</span>input_waveform<span class="token punctuation">)</span><span class="token punctuation">.</span>last_hidden_state  <span class="token comment"># [batch, seq_len, 768]</span>
    logits <span class="token operator">=</span> self<span class="token punctuation">.</span>Utterance_net<span class="token punctuation">(</span>features<span class="token punctuation">)</span>
    <span class="token keyword">return</span> logits<span class="token punctuation">,</span> features<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å¤„ç†æµç¨‹çš„æŠ€æœ¯ç»†èŠ‚</strong>ï¼š</p>
<ol>
<li><p><strong>å·ç§¯ç‰¹å¾æå–</strong>ï¼š</p>
<ul>
<li>HuBERTé¦–å…ˆé€šè¿‡7å±‚1Då·ç§¯ç½‘ç»œå¤„ç†åŸå§‹æ³¢å½¢</li>
<li>æ¯å±‚å·ç§¯é€æ­¥é™ä½æ—¶é—´åˆ†è¾¨ç‡ï¼Œæé«˜ç‰¹å¾æŠ½è±¡å±‚æ¬¡</li>
<li>å·ç§¯æ ¸è®¾è®¡è€ƒè™‘äº†è¯­éŸ³ä¿¡å·çš„æ—¶é¢‘ç‰¹æ€§</li>
</ul>
</li>
<li><p><strong>Transformerç¼–ç </strong>ï¼š</p>
<ul>
<li>12å±‚Transformerç¼–ç å™¨è¿›è¡Œåºåˆ—å»ºæ¨¡</li>
<li>è‡ªæ³¨æ„åŠ›æœºåˆ¶æ•è·é•¿è·ç¦»ä¾èµ–å…³ç³»</li>
<li>ä½ç½®ç¼–ç ä¿æŒæ—¶åºä¿¡æ¯çš„å®Œæ•´æ€§</li>
</ul>
</li>
<li><p><strong>ç‰¹å¾é€‰æ‹©ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><code>last_hidden_state</code>æä¾›æœ€é«˜å±‚çš„è¯­ä¹‰è¡¨ç¤º</li>
<li>è¿™ä¸€å±‚ç‰¹å¾æœ€é€‚åˆä¸‹æ¸¸åˆ†ç±»ä»»åŠ¡ï¼Œå¹³è¡¡äº†ç‰¹å¾æŠ½è±¡ç¨‹åº¦ä¸ä»»åŠ¡ç›¸å…³æ€§</li>
</ul>
</li>
</ol>
<h4 id="2-1-3-éŸ³é¢‘é¢„å¤„ç†çš„å·¥ç¨‹è€ƒé‡"><a href="#2-1-3-éŸ³é¢‘é¢„å¤„ç†çš„å·¥ç¨‹è€ƒé‡" class="headerlink" title="2.1.3 éŸ³é¢‘é¢„å¤„ç†çš„å·¥ç¨‹è€ƒé‡"></a>2.1.3 éŸ³é¢‘é¢„å¤„ç†çš„å·¥ç¨‹è€ƒé‡</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">process_wav_file</span><span class="token punctuation">(</span>wav_file<span class="token punctuation">,</span> time_seconds<span class="token punctuation">)</span><span class="token punctuation">:</span>
    waveform<span class="token punctuation">,</span> sample_rate <span class="token operator">=</span> torchaudio<span class="token punctuation">.</span>load<span class="token punctuation">(</span>wav_file<span class="token punctuation">)</span>
    target_length <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time_seconds <span class="token operator">*</span> sample_rate<span class="token punctuation">)</span>
    <span class="token keyword">if</span> waveform<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">></span> target_length<span class="token punctuation">:</span>
        waveform <span class="token operator">=</span> waveform<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>target_length<span class="token punctuation">]</span>  <span class="token comment"># æ—¶é—´è£å‰ª</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        padding_length <span class="token operator">=</span> target_length <span class="token operator">-</span> waveform<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        waveform <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>pad<span class="token punctuation">(</span>waveform<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> padding_length<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># é›¶å¡«å……</span>
    <span class="token keyword">return</span> waveform<span class="token punctuation">,</span> sample_rate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3ç§’å›ºå®šé•¿åº¦çš„è®¾è®¡rationale</strong>ï¼š</p>
<ul>
<li><strong>è®¡ç®—æ•ˆç‡</strong>ï¼šå›ºå®šé•¿åº¦ä¾¿äºæ‰¹å¤„ç†ï¼Œæé«˜GPUåˆ©ç”¨ç‡</li>
<li><strong>ä¿¡æ¯å……åˆ†æ€§</strong>ï¼š3ç§’è¶³ä»¥åŒ…å«å®Œæ•´çš„æƒ…æ„Ÿè¡¨è¾¾ï¼Œæ¶µç›–è¯æ±‡ã€éŸµå¾‹ã€è¯­è°ƒå˜åŒ–</li>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼šé¿å…å˜é•¿åºåˆ—å¸¦æ¥çš„å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜</li>
<li><strong>æ¨¡å‹ä¸€è‡´æ€§</strong>ï¼šç¡®ä¿è®­ç»ƒå’Œæ¨ç†é˜¶æ®µçš„è¾“å…¥æ ¼å¼å®Œå…¨ä¸€è‡´</li>
</ul>
<p><strong>é›¶å¡«å…… vs é‡å¤å¡«å……çš„é€‰æ‹©</strong>ï¼š</p>
<ul>
<li>é›¶å¡«å……é¿å…äº†äººå·¥å¼•å…¥çš„å‘¨æœŸæ€§æ¨¡å¼</li>
<li>ä¿æŒäº†åŸå§‹è¯­éŸ³çš„è‡ªç„¶è¾¹ç•Œç‰¹æ€§</li>
<li>ä¸HuBERTé¢„è®­ç»ƒæ—¶çš„å¤„ç†æ–¹å¼ä¿æŒä¸€è‡´</li>
</ul>
<h3 id="2-2-GRUModelåŒå‘åºåˆ—å»ºæ¨¡å™¨"><a href="#2-2-GRUModelåŒå‘åºåˆ—å»ºæ¨¡å™¨" class="headerlink" title="2.2 GRUModelåŒå‘åºåˆ—å»ºæ¨¡å™¨"></a>2.2 GRUModelåŒå‘åºåˆ—å»ºæ¨¡å™¨</h3><h4 id="2-2-1-æ¶æ„è®¾è®¡çš„æ·±å±‚é€»è¾‘"><a href="#2-2-1-æ¶æ„è®¾è®¡çš„æ·±å±‚é€»è¾‘" class="headerlink" title="2.2.1 æ¶æ„è®¾è®¡çš„æ·±å±‚é€»è¾‘"></a>2.2.1 æ¶æ„è®¾è®¡çš„æ·±å±‚é€»è¾‘</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">GRUModel</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">,</span> output_size<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>bigru <span class="token operator">=</span> nn<span class="token punctuation">.</span>GRU<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                           num_layers<span class="token operator">=</span>self<span class="token punctuation">.</span>num_layers<span class="token punctuation">,</span> bidirectional<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>input2hidden <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> hidden_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>hidden2label <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> output_size<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>åŒå‘GRUçš„ç†è®ºåŸºç¡€</strong>ï¼š</p>
<ul>
<li><strong>å‰å‘ä¿¡æ¯æµ</strong>ï¼šæ•è·ä»è¯­éŸ³å¼€å§‹åˆ°å½“å‰æ—¶åˆ»çš„æƒ…æ„Ÿå‘å±•è½¨è¿¹</li>
<li><strong>åå‘ä¿¡æ¯æµ</strong>ï¼šåˆ©ç”¨æœªæ¥ä¿¡æ¯ä¸ºå½“å‰æ—¶åˆ»æä¾›ä¸Šä¸‹æ–‡çº¦æŸ</li>
<li><strong>ä¿¡æ¯èåˆ</strong>ï¼šå‰åå‘éšçŠ¶æ€çš„æ‹¼æ¥æä¾›äº†æ›´å®Œæ•´çš„æ—¶åºè¡¨ç¤º</li>
</ul>
<p><strong>å¤šå±‚è®¾è®¡çš„å¿…è¦æ€§</strong>ï¼š</p>
<ul>
<li><strong>å±‚æ¬¡åŒ–æŠ½è±¡</strong>ï¼šåº•å±‚æ•è·å±€éƒ¨æ—¶åºæ¨¡å¼ï¼Œé«˜å±‚å»ºæ¨¡å…¨å±€æƒ…æ„ŸåŠ¨æ€</li>
<li><strong>éçº¿æ€§å¢å¼º</strong>ï¼šå¤šå±‚ç»“æ„å¢åŠ æ¨¡å‹çš„éçº¿æ€§è¡¨è¾¾èƒ½åŠ›</li>
<li><strong>æ¢¯åº¦æµä¼˜åŒ–</strong>ï¼šé€‚å½“çš„å±‚æ•°å¹³è¡¡äº†è¡¨è¾¾èƒ½åŠ›ä¸æ¢¯åº¦ä¼ æ’­æ•ˆç‡</li>
</ul>
<h4 id="2-2-2-å‰å‘ä¼ æ’­çš„ç²¾å¯†è®¾è®¡"><a href="#2-2-2-å‰å‘ä¼ æ’­çš„ç²¾å¯†è®¾è®¡" class="headerlink" title="2.2.2 å‰å‘ä¼ æ’­çš„ç²¾å¯†è®¾è®¡"></a>2.2.2 å‰å‘ä¼ æ’­çš„ç²¾å¯†è®¾è®¡</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> U<span class="token punctuation">)</span><span class="token punctuation">:</span>
    U <span class="token operator">=</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>U<span class="token punctuation">)</span>  <span class="token comment"># è¾“å…¥æ­£åˆ™åŒ–</span>
    emotions<span class="token punctuation">,</span> hidden <span class="token operator">=</span> self<span class="token punctuation">.</span>bigru<span class="token punctuation">(</span>U<span class="token punctuation">)</span>  <span class="token comment"># [batch, seq, 512]</span>
    
    <span class="token comment"># æ³¨æ„åŠ›æœºåˆ¶å¢å¼º</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>attention<span class="token punctuation">:</span>
        att_emotions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> t <span class="token keyword">in</span> emotions<span class="token punctuation">:</span>
            att_em<span class="token punctuation">,</span> alpha_ <span class="token operator">=</span> self<span class="token punctuation">.</span>matchatt<span class="token punctuation">(</span>emotions<span class="token punctuation">,</span> t<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
            att_emotions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>att_em<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        att_emotions <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>att_emotions<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        emotions <span class="token operator">=</span> att_emotions
    
    <span class="token comment"># å…¨å±€ç‰¹å¾èšåˆ</span>
    gru_out <span class="token operator">=</span> torch<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>emotions<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># [batch, 512, seq]</span>
    gru_out <span class="token operator">=</span> F<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>gru_out<span class="token punctuation">)</span>
    gru_out <span class="token operator">=</span> F<span class="token punctuation">.</span>max_pool1d<span class="token punctuation">(</span>gru_out<span class="token punctuation">,</span> gru_out<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># å…¨å±€æœ€å¤§æ± åŒ–</span>
    
    <span class="token comment"># åˆ†ç±»æ˜ å°„</span>
    Out_in <span class="token operator">=</span> self<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>gru_out<span class="token punctuation">)</span>
    Out_in <span class="token operator">=</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>Out_in<span class="token punctuation">)</span>
    Out_out <span class="token operator">=</span> self<span class="token punctuation">.</span>hidden2label<span class="token punctuation">(</span>Out_in<span class="token punctuation">)</span>  <span class="token comment"># [batch, num_classes]</span>
    <span class="token keyword">return</span> Out_out<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å…³é”®å¤„ç†æ­¥éª¤çš„æŠ€æœ¯åˆ†æ</strong>ï¼š</p>
<ol>
<li><p><strong>è¾“å…¥Dropout</strong>ï¼š</p>
<ul>
<li>åœ¨ç‰¹å¾å±‚é¢å¼•å…¥éšæœºæ€§ï¼Œå¢å¼ºæ¨¡å‹æ³›åŒ–èƒ½åŠ›</li>
<li>é˜²æ­¢æ¨¡å‹è¿‡åº¦ä¾èµ–HuBERTç‰¹å¾çš„ç‰¹å®šç»´åº¦</li>
</ul>
</li>
<li><p><strong>åŒå‘GRUå¤„ç†</strong>ï¼š</p>
<ul>
<li>è¾“å‡ºç»´åº¦ä¸º512ï¼ˆ256Ã—2ï¼‰ï¼Œèåˆå‰åå‘ä¿¡æ¯</li>
<li><code>batch_first=True</code>è®¾è®¡ä¾¿äºåç»­å¤„ç†å’Œè°ƒè¯•</li>
</ul>
</li>
<li><p><strong>æ³¨æ„åŠ›å¢å¼ºï¼ˆå¯é€‰ï¼‰</strong>ï¼š</p>
<ul>
<li>ä¸ºæ¯ä¸ªæ—¶é—´æ­¥è®¡ç®—å…¨å±€æ³¨æ„åŠ›æƒé‡</li>
<li>åŠ¨æ€è°ƒæ•´ä¸åŒæ—¶åˆ»ç‰¹å¾çš„é‡è¦æ€§</li>
<li>ç¼“è§£é•¿åºåˆ—ä¿¡æ¯è¡°å‡é—®é¢˜</li>
</ul>
</li>
<li><p><strong>å…¨å±€æœ€å¤§æ± åŒ–</strong>ï¼š</p>
<ul>
<li>æå–åºåˆ—ä¸­çš„æœ€æ˜¾è‘—ç‰¹å¾</li>
<li>å®ç°ä»å˜é•¿åºåˆ—åˆ°å›ºå®šé•¿åº¦è¡¨ç¤ºçš„è½¬æ¢</li>
<li>ä¿ç•™æœ€å¼ºçš„æƒ…æ„Ÿæ¿€æ´»ä¿¡å·</li>
</ul>
</li>
<li><p><strong>åˆ†ç±»å¤´æ˜ å°„</strong>ï¼š</p>
<ul>
<li>çº¿æ€§å˜æ¢å°†512ç»´ç‰¹å¾æ˜ å°„åˆ°4ç±»æƒ…æ„Ÿè¾“å‡º</li>
<li>æ— åç½®è®¾è®¡ç®€åŒ–æ¨¡å‹ï¼Œå‡å°‘è¿‡æ‹Ÿåˆé£é™©</li>
</ul>
</li>
</ol>
<h3 id="2-3-MatchingAttentionæ³¨æ„åŠ›æœºåˆ¶"><a href="#2-3-MatchingAttentionæ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="2.3 MatchingAttentionæ³¨æ„åŠ›æœºåˆ¶"></a>2.3 MatchingAttentionæ³¨æ„åŠ›æœºåˆ¶</h3><h4 id="2-3-1-æ³¨æ„åŠ›è®¾è®¡çš„ç†è®ºåŸºç¡€"><a href="#2-3-1-æ³¨æ„åŠ›è®¾è®¡çš„ç†è®ºåŸºç¡€" class="headerlink" title="2.3.1 æ³¨æ„åŠ›è®¾è®¡çš„ç†è®ºåŸºç¡€"></a>2.3.1 æ³¨æ„åŠ›è®¾è®¡çš„ç†è®ºåŸºç¡€</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MatchingAttention</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mem_dim<span class="token punctuation">,</span> cand_dim<span class="token punctuation">,</span> alpha_dim<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> att_type<span class="token operator">=</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> att_type<span class="token operator">==</span><span class="token string">'general'</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>transform <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>cand_dim<span class="token punctuation">,</span> mem_dim<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>æ³¨æ„åŠ›æœºåˆ¶çš„æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p>
<ul>
<li><strong>æŸ¥è¯¢-é”®-å€¼æ¨¡å¼</strong>ï¼šå°†å½“å‰æ—¶åˆ»ä½œä¸ºæŸ¥è¯¢ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºé”®å’Œå€¼</li>
<li><strong>ç›¸ä¼¼åº¦è®¡ç®—</strong>ï¼šé€šè¿‡å­¦ä¹ åˆ°çš„å˜æ¢çŸ©é˜µè®¡ç®—æŸ¥è¯¢ä¸é”®çš„åŒ¹é…ç¨‹åº¦</li>
<li><strong>åŠ¨æ€æƒé‡åˆ†é…</strong>ï¼šæ ¹æ®ç›¸ä¼¼åº¦ä¸ºä¸åŒæ—¶åˆ»åˆ†é…æ³¨æ„åŠ›æƒé‡</li>
</ul>
<p><strong>General Attentionçš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>ç»´åº¦çµæ´»æ€§</strong>ï¼šé€šè¿‡çº¿æ€§å˜æ¢å¤„ç†ä¸åŒç»´åº¦çš„è¾“å…¥</li>
<li><strong>å‚æ•°æ•ˆç‡</strong>ï¼šç›¸æ¯”concat attentionå‚æ•°æ›´å°‘ï¼Œè®­ç»ƒæ›´ç¨³å®š</li>
<li><strong>è®¡ç®—æ•ˆç‡</strong>ï¼šçŸ©é˜µä¹˜æ³•æ“ä½œä¾¿äºGPUå¹¶è¡ŒåŠ é€Ÿ</li>
</ul>
<h4 id="2-3-2-æ³¨æ„åŠ›è®¡ç®—çš„æ•°å­¦å®ç°"><a href="#2-3-2-æ³¨æ„åŠ›è®¡ç®—çš„æ•°å­¦å®ç°" class="headerlink" title="2.3.2 æ³¨æ„åŠ›è®¡ç®—çš„æ•°å­¦å®ç°"></a>2.3.2 æ³¨æ„åŠ›è®¡ç®—çš„æ•°å­¦å®ç°</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> M<span class="token punctuation">,</span> x<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># M: [seq_len, batch, mem_dim] - è®°å¿†åºåˆ—ï¼ˆæ‰€æœ‰æ—¶åˆ»çš„éšçŠ¶æ€ï¼‰</span>
    <span class="token comment"># x: [batch, cand_dim] - æŸ¥è¯¢å‘é‡ï¼ˆå½“å‰æ—¶åˆ»çš„éšçŠ¶æ€ï¼‰</span>
    
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>att_type<span class="token operator">==</span><span class="token string">'general'</span><span class="token punctuation">:</span>
        M_ <span class="token operator">=</span> M<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># [batch, mem_dim, seq_len]</span>
        x_ <span class="token operator">=</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># [batch, 1, mem_dim]</span>
        alpha <span class="token operator">=</span> F<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>bmm<span class="token punctuation">(</span>x_<span class="token punctuation">,</span> M_<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># [batch, 1, seq_len]</span>
    
    attn_pool <span class="token operator">=</span> torch<span class="token punctuation">.</span>bmm<span class="token punctuation">(</span>alpha<span class="token punctuation">,</span> M<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># [batch, mem_dim]</span>
    <span class="token keyword">return</span> attn_pool<span class="token punctuation">,</span> alpha<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>è®¡ç®—æµç¨‹çš„æ·±å±‚è§£æ</strong>ï¼š</p>
<ol>
<li><p><strong>æŸ¥è¯¢å˜æ¢</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x_ <span class="token operator">=</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># [batch, 1, mem_dim]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>å°†å½“å‰æ—¶åˆ»ç‰¹å¾å˜æ¢åˆ°è®°å¿†ç©ºé—´</li>
<li>å­¦ä¹ æŸ¥è¯¢ä¸è®°å¿†ä¹‹é—´çš„æœ€ä¼˜åŒ¹é…å…³ç³»</li>
</ul>
</li>
<li><p><strong>ç›¸ä¼¼åº¦è®¡ç®—</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">alpha <span class="token operator">=</span> F<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>bmm<span class="token punctuation">(</span>x_<span class="token punctuation">,</span> M_<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># [batch, 1, seq_len]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>æ‰¹é‡çŸ©é˜µä¹˜æ³•è®¡ç®—æ‰€æœ‰æ—¶åˆ»çš„ç›¸ä¼¼åº¦åˆ†æ•°</li>
<li>Softmaxå½’ä¸€åŒ–ç¡®ä¿æƒé‡å’Œä¸º1</li>
</ul>
</li>
<li><p><strong>åŠ æƒèšåˆ</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">attn_pool <span class="token operator">=</span> torch<span class="token punctuation">.</span>bmm<span class="token punctuation">(</span>alpha<span class="token punctuation">,</span> M<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># [batch, mem_dim]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>æ ¹æ®æ³¨æ„åŠ›æƒé‡å¯¹æ‰€æœ‰æ—¶åˆ»ç‰¹å¾è¿›è¡ŒåŠ æƒå¹³å‡</li>
<li>ç”Ÿæˆèåˆå…¨å±€ä¿¡æ¯çš„ä¸Šä¸‹æ–‡å‘é‡</li>
</ul>
</li>
</ol>
<h4 id="2-3-3-æ³¨æ„åŠ›åœ¨æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä½œç”¨æœºåˆ¶"><a href="#2-3-3-æ³¨æ„åŠ›åœ¨æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä½œç”¨æœºåˆ¶" class="headerlink" title="2.3.3 æ³¨æ„åŠ›åœ¨æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä½œç”¨æœºåˆ¶"></a>2.3.3 æ³¨æ„åŠ›åœ¨æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä½œç”¨æœºåˆ¶</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> self<span class="token punctuation">.</span>attention<span class="token punctuation">:</span>
    att_emotions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    alpha <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> t <span class="token keyword">in</span> emotions<span class="token punctuation">:</span>  <span class="token comment"># å¯¹åºåˆ—ä¸­æ¯ä¸ªæ—¶é—´æ­¥</span>
        att_em<span class="token punctuation">,</span> alpha_ <span class="token operator">=</span> self<span class="token punctuation">.</span>matchatt<span class="token punctuation">(</span>emotions<span class="token punctuation">,</span> t<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
        att_emotions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>att_em<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        alpha<span class="token punctuation">.</span>append<span class="token punctuation">(</span>alpha_<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    att_emotions <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>att_emotions<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    emotions <span class="token operator">=</span> att_emotions<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>æ³¨æ„åŠ›å¢å¼ºçš„æƒ…æ„Ÿå»ºæ¨¡ä»·å€¼</strong>ï¼š</p>
<ol>
<li><p><strong>å…³é”®æ—¶åˆ»è¯†åˆ«</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨è¯†åˆ«è¯­éŸ³ä¸­æƒ…æ„Ÿè¡¨è¾¾æœ€å¼ºçƒˆçš„æ—¶é—´æ®µ</li>
<li>ä¾‹å¦‚ï¼šè¯­è°ƒå˜åŒ–å‰§çƒˆçš„è¯æ±‡ã€åœé¡¿å‰åçš„é‡éŸ³</li>
</ul>
</li>
<li><p><strong>ä¸Šä¸‹æ–‡æ•´åˆ</strong>ï¼š</p>
<ul>
<li>ä¸ºæ¯ä¸ªæ—¶åˆ»æä¾›å…¨åºåˆ—çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
<li>é¿å…å±€éƒ¨ç‰¹å¾çš„è¯¯å¯¼ï¼Œæé«˜åˆ†ç±»ç¨³å®šæ€§</li>
</ul>
</li>
<li><p><strong>é•¿è·ç¦»ä¾èµ–å»ºæ¨¡</strong>ï¼š</p>
<ul>
<li>ç¼“è§£GRUåœ¨é•¿åºåˆ—ä¸Šçš„ä¿¡æ¯è¡°å‡é—®é¢˜</li>
<li>ä¿æŒåºåˆ—å¼€å§‹å’Œç»“æŸéƒ¨åˆ†ä¿¡æ¯çš„æœ‰æ•ˆä¼ é€’</li>
</ul>
</li>
<li><p><strong>å¯è§£é‡Šæ€§å¢å¼º</strong>ï¼š</p>
<ul>
<li>æ³¨æ„åŠ›æƒé‡æä¾›æ¨¡å‹å†³ç­–çš„å¯è§†åŒ–ä¾æ®</li>
<li>å¸®åŠ©ç†è§£æ¨¡å‹å…³æ³¨çš„è¯­éŸ³ç‰¹å¾æ¨¡å¼</li>
</ul>
</li>
</ol>
<h3 id="2-4-åˆ†ç±»å¤´ä¸æ¿€æ´»å‡½æ•°çš„ç²¾å¿ƒè®¾è®¡"><a href="#2-4-åˆ†ç±»å¤´ä¸æ¿€æ´»å‡½æ•°çš„ç²¾å¿ƒè®¾è®¡" class="headerlink" title="2.4 åˆ†ç±»å¤´ä¸æ¿€æ´»å‡½æ•°çš„ç²¾å¿ƒè®¾è®¡"></a>2.4 åˆ†ç±»å¤´ä¸æ¿€æ´»å‡½æ•°çš„ç²¾å¿ƒè®¾è®¡</h3><h4 id="2-4-1-åˆ†ç±»å¤´çš„æ¶æ„é€‰æ‹©"><a href="#2-4-1-åˆ†ç±»å¤´çš„æ¶æ„é€‰æ‹©" class="headerlink" title="2.4.1 åˆ†ç±»å¤´çš„æ¶æ„é€‰æ‹©"></a>2.4.1 åˆ†ç±»å¤´çš„æ¶æ„é€‰æ‹©</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">.</span>hidden2label <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> output_size<span class="token punctuation">)</span>  <span class="token comment"># 512 -> 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>çº¿æ€§åˆ†ç±»å¤´çš„è®¾è®¡è€ƒé‡</strong>ï¼š</p>
<ul>
<li><strong>ç®€æ´æ€§åŸåˆ™</strong>ï¼šé¿å…è¿‡åº¦å¤æ‚çš„åˆ†ç±»å™¨ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</li>
<li><strong>ç‰¹å¾å……åˆ†æ€§</strong>ï¼š512ç»´GRUè¾“å‡ºå·²åŒ…å«ä¸°å¯Œçš„æƒ…æ„Ÿåˆ¤åˆ«ä¿¡æ¯</li>
<li><strong>è®¡ç®—æ•ˆç‡</strong>ï¼šçº¿æ€§å˜æ¢è®¡ç®—ç®€å•ï¼Œä¾¿äºå®æ—¶åº”ç”¨</li>
</ul>
<h4 id="2-4-2-æ¿€æ´»å‡½æ•°çš„å±‚æ¬¡åŒ–åº”ç”¨"><a href="#2-4-2-æ¿€æ´»å‡½æ•°çš„å±‚æ¬¡åŒ–åº”ç”¨" class="headerlink" title="2.4.2 æ¿€æ´»å‡½æ•°çš„å±‚æ¬¡åŒ–åº”ç”¨"></a>2.4.2 æ¿€æ´»å‡½æ•°çš„å±‚æ¬¡åŒ–åº”ç”¨</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">gru_out <span class="token operator">=</span> F<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>gru_out<span class="token punctuation">)</span>      <span class="token comment"># åºåˆ—ç‰¹å¾æ¿€æ´»</span>
Out_in <span class="token operator">=</span> self<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>gru_out<span class="token punctuation">)</span>    <span class="token comment"># åˆ†ç±»å‰æ¿€æ´»</span>
<span class="token comment"># åˆ†ç±»å±‚æ— æ¿€æ´»ï¼Œè¾“å‡ºåŸå§‹logits</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>æ¿€æ´»å‡½æ•°é€‰æ‹©çš„æ·±å±‚é€»è¾‘</strong>ï¼š</p>
<ol>
<li><p><strong>Tanhæ¿€æ´»</strong>ï¼š</p>
<ul>
<li>å°†åºåˆ—ç‰¹å¾å‹ç¼©åˆ°[-1,1]åŒºé—´</li>
<li>å¢å¼ºç‰¹å¾çš„å¯¹æ¯”åº¦ï¼Œçªå‡ºæ˜¾è‘—å˜åŒ–</li>
<li>å¯¹ç§°æ€§è´¨é€‚åˆåŒå‘GRUçš„è¾“å‡ºç‰¹å¾</li>
</ul>
</li>
<li><p><strong>LeakyReLUæ¿€æ´»</strong>ï¼š</p>
<ul>
<li>ä¿æŒæ¢¯åº¦æµåŠ¨ï¼Œé¿å…æ­»ç¥ç»å…ƒé—®é¢˜</li>
<li>è´Ÿæ–œç‡å‚æ•°å…è®¸è´Ÿå€¼ä¿¡æ¯çš„éƒ¨åˆ†ä¿ç•™</li>
<li>åœ¨åˆ†ç±»å‰æä¾›éçº¿æ€§å˜æ¢èƒ½åŠ›</li>
</ul>
</li>
<li><p><strong>æ— æ¿€æ´»è¾“å‡º</strong>ï¼š</p>
<ul>
<li>åˆ†ç±»å±‚è¾“å‡ºåŸå§‹logitsï¼Œä¾¿äºäº¤å‰ç†µæŸå¤±è®¡ç®—</li>
<li>ä¿æŒæ•°å€¼ç¨³å®šæ€§ï¼Œé¿å…æ¢¯åº¦æ¶ˆå¤±</li>
</ul>
</li>
</ol>
<hr>
<h2 id="3-å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ"><a href="#3-å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ" class="headerlink" title="3. å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ"></a>3. å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ</h2><h3 id="3-1-è®­ç»ƒé˜¶æ®µæ•°æ®æµ"><a href="#3-1-è®­ç»ƒé˜¶æ®µæ•°æ®æµ" class="headerlink" title="3.1 è®­ç»ƒé˜¶æ®µæ•°æ®æµ"></a>3.1 è®­ç»ƒé˜¶æ®µæ•°æ®æµ</h3><p><strong>è®­ç»ƒæµç¨‹çš„å…³é”®ç¯èŠ‚åˆ†æ</strong>ï¼š</p>
<ol>
<li><p><strong>æ•°æ®é¢„å¤„ç†é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>IEMOCAPæ•°æ®é›†åŒ…å«å¤šç§æƒ…æ„Ÿç±»åˆ«ï¼Œéœ€è¦æ ‡å‡†åŒ–æ˜ å°„</li>
<li>éŸ³é¢‘é•¿åº¦ä¸ä¸€è‡´é—®é¢˜é€šè¿‡3ç§’å›ºå®šé•¿åº¦ç­–ç•¥è§£å†³</li>
<li>é‡‡æ ·ç‡ç»Ÿä¸€ä¸º16kHzï¼ŒåŒ¹é…HuBERTé¢„è®­ç»ƒé…ç½®</li>
</ul>
</li>
<li><p><strong>ç‰¹å¾æå–é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>HuBERTæ¨¡å‹å†»ç»“å‚æ•°ï¼Œä»…ç”¨äºç‰¹å¾æå–</li>
<li>768ç»´ç‰¹å¾å‘é‡åŒ…å«ä¸°å¯Œçš„è¯­éŸ³è¯­ä¹‰ä¿¡æ¯</li>
<li>æ‰¹å¤„ç†æ–¹å¼æé«˜ç‰¹å¾æå–æ•ˆç‡</li>
</ul>
</li>
<li><p><strong>æ¨¡å‹è®­ç»ƒé˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>5æŠ˜äº¤å‰éªŒè¯ç¡®ä¿ç»“æœçš„ç»Ÿè®¡æ˜¾è‘—æ€§</li>
<li>æ‰¹æ¬¡å¤§å°32å¹³è¡¡å†…å­˜å ç”¨ä¸æ¢¯åº¦ä¼°è®¡è´¨é‡</li>
<li>AdamWä¼˜åŒ–å™¨ç»“åˆæƒé‡è¡°å‡ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</li>
</ul>
</li>
<li><p><strong>æ¨¡å‹ä¿å­˜é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>ä¿å­˜å®Œæ•´çš„state_dictï¼Œä¾¿äºåç»­åŠ è½½</li>
<li>æ¨¡å‹æ–‡ä»¶åŒ…å«æ‰€æœ‰å¯è®­ç»ƒå‚æ•°</li>
</ul>
</li>
</ol>
<h3 id="3-2-æ¨ç†é˜¶æ®µæ•°æ®æµ"><a href="#3-2-æ¨ç†é˜¶æ®µæ•°æ®æµ" class="headerlink" title="3.2 æ¨ç†é˜¶æ®µæ•°æ®æµ"></a>3.2 æ¨ç†é˜¶æ®µæ•°æ®æµ</h3><p><strong>æ¨ç†æµç¨‹çš„æŠ€æœ¯ç»†èŠ‚</strong>ï¼š</p>
<ol>
<li><p><strong>è¾“å…¥å¤„ç†å¤šæ ·æ€§</strong>ï¼š</p>
<ul>
<li>æ”¯æŒWAVæ–‡ä»¶å’Œå®æ—¶éº¦å…‹é£ä¸¤ç§è¾“å…¥æ¨¡å¼</li>
<li>ç»Ÿä¸€çš„é¢„å¤„ç†æµç¨‹ç¡®ä¿è¾“å…¥æ ¼å¼ä¸€è‡´æ€§</li>
</ul>
</li>
<li><p><strong>ç‰¹å¾æå–ä¸€è‡´æ€§</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ä¸è®­ç»ƒæ—¶ç›¸åŒçš„processorå’Œé¢„å¤„ç†å‚æ•°</li>
<li>ç¡®ä¿ç‰¹å¾åˆ†å¸ƒçš„ä¸€è‡´æ€§</li>
</ul>
</li>
<li><p><strong>æ¨¡å‹æ¨ç†ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li><code>torch.no_grad()</code>ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡å°‘å†…å­˜å ç”¨</li>
<li>æ‰¹å¤„ç†ç»´åº¦çš„åŠ¨æ€è°ƒæ•´é€‚åº”ä¸åŒè¾“å…¥æ ¼å¼</li>
</ul>
</li>
<li><p><strong>ç»“æœåå¤„ç†</strong>ï¼š</p>
<ul>
<li>Softmaxæä¾›æ¦‚ç‡åˆ†å¸ƒï¼Œå¢å¼ºç»“æœå¯ä¿¡åº¦</li>
<li>ç½®ä¿¡åº¦è®¡ç®—å¸®åŠ©è¯„ä¼°é¢„æµ‹è´¨é‡</li>
</ul>
</li>
</ol>
<h3 id="3-3-GUIå®æ—¶å¤„ç†æµ"><a href="#3-3-GUIå®æ—¶å¤„ç†æµ" class="headerlink" title="3.3 GUIå®æ—¶å¤„ç†æµ"></a>3.3 GUIå®æ—¶å¤„ç†æµ</h3><p><strong>å®æ—¶å¤„ç†çš„å·¥ç¨‹æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li><p><strong>çº¿ç¨‹å®‰å…¨è®¾è®¡</strong>ï¼š</p>
<ul>
<li>AudioRecorderç‹¬ç«‹çº¿ç¨‹é¿å…UIé˜»å¡</li>
<li>ä¿¡å·-æ§½æœºåˆ¶ç¡®ä¿çº¿ç¨‹é—´å®‰å…¨é€šä¿¡</li>
</ul>
</li>
<li><p><strong>éŸ³é¢‘ç¼“å†²ç®¡ç†</strong>ï¼š</p>
<ul>
<li>æ»‘åŠ¨çª—å£æœºåˆ¶ä¿æŒæœ€æ–°5ç§’éŸ³é¢‘</li>
<li>è‡ªåŠ¨å†…å­˜ç®¡ç†é¿å…ç¼“å†²åŒºæº¢å‡º</li>
</ul>
</li>
<li><p><strong>å®æ—¶æ€§èƒ½ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>æ¨¡å‹é¢„åŠ è½½å‡å°‘æ¨ç†å»¶è¿Ÿ</li>
<li>å¼‚æ­¥å¤„ç†æé«˜å“åº”é€Ÿåº¦</li>
</ul>
</li>
<li><p><strong>ç”¨æˆ·ä½“éªŒè®¾è®¡</strong>ï¼š</p>
<ul>
<li>å®æ—¶åé¦ˆæä¾›å³æ—¶æƒ…æ„Ÿè¯†åˆ«ç»“æœ</li>
<li>å†å²è®°å½•åŠŸèƒ½æ”¯æŒç»“æœå›é¡¾</li>
</ul>
</li>
</ol>
<hr>
<h2 id="4-å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“"><a href="#4-å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“" class="headerlink" title="4. å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“"></a>4. å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“</h2><h3 id="4-1-æ¨¡å‹ç»“æ„å‚æ•°æ·±åº¦åˆ†æ"><a href="#4-1-æ¨¡å‹ç»“æ„å‚æ•°æ·±åº¦åˆ†æ" class="headerlink" title="4.1 æ¨¡å‹ç»“æ„å‚æ•°æ·±åº¦åˆ†æ"></a>4.1 æ¨¡å‹ç»“æ„å‚æ•°æ·±åº¦åˆ†æ</h3><table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>é»˜è®¤å€¼</th>
<th>å‚æ•°å«ä¹‰</th>
<th>æ€§èƒ½å½±å“æœºåˆ¶</th>
<th>è°ƒä¼˜å»ºè®®</th>
</tr>
</thead>
<tbody><tr>
<td><code>hidden_size</code></td>
<td>256</td>
<td>GRUéšçŠ¶æ€ç»´åº¦</td>
<td><strong>è¡¨è¾¾èƒ½åŠ›</strong>ï¼šæ›´å¤§ç»´åº¦æä¾›æ›´å¼ºç‰¹å¾è¡¨è¾¾<br><strong>è®¡ç®—å¤æ‚åº¦</strong>ï¼šçº¿æ€§å½±å“å‚æ•°é‡å’Œè®¡ç®—æ—¶é—´<br><strong>è¿‡æ‹Ÿåˆé£é™©</strong>ï¼šè¿‡å¤§å¯èƒ½å¯¼è‡´è®­ç»ƒè¿‡æ‹Ÿåˆ</td>
<td>128-512èŒƒå›´å†…è°ƒä¼˜<br>ç»“åˆdropouté˜²è¿‡æ‹Ÿåˆ</td>
</tr>
<tr>
<td><code>dia_layers</code></td>
<td>2</td>
<td>GRUå †å å±‚æ•°</td>
<td><strong>æŠ½è±¡å±‚æ¬¡</strong>ï¼šå¤šå±‚æä¾›æ›´æ·±å±‚æ¬¡çš„ç‰¹å¾æŠ½è±¡<br><strong>æ¢¯åº¦ä¼ æ’­</strong>ï¼šè¿‡æ·±å¯èƒ½å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±<br><strong>è®­ç»ƒç¨³å®šæ€§</strong>ï¼šå±‚æ•°é€‚ä¸­ä¿è¯è®­ç»ƒç¨³å®š</td>
<td>1-4å±‚ä¸ºå®œ<br>é…åˆæ¢¯åº¦è£å‰ªä½¿ç”¨</td>
</tr>
<tr>
<td><code>utt_insize</code></td>
<td>768</td>
<td>HuBERTè¾“å‡ºç»´åº¦</td>
<td><strong>ç‰¹å¾ä¸°å¯Œåº¦</strong>ï¼šå›ºå®šå€¼ï¼Œç”±é¢„è®­ç»ƒæ¨¡å‹å†³å®š<br><strong>åŒ¹é…è¦æ±‚</strong>ï¼šå¿…é¡»ä¸HuBERTè¾“å‡ºç»´åº¦ä¸€è‡´</td>
<td>ä¸å¯è°ƒæ•´<br>ç”±é¢„è®­ç»ƒæ¨¡å‹å†³å®š</td>
</tr>
<tr>
<td><code>out_class</code></td>
<td>4</td>
<td>æƒ…æ„Ÿç±»åˆ«æ•°é‡</td>
<td><strong>ä»»åŠ¡å¤æ‚åº¦</strong>ï¼šç±»åˆ«æ•°ç›´æ¥å½±å“åˆ†ç±»éš¾åº¦<br><strong>æ•°æ®å¹³è¡¡</strong>ï¼šéœ€è¦å„ç±»åˆ«æ ·æœ¬ç›¸å¯¹å¹³è¡¡</td>
<td>æ ¹æ®å…·ä½“ä»»åŠ¡ç¡®å®š<br>è€ƒè™‘ç±»åˆ«å¹³è¡¡ç­–ç•¥</td>
</tr>
</tbody></table>
<h3 id="4-2-è®­ç»ƒè¶…å‚æ•°æ·±åº¦åˆ†æ"><a href="#4-2-è®­ç»ƒè¶…å‚æ•°æ·±åº¦åˆ†æ" class="headerlink" title="4.2 è®­ç»ƒè¶…å‚æ•°æ·±åº¦åˆ†æ"></a>4.2 è®­ç»ƒè¶…å‚æ•°æ·±åº¦åˆ†æ</h3><table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>é»˜è®¤å€¼</th>
<th>å‚æ•°å«ä¹‰</th>
<th>æ€§èƒ½å½±å“æœºåˆ¶</th>
<th>è°ƒä¼˜ç­–ç•¥</th>
</tr>
</thead>
<tbody><tr>
<td><code>learning_rate</code></td>
<td>1e-5</td>
<td>å­¦ä¹ ç‡</td>
<td><strong>æ”¶æ•›é€Ÿåº¦</strong>ï¼šè¿‡å¤§æ˜“éœ‡è¡ï¼Œè¿‡å°æ”¶æ•›æ…¢<br><strong>æœ€ç»ˆæ€§èƒ½</strong>ï¼šå½±å“æ¨¡å‹æ”¶æ•›åˆ°çš„å±€éƒ¨æœ€ä¼˜è§£<br><strong>è®­ç»ƒç¨³å®šæ€§</strong>ï¼šé€‚å½“å­¦ä¹ ç‡ä¿è¯è®­ç»ƒç¨³å®š</td>
<td>1e-6åˆ°1e-4èŒƒå›´<br>ä½¿ç”¨å­¦ä¹ ç‡è°ƒåº¦</td>
</tr>
<tr>
<td><code>dropout</code></td>
<td>0.2</td>
<td>éšæœºå¤±æ´»æ¦‚ç‡</td>
<td><strong>æ­£åˆ™åŒ–å¼ºåº¦</strong>ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆçš„å…³é”®å‚æ•°<br><strong>æ¨¡å‹å®¹é‡</strong>ï¼šè¿‡å¤§å½±å“æ¨¡å‹è¡¨è¾¾èƒ½åŠ›<br><strong>æ³›åŒ–èƒ½åŠ›</strong>ï¼šé€‚å½“dropoutæå‡æ³›åŒ–æ€§èƒ½</td>
<td>0.1-0.5èŒƒå›´è°ƒä¼˜<br>æ ¹æ®æ•°æ®é›†å¤§å°è°ƒæ•´</td>
</tr>
<tr>
<td><code>batch_size</code></td>
<td>32</td>
<td>æ‰¹æ¬¡å¤§å°</td>
<td><strong>æ¢¯åº¦ä¼°è®¡</strong>ï¼šå½±å“æ¢¯åº¦ä¼°è®¡çš„å‡†ç¡®æ€§<br><strong>å†…å­˜å ç”¨</strong>ï¼šç›´æ¥å½±å“GPUå†…å­˜éœ€æ±‚<br><strong>è®­ç»ƒé€Ÿåº¦</strong>ï¼šå½±å“æ¯ä¸ªepochçš„è®­ç»ƒæ—¶é—´</td>
<td>16-64æ ¹æ®æ˜¾å­˜è°ƒæ•´<br>è€ƒè™‘æ¢¯åº¦ç´¯ç§¯</td>
</tr>
<tr>
<td><code>attention</code></td>
<td>True</td>
<td>æ³¨æ„åŠ›æœºåˆ¶å¼€å…³</td>
<td><strong>é•¿åºåˆ—å»ºæ¨¡</strong>ï¼šæå‡é•¿è·ç¦»ä¾èµ–æ•è·èƒ½åŠ›<br><strong>è®¡ç®—å¼€é”€</strong>ï¼šå¢åŠ çº¦20%çš„è®¡ç®—æ—¶é—´<br><strong>æ¨¡å‹å¤æ‚åº¦</strong>ï¼šå¢åŠ æ¨¡å‹å‚æ•°é‡</td>
<td>æ ¹æ®åºåˆ—é•¿åº¦å†³å®š<br>çŸ­åºåˆ—å¯å…³é—­</td>
</tr>
</tbody></table>
<h3 id="4-3-æ•°æ®å¤„ç†å‚æ•°æ·±åº¦åˆ†æ"><a href="#4-3-æ•°æ®å¤„ç†å‚æ•°æ·±åº¦åˆ†æ" class="headerlink" title="4.3 æ•°æ®å¤„ç†å‚æ•°æ·±åº¦åˆ†æ"></a>4.3 æ•°æ®å¤„ç†å‚æ•°æ·±åº¦åˆ†æ</h3><table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>é»˜è®¤å€¼</th>
<th>å‚æ•°å«ä¹‰</th>
<th>æ€§èƒ½å½±å“æœºåˆ¶</th>
<th>è®¾è®¡è€ƒé‡</th>
</tr>
</thead>
<tbody><tr>
<td><code>time_seconds</code></td>
<td>3</td>
<td>éŸ³é¢‘å›ºå®šé•¿åº¦</td>
<td><strong>ä¿¡æ¯å®Œæ•´æ€§</strong>ï¼šæ—¶é•¿å½±å“æƒ…æ„Ÿä¿¡æ¯çš„å®Œæ•´æ€§<br><strong>è®¡ç®—æ•ˆç‡</strong>ï¼šé•¿åº¦ç›´æ¥å½±å“è®¡ç®—å¤æ‚åº¦<br><strong>å†…å­˜å ç”¨</strong>ï¼šå½±å“æ‰¹å¤„ç†çš„å†…å­˜éœ€æ±‚</td>
<td>2-5ç§’èŒƒå›´å†…<br>å¹³è¡¡ä¿¡æ¯ä¸æ•ˆç‡</td>
</tr>
<tr>
<td><code>sample_rate</code></td>
<td>16000</td>
<td>éŸ³é¢‘é‡‡æ ·ç‡</td>
<td><strong>é¢‘ç‡åˆ†è¾¨ç‡</strong>ï¼šå½±å“é«˜é¢‘ä¿¡æ¯çš„ä¿ç•™<br><strong>å…¼å®¹æ€§</strong>ï¼šéœ€åŒ¹é…é¢„è®­ç»ƒæ¨¡å‹è¦æ±‚<br><strong>æ•°æ®å¤§å°</strong>ï¼šå½±å“éŸ³é¢‘æ•°æ®çš„å­˜å‚¨ç©ºé—´</td>
<td>å›ºå®š16kHz<br>åŒ¹é…HuBERTè¦æ±‚</td>
</tr>
<tr>
<td><code>num_folds</code></td>
<td>5</td>
<td>äº¤å‰éªŒè¯æŠ˜æ•°</td>
<td><strong>è¯„ä¼°å¯é æ€§</strong>ï¼šæŠ˜æ•°è¶Šå¤šè¯„ä¼°è¶Šå¯é <br><strong>è®¡ç®—æˆæœ¬</strong>ï¼šæŠ˜æ•°å½±å“æ€»è®­ç»ƒæ—¶é—´<br><strong>ç»Ÿè®¡æ˜¾è‘—æ€§</strong>ï¼šå½±å“ç»“æœçš„ç»Ÿè®¡æ„ä¹‰</td>
<td>5-10æŠ˜ä¸ºå®œ<br>å¹³è¡¡å¯é æ€§ä¸æˆæœ¬</td>
</tr>
</tbody></table>
<h3 id="4-4-å‚æ•°è°ƒä¼˜çš„ç³»ç»Ÿæ€§æ–¹æ³•"><a href="#4-4-å‚æ•°è°ƒä¼˜çš„ç³»ç»Ÿæ€§æ–¹æ³•" class="headerlink" title="4.4 å‚æ•°è°ƒä¼˜çš„ç³»ç»Ÿæ€§æ–¹æ³•"></a>4.4 å‚æ•°è°ƒä¼˜çš„ç³»ç»Ÿæ€§æ–¹æ³•</h3><p><strong>å±‚æ¬¡åŒ–è°ƒä¼˜ç­–ç•¥</strong>ï¼š</p>
<ol>
<li><strong>æ¶æ„å‚æ•°</strong>ï¼šå…ˆç¡®å®šhidden_sizeå’Œdia_layers</li>
<li><strong>è®­ç»ƒå‚æ•°</strong>ï¼šå†è°ƒä¼˜learning_rateå’Œdropout</li>
<li><strong>æ•°æ®å‚æ•°</strong>ï¼šæœ€åä¼˜åŒ–batch_sizeå’Œtime_seconds</li>
</ol>
<p><strong>æ€§èƒ½ç›‘æ§æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><strong>è®­ç»ƒæŒ‡æ ‡</strong>ï¼šæŸå¤±å‡½æ•°æ”¶æ•›æ›²çº¿ã€æ¢¯åº¦èŒƒæ•°</li>
<li><strong>éªŒè¯æŒ‡æ ‡</strong>ï¼šå‡†ç¡®ç‡ã€F1åˆ†æ•°ã€æ··æ·†çŸ©é˜µ</li>
<li><strong>æ•ˆç‡æŒ‡æ ‡</strong>ï¼šè®­ç»ƒæ—¶é—´ã€å†…å­˜å ç”¨ã€æ¨ç†é€Ÿåº¦</li>
</ul>
<hr>
<h2 id="5-æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£"><a href="#5-æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£" class="headerlink" title="5. æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£"></a>5. æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£</h2><h3 id="5-1-è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ·±å±‚ä»·å€¼"><a href="#5-1-è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ·±å±‚ä»·å€¼" class="headerlink" title="5.1 è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ·±å±‚ä»·å€¼"></a>5.1 è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ·±å±‚ä»·å€¼</h3><p>HuBERTæ¨¡å‹çš„é¢„è®­ç»ƒæœºåˆ¶ä½“ç°äº†ç°ä»£è¯­éŸ³å¤„ç†çš„æ ¸å¿ƒæ€æƒ³ï¼š</p>
<p><strong>æ©ç é¢„æµ‹ä»»åŠ¡çš„è®¾è®¡æ™ºæ…§</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># HuBERTé¢„è®­ç»ƒä¼ªä»£ç ç¤ºä¾‹</span>
masked_features <span class="token operator">=</span> mask_features<span class="token punctuation">(</span>input_features<span class="token punctuation">,</span> mask_prob<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">)</span>
predicted_features <span class="token operator">=</span> hubert_model<span class="token punctuation">(</span>masked_features<span class="token punctuation">)</span>
loss <span class="token operator">=</span> mse_loss<span class="token punctuation">(</span>predicted_features<span class="token punctuation">,</span> target_features<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å¤šå±‚æ¬¡ç‰¹å¾å­¦ä¹ æœºåˆ¶</strong>ï¼š</p>
<ul>
<li><strong>å£°å­¦å±‚é¢</strong>ï¼šåº•å±‚Transformerå±‚å­¦ä¹ éŸ³ç´ ã€éŸ³è°ƒã€è¯­é€Ÿç­‰åŸºç¡€å£°å­¦ç‰¹å¾</li>
<li><strong>è¯­è¨€å±‚é¢</strong>ï¼šä¸­å±‚å­¦ä¹ è¯æ±‡è¾¹ç•Œã€è¯­æ³•ç»“æ„ã€è¯­ä¹‰å…³ç³»</li>
<li><strong>éŸµå¾‹å±‚é¢</strong>ï¼šé«˜å±‚æ•è·èŠ‚å¥ã€é‡éŸ³ã€è¯­è°ƒå˜åŒ–ï¼Œè¿™äº›ç‰¹å¾ä¸æƒ…æ„Ÿè¡¨è¾¾å¯†åˆ‡ç›¸å…³</li>
</ul>
<p><strong>è¿ç§»å­¦ä¹ çš„æœ‰æ•ˆæ€§</strong>ï¼š</p>
<ul>
<li>é¢„è®­ç»ƒç‰¹å¾åŒ…å«ä¸°å¯Œçš„è¯­éŸ³é€šç”¨è¡¨ç¤º</li>
<li>åœ¨æƒ…æ„Ÿè¯†åˆ«ä»»åŠ¡ä¸Šå¾®è°ƒæ—¶ï¼Œæ¨¡å‹èƒ½å¿«é€Ÿé€‚åº”ç‰¹å®šé¢†åŸŸç‰¹å¾</li>
<li>ç›¸æ¯”ä»é›¶è®­ç»ƒï¼Œæ˜¾è‘—å‡å°‘äº†æ‰€éœ€çš„æ ‡æ³¨æ•°æ®é‡</li>
</ul>
<h3 id="5-2-åºåˆ—å»ºæ¨¡çš„æ—¶åºä¾èµ–æœºåˆ¶"><a href="#5-2-åºåˆ—å»ºæ¨¡çš„æ—¶åºä¾èµ–æœºåˆ¶" class="headerlink" title="5.2 åºåˆ—å»ºæ¨¡çš„æ—¶åºä¾èµ–æœºåˆ¶"></a>5.2 åºåˆ—å»ºæ¨¡çš„æ—¶åºä¾èµ–æœºåˆ¶</h3><p>åŒå‘GRUçš„é—¨æ§æœºåˆ¶å®ç°äº†å¯¹æ—¶åºä¿¡æ¯çš„ç²¾ç¡®æ§åˆ¶ï¼š</p>
<p><strong>é—¨æ§æœºåˆ¶çš„æ•°å­¦è¡¨è¾¾</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># GRUé—¨æ§æœºåˆ¶ä¼ªä»£ç </span>
reset_gate <span class="token operator">=</span> sigmoid<span class="token punctuation">(</span>W_r @ <span class="token punctuation">[</span>h_prev<span class="token punctuation">,</span> x_t<span class="token punctuation">]</span><span class="token punctuation">)</span>
update_gate <span class="token operator">=</span> sigmoid<span class="token punctuation">(</span>W_u @ <span class="token punctuation">[</span>h_prev<span class="token punctuation">,</span> x_t<span class="token punctuation">]</span><span class="token punctuation">)</span>
candidate_h <span class="token operator">=</span> tanh<span class="token punctuation">(</span>W_h @ <span class="token punctuation">[</span>reset_gate <span class="token operator">*</span> h_prev<span class="token punctuation">,</span> x_t<span class="token punctuation">]</span><span class="token punctuation">)</span>
h_t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> update_gate<span class="token punctuation">)</span> <span class="token operator">*</span> h_prev <span class="token operator">+</span> update_gate <span class="token operator">*</span> candidate_h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>åŒå‘ä¿¡æ¯èåˆçš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>å‰å‘æµ</strong>ï¼šæ•è·ä»è¯­éŸ³å¼€å§‹åˆ°å½“å‰ä½ç½®çš„æƒ…æ„Ÿå‘å±•è¶‹åŠ¿</li>
<li><strong>åå‘æµ</strong>ï¼šåˆ©ç”¨æœªæ¥ä¿¡æ¯ä¸ºå½“å‰åˆ¤æ–­æä¾›ä¸Šä¸‹æ–‡çº¦æŸ</li>
<li><strong>ä¿¡æ¯äº’è¡¥</strong>ï¼šå‰åå‘ä¿¡æ¯çš„ç»“åˆæä¾›äº†æ›´å…¨é¢çš„æ—¶åºè¡¨ç¤º</li>
</ul>
<p><strong>æƒ…æ„Ÿæ—¶åºæ¨¡å¼çš„å»ºæ¨¡</strong>ï¼š</p>
<ul>
<li><strong>æƒ…æ„Ÿèµ·ä¼</strong>ï¼šGRUèƒ½å¤Ÿè®°å¿†æƒ…æ„Ÿçš„å˜åŒ–è½¨è¿¹</li>
<li><strong>å…³é”®è½¬æŠ˜</strong>ï¼šé—¨æ§æœºåˆ¶è‡ªåŠ¨è¯†åˆ«æƒ…æ„Ÿè¡¨è¾¾çš„é‡è¦æ—¶åˆ»</li>
<li><strong>ä¸Šä¸‹æ–‡ä¾èµ–</strong>ï¼šåŒå‘è®¾è®¡ç¡®ä¿æ¯ä¸ªæ—¶åˆ»éƒ½èƒ½è·å¾—å……åˆ†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
</ul>
<h3 id="5-3-æ³¨æ„åŠ›æœºåˆ¶çš„åŠ¨æ€èšç„¦åŸç†"><a href="#5-3-æ³¨æ„åŠ›æœºåˆ¶çš„åŠ¨æ€èšç„¦åŸç†" class="headerlink" title="5.3 æ³¨æ„åŠ›æœºåˆ¶çš„åŠ¨æ€èšç„¦åŸç†"></a>5.3 æ³¨æ„åŠ›æœºåˆ¶çš„åŠ¨æ€èšç„¦åŸç†</h3><p>æ³¨æ„åŠ›æœºåˆ¶å®ç°äº†å¯¹åºåˆ—ä¿¡æ¯çš„æ™ºèƒ½é€‰æ‹©ï¼š</p>
<p><strong>æ³¨æ„åŠ›æƒé‡çš„å­¦ä¹ æœºåˆ¶</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># æ³¨æ„åŠ›æƒé‡è®¡ç®—çš„æ ¸å¿ƒé€»è¾‘</span>
similarity_scores <span class="token operator">=</span> query @ keys<span class="token punctuation">.</span>T  <span class="token comment"># è®¡ç®—ç›¸ä¼¼åº¦</span>
attention_weights <span class="token operator">=</span> softmax<span class="token punctuation">(</span>similarity_scores<span class="token punctuation">)</span>  <span class="token comment"># å½’ä¸€åŒ–æƒé‡</span>
attended_features <span class="token operator">=</span> attention_weights @ values  <span class="token comment"># åŠ æƒèšåˆ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>åŠ¨æ€èšç„¦çš„å®ç°åŸç†</strong>ï¼š</p>
<ul>
<li><strong>æŸ¥è¯¢é©±åŠ¨</strong>ï¼šæ¯ä¸ªæ—¶é—´æ­¥ä½œä¸ºæŸ¥è¯¢ï¼ŒåŠ¨æ€å…³æ³¨æ•´ä¸ªåºåˆ—</li>
<li><strong>ç›¸ä¼¼åº¦åŒ¹é…</strong>ï¼šå­¦ä¹ åˆ°çš„å˜æ¢çŸ©é˜µæ•è·æŸ¥è¯¢ä¸é”®çš„åŒ¹é…æ¨¡å¼</li>
<li><strong>è‡ªé€‚åº”æƒé‡</strong>ï¼šä¸åŒæƒ…æ„Ÿç±»åˆ«ä¸‹çš„æ³¨æ„åŠ›æ¨¡å¼è‡ªåŠ¨åˆ†åŒ–</li>
</ul>
<p><strong>æƒ…æ„Ÿå…³é”®ä¿¡æ¯çš„è¯†åˆ«</strong>ï¼š</p>
<ul>
<li><strong>éŸµå¾‹é‡ç‚¹</strong>ï¼šè‡ªåŠ¨å…³æ³¨è¯­è°ƒå˜åŒ–å‰§çƒˆçš„æ—¶é—´æ®µ</li>
<li><strong>è¯­ä¹‰å…³é”®è¯</strong>ï¼šèšç„¦äºå¸¦æœ‰å¼ºæƒ…æ„Ÿè‰²å½©çš„è¯æ±‡</li>
<li><strong>åœé¡¿æ¨¡å¼</strong>ï¼šè¯†åˆ«æƒ…æ„Ÿè¡¨è¾¾ä¸­çš„åœé¡¿å’ŒèŠ‚å¥å˜åŒ–</li>
</ul>
<h3 id="5-4-å…¨å±€æ± åŒ–çš„ä¿¡æ¯èšåˆç­–ç•¥"><a href="#5-4-å…¨å±€æ± åŒ–çš„ä¿¡æ¯èšåˆç­–ç•¥" class="headerlink" title="5.4 å…¨å±€æ± åŒ–çš„ä¿¡æ¯èšåˆç­–ç•¥"></a>5.4 å…¨å±€æ± åŒ–çš„ä¿¡æ¯èšåˆç­–ç•¥</h3><p>æœ€å¤§æ± åŒ–æ“ä½œå®ç°äº†ä»åºåˆ—åˆ°å…¨å±€ç‰¹å¾çš„è½¬æ¢ï¼š</p>
<p><strong>æœ€å¤§æ± åŒ–çš„é€‰æ‹©rationale</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># æœ€å¤§æ± åŒ– vs å¹³å‡æ± åŒ–çš„å¯¹æ¯”</span>
max_pooled <span class="token operator">=</span> F<span class="token punctuation">.</span>max_pool1d<span class="token punctuation">(</span>features<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span>seq_len<span class="token punctuation">)</span>  <span class="token comment"># ä¿ç•™æœ€å¼ºä¿¡å·</span>
avg_pooled <span class="token operator">=</span> F<span class="token punctuation">.</span>avg_pool1d<span class="token punctuation">(</span>features<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span>seq_len<span class="token punctuation">)</span>  <span class="token comment"># å¹³å‡æ‰€æœ‰ä¿¡å·</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>æ˜¾è‘—æ€§ä¿ç•™</strong>ï¼šæœ€å¤§æ± åŒ–ä¿ç•™æœ€å¼ºçš„æƒ…æ„Ÿæ¿€æ´»ä¿¡å·</li>
<li><strong>å™ªå£°æŠ‘åˆ¶</strong>ï¼šå¿½ç•¥å¼±æ¿€æ´»çš„å™ªå£°ä¿¡æ¯</li>
<li><strong>ä¸å˜æ€§</strong>ï¼šå¯¹åºåˆ—é•¿åº¦å˜åŒ–å…·æœ‰ä¸€å®šçš„é²æ£’æ€§</li>
</ul>
<hr>
<h2 id="6-ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°"><a href="#6-ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°" class="headerlink" title="6. ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°"></a>6. ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°</h2><h3 id="6-1-ç«¯åˆ°ç«¯å­¦ä¹ èŒƒå¼çš„æŠ€æœ¯çªç ´"><a href="#6-1-ç«¯åˆ°ç«¯å­¦ä¹ èŒƒå¼çš„æŠ€æœ¯çªç ´" class="headerlink" title="6.1 ç«¯åˆ°ç«¯å­¦ä¹ èŒƒå¼çš„æŠ€æœ¯çªç ´"></a>6.1 ç«¯åˆ°ç«¯å­¦ä¹ èŒƒå¼çš„æŠ€æœ¯çªç ´</h3><p><strong>ä¼ ç»Ÿæ–¹æ³•çš„å±€é™æ€§</strong>ï¼š</p>
<ul>
<li>æ‰‹å·¥ç‰¹å¾è®¾è®¡ä¾èµ–é¢†åŸŸä¸“å®¶çŸ¥è¯†</li>
<li>ç‰¹å¾æå–ä¸åˆ†ç±»å™¨åˆ†ç¦»è®­ç»ƒï¼Œæ— æ³•å®ç°å…¨å±€ä¼˜åŒ–</li>
<li>ç‰¹å¾è¡¨è¾¾èƒ½åŠ›å—é™äºäººå·¥è®¾è®¡çš„æƒ³è±¡åŠ›</li>
</ul>
<p><strong>ç«¯åˆ°ç«¯å­¦ä¹ çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>è‡ªåŠ¨ç‰¹å¾å­¦ä¹ </strong>ï¼šæ¨¡å‹è‡ªåŠ¨å‘ç°æœ€ä¼˜çš„ç‰¹å¾è¡¨ç¤º</li>
<li><strong>å…¨å±€ä¼˜åŒ–</strong>ï¼šä»åŸå§‹è¾“å…¥åˆ°æœ€ç»ˆè¾“å‡ºçš„è”åˆä¼˜åŒ–</li>
<li><strong>é€‚åº”æ€§å¼º</strong>ï¼šèƒ½å¤Ÿé€‚åº”ä¸åŒçš„æ•°æ®åˆ†å¸ƒå’Œä»»åŠ¡éœ€æ±‚</li>
</ul>
<h3 id="6-2-å¤šå±‚æ¬¡ç‰¹å¾èåˆçš„åˆ›æ–°è®¾è®¡"><a href="#6-2-å¤šå±‚æ¬¡ç‰¹å¾èåˆçš„åˆ›æ–°è®¾è®¡" class="headerlink" title="6.2 å¤šå±‚æ¬¡ç‰¹å¾èåˆçš„åˆ›æ–°è®¾è®¡"></a>6.2 å¤šå±‚æ¬¡ç‰¹å¾èåˆçš„åˆ›æ–°è®¾è®¡</h3><p><strong>ç‰¹å¾èåˆçš„å±‚æ¬¡ç»“æ„</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">HuBERTç‰¹å¾(768ç»´) â†’ GRUæ—¶åºå»ºæ¨¡(512ç»´) â†’ æ³¨æ„åŠ›å¢å¼º â†’ å…¨å±€æ± åŒ– â†’ åˆ†ç±»è¾“å‡º<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>èåˆæœºåˆ¶çš„æŠ€æœ¯åˆ›æ–°</strong>ï¼š</p>
<ul>
<li><strong>è¯­ä¹‰-æ—¶åºèåˆ</strong>ï¼šHuBERTçš„è¯­ä¹‰ç‰¹å¾ä¸GRUçš„æ—¶åºå»ºæ¨¡ç›¸ç»“åˆ</li>
<li><strong>å±€éƒ¨-å…¨å±€èåˆ</strong>ï¼šæ³¨æ„åŠ›æœºåˆ¶å®ç°å±€éƒ¨ç‰¹å¾ä¸å…¨å±€ä¸Šä¸‹æ–‡çš„èåˆ</li>
<li><strong>é™æ€-åŠ¨æ€èåˆ</strong>ï¼šé™æ€çš„é¢„è®­ç»ƒç‰¹å¾ä¸åŠ¨æ€çš„åºåˆ—å»ºæ¨¡ç›¸ç»“åˆ</li>
</ul>
<h3 id="6-3-æ³¨æ„åŠ›å¢å¼ºæœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨"><a href="#6-3-æ³¨æ„åŠ›å¢å¼ºæœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨" class="headerlink" title="6.3 æ³¨æ„åŠ›å¢å¼ºæœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨"></a>6.3 æ³¨æ„åŠ›å¢å¼ºæœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨</h3><p><strong>æ³¨æ„åŠ›æœºåˆ¶åœ¨è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ä¸­çš„åˆ›æ–°åº”ç”¨</strong>ï¼š</p>
<ul>
<li><strong>æ—¶åºæ³¨æ„åŠ›</strong>ï¼šé’ˆå¯¹è¯­éŸ³çš„æ—¶åºç‰¹æ€§è®¾è®¡çš„æ³¨æ„åŠ›æœºåˆ¶</li>
<li><strong>æƒ…æ„Ÿèšç„¦</strong>ï¼šè‡ªåŠ¨è¯†åˆ«æƒ…æ„Ÿè¡¨è¾¾çš„å…³é”®æ—¶é—´æ®µ</li>
<li><strong>å¯è§£é‡Šæ€§</strong>ï¼šæ³¨æ„åŠ›æƒé‡æä¾›æ¨¡å‹å†³ç­–çš„å¯è§†åŒ–è§£é‡Š</li>
</ul>
<h3 id="6-4-å·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘"><a href="#6-4-å·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘" class="headerlink" title="6.4 å·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘"></a>6.4 å·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘</h3><p><strong>ç³»ç»Ÿå·¥ç¨‹åŒ–çš„å®Œæ•´æ€§</strong>ï¼š</p>
<ul>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šæ¸…æ™°çš„ä»£ç ç»“æ„ä¾¿äºç»´æŠ¤å’Œæ‰©å±•</li>
<li><strong>å®æ—¶å¤„ç†èƒ½åŠ›</strong>ï¼šæ”¯æŒéº¦å…‹é£å®æ—¶å½•éŸ³å’Œæƒ…æ„Ÿè¯†åˆ«</li>
<li><strong>ç”¨æˆ·å‹å¥½ç•Œé¢</strong>ï¼šå®Œæ•´çš„PyQt5å›¾å½¢ç•Œé¢</li>
<li><strong>è·¨å¹³å°å…¼å®¹</strong>ï¼šæ”¯æŒä¸åŒæ“ä½œç³»ç»Ÿçš„éƒ¨ç½²</li>
</ul>
<p><strong>éƒ¨ç½²ä¼˜åŒ–çš„æŠ€æœ¯ç»†èŠ‚</strong>ï¼š</p>
<ul>
<li><strong>æ¨¡å‹å‹ç¼©</strong>ï¼šé€šè¿‡é‡åŒ–ç­‰æŠ€æœ¯å‡å°‘æ¨¡å‹å¤§å°</li>
<li><strong>æ¨ç†åŠ é€Ÿ</strong>ï¼šGPUåŠ é€Ÿå’Œæ‰¹å¤„ç†ä¼˜åŒ–</li>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼šé«˜æ•ˆçš„éŸ³é¢‘ç¼“å†²å’Œç‰¹å¾ç¼“å­˜æœºåˆ¶</li>
</ul>
<h3 id="6-5-è¯„ä¼°æ–¹æ³•çš„ç§‘å­¦æ€§"><a href="#6-5-è¯„ä¼°æ–¹æ³•çš„ç§‘å­¦æ€§" class="headerlink" title="6.5 è¯„ä¼°æ–¹æ³•çš„ç§‘å­¦æ€§"></a>6.5 è¯„ä¼°æ–¹æ³•çš„ç§‘å­¦æ€§</h3><p><strong>5æŠ˜äº¤å‰éªŒè¯çš„ç»Ÿè®¡ä¸¥è°¨æ€§</strong>ï¼š</p>
<ul>
<li>ç¡®ä¿ç»“æœçš„ç»Ÿè®¡æ˜¾è‘—æ€§å’Œå¯é‡ç°æ€§</li>
<li>é¿å…æ•°æ®åˆ’åˆ†å¶ç„¶æ€§å¯¹ç»“æœçš„å½±å“</li>
<li>æä¾›æ¨¡å‹æ³›åŒ–èƒ½åŠ›çš„å¯é ä¼°è®¡</li>
</ul>
<p><strong>å¤šæŒ‡æ ‡è¯„ä¼°çš„å…¨é¢æ€§</strong>ï¼š</p>
<ul>
<li>å‡†ç¡®ç‡ã€å¬å›ç‡ã€F1åˆ†æ•°çš„ç»¼åˆè¯„ä¼°</li>
<li>æ··æ·†çŸ©é˜µåˆ†æå„ç±»åˆ«çš„è¯†åˆ«æ€§èƒ½</li>
<li>ç»Ÿè®¡æ£€éªŒç¡®ä¿ç»“æœçš„ç§‘å­¦æ€§</li>
</ul>
<hr>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¯¥IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿå±•ç°äº†ç°ä»£æ·±åº¦å­¦ä¹ åœ¨è¯­éŸ³å¤„ç†é¢†åŸŸçš„å…ˆè¿›æŠ€æœ¯åº”ç”¨ã€‚é€šè¿‡HuBERTé¢„è®­ç»ƒæ¨¡å‹çš„å¼ºå¤§ç‰¹å¾æå–èƒ½åŠ›ã€åŒå‘GRUçš„ç²¾ç¡®æ—¶åºå»ºæ¨¡ã€æ³¨æ„åŠ›æœºåˆ¶çš„æ™ºèƒ½èšç„¦ï¼Œä»¥åŠå…¨å±€æ± åŒ–çš„æœ‰æ•ˆä¿¡æ¯èšåˆï¼Œç³»ç»Ÿå®ç°äº†ä»åŸå§‹éŸ³é¢‘åˆ°æƒ…æ„Ÿç±»åˆ«çš„ç«¯åˆ°ç«¯å­¦ä¹ ã€‚</p>
<p>ç³»ç»Ÿçš„æŠ€æœ¯åˆ›æ–°ä½“ç°åœ¨å¤šä¸ªæ–¹é¢ï¼šè‡ªç›‘ç£é¢„è®­ç»ƒä¸ä¸‹æ¸¸ä»»åŠ¡çš„æœ‰æ•ˆç»“åˆã€å¤šå±‚æ¬¡ç‰¹å¾çš„æ·±åº¦èåˆã€æ³¨æ„åŠ›æœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨ï¼Œä»¥åŠå·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘ã€‚è¿™äº›è®¾è®¡ä¸ä»…ä¿è¯äº†æ¨¡å‹çš„é«˜æ€§èƒ½ï¼Œä¹Ÿä¸ºå®é™…åº”ç”¨æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚</p>
<p>é€šè¿‡æ·±å…¥çš„æºç åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç³»ç»Ÿä¸ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯å®ç°ï¼Œæ›´æ˜¯å¯¹è¯­éŸ³æƒ…æ„Ÿè¯†åˆ«é¢†åŸŸå‰æ²¿æŠ€æœ¯çš„ç³»ç»Ÿæ€§æ•´åˆå’Œåˆ›æ–°æ€§åº”ç”¨ã€‚å®ƒä¸ºç›¸å…³ç ”ç©¶å’Œåº”ç”¨å¼€å‘æä¾›äº†å®è´µçš„å‚è€ƒå’Œå€Ÿé‰´ä»·å€¼ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://huangzhongqi978.top">HuangZhongqi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://huangzhongqi978.top/2024/10/05/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3/">https://huangzhongqi978.top/2024/10/05/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://huangzhongqi978.top" target="_blank">å¥‡ç‚¹æ™ºåº“ SingularityMind</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/GRU%E7%BB%93%E6%9E%84/">GRUç»“æ„</a></div><div class="post-share"><div class="social-share" data-image="https://gitee.com/huangzhongqi776/my-images/raw/master/20251103161022855.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.com/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://unpkg.com/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>å¦‚æœè§‰å¾—æ–‡ç« ä¸é”™ï¼Œæ¬¢è¿æ‰“èµæ”¯æŒï¼</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/alipay-qrcode.png" target="_blank"><img class="post-qr-code-img" src="/img/alipay-qrcode.png" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li><li class="reward-item"><a href="/img/wechat-qrcode.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat-qrcode.png" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/12/19/ECAPA-TDNN%E5%A3%B0%E7%BA%B9%E8%AF%86%E5%88%AB%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="ECAPA-TDNNå£°çº¹è¯†åˆ«ç³»ç»Ÿè®¾è®¡ä¸å®ç°"><img class="cover" src="https://gitee.com/huangzhongqi776/my-images/raw/master/20251103161912248.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post" referrerpolicy="no-referrer"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">ECAPA-TDNNå£°çº¹è¯†åˆ«ç³»ç»Ÿè®¾è®¡ä¸å®ç°</div></div><div class="info-2"><div class="info-item-1">åŸºäºECAPA-TDNNæ¶æ„çš„å£°çº¹è¯†åˆ«ç³»ç»Ÿï¼Œé›†æˆå®æ—¶å½•éŸ³ã€å£°çº¹æ³¨å†Œã€èº«ä»½è¯†åˆ«å’Œå£°çº¹éªŒè¯åŠŸèƒ½ã€‚ç³»ç»Ÿé‡‡ç”¨æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œæå–å£°çº¹ç‰¹å¾ï¼Œé€šè¿‡ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—å®ç°é«˜ç²¾åº¦å£°çº¹åŒ¹é…ï¼Œå¹¶æ„å»ºäº†å®Œæ•´çš„PyQt5å›¾å½¢ç•Œé¢ã€‚   ç³»ç»Ÿæ¶æ„æ¦‚è¿°æœ¬å£°çº¹è¯†åˆ«ç³»ç»ŸåŸºäºECAPA-TDNNï¼ˆExtended Context Aggregation and Propagation for Time-Delay Neural Networksï¼‰æ¶æ„ï¼Œå®ç°äº†å®Œæ•´çš„å£°çº¹è¯†åˆ«å·¥ä½œæµç¨‹ã€‚ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŒ…å«éŸ³é¢‘å¤„ç†ã€ç‰¹å¾æå–ã€æ¨¡å‹æ¨ç†å’Œç”¨æˆ·ç•Œé¢å››ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚ æ ¸å¿ƒæŠ€æœ¯æ ˆ æ·±åº¦å­¦ä¹ æ¡†æ¶: PyTorch éŸ³é¢‘å¤„ç†: soundcard, soundfile å›¾å½¢ç•Œé¢: PyQt5 ç‰¹å¾æå–: MelSpectrogram ç›¸ä¼¼åº¦è®¡ç®—: ä½™å¼¦ç›¸ä¼¼åº¦  ECAPA-TDNNæ¨¡å‹æ¶æ„ECAPA-TDNNæ˜¯å½“å‰æœ€å…ˆè¿›çš„å£°çº¹è¯†åˆ«æ¨¡å‹ä¹‹ä¸€ï¼Œé€šè¿‡æ”¹è¿›çš„Res2Netç»“æ„å’Œæ³¨æ„åŠ›æœºåˆ¶å®ç°é«˜ç²¾åº¦å£°çº¹ç‰¹å¾æå–ã€‚ æ ¸å¿ƒç»„ä»¶è®¾è®¡class EcapaTdnn(nn.Module):     def __init__(self, input_si...</div></div></div></a><a class="pagination-related" href="/2024/10/02/%E5%9B%BE%E5%BA%8A%E4%BD%BF%E7%94%A8%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/" title="åšå®¢ä½¿ç”¨å›¾åºŠæ•™ç¨‹"><img class="cover" src="https://gitee.com/huangzhongqi776/my-images/raw/master/20251103161439709.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post" referrerpolicy="no-referrer"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">åšå®¢ä½¿ç”¨å›¾åºŠæ•™ç¨‹</div></div><div class="info-2"><div class="info-item-1">è¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Giteeå’ŒGitHubå›¾åºŠæ¥æ‰˜ç®¡åšå®¢å›¾ç‰‡ï¼Œæå‡åšå®¢æ€§èƒ½å’Œç®¡ç†æ•ˆç‡ã€‚    ä»€ä¹ˆæ˜¯å›¾åºŠï¼Ÿå›¾åºŠæ˜¯ä¸“é—¨ç”¨äºå­˜å‚¨å›¾ç‰‡çš„åœ¨çº¿æœåŠ¡ï¼Œå®ƒèƒ½ä¸ºä½ çš„åšå®¢å¸¦æ¥ä»¥ä¸‹ä¼˜åŠ¿ï¼š  âœ… å‡å°‘åšå®¢ä½“ç§¯ - å›¾ç‰‡ä¸å ç”¨åšå®¢å­˜å‚¨ç©ºé—´ âœ… æå‡åŠ è½½é€Ÿåº¦ - ä¸“ä¸šCDNåŠ é€Ÿå›¾ç‰‡è®¿é—® âœ… è·¨å¹³å°ä½¿ç”¨ - ä¸€å¼ å›¾ç‰‡å¯åœ¨å¤šå¤„å¼•ç”¨ âœ… ç¨³å®šå¯é  - ä¸“ä¸šæœåŠ¡å•†æä¾›æ•°æ®ä¿éšœ  Giteeå›¾åºŠé…ç½®ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºGiteeä»“åº“ è®¿é—® Giteeå®˜ç½‘ å¹¶ç™»å½• ç‚¹å‡»å³ä¸Šè§’ + â†’ æ–°å»ºä»“åº“ å¡«å†™ä»“åº“ä¿¡æ¯ï¼š ä»“åº“åç§°ï¼šmy-images è®¾ç½®ä¸ºï¼šå…¬å¼€ ï¼ˆé‡è¦ï¼ï¼‰ å‹¾é€‰ï¼šä½¿ç”¨Readmeæ–‡ä»¶åˆå§‹åŒ–    ç¬¬äºŒæ­¥ï¼šè·å–ç§äººä»¤ç‰Œ ç‚¹å‡»å¤´åƒ â†’ è®¾ç½® å·¦ä¾§èœå•é€‰æ‹© ç§äººä»¤ç‰Œ ç‚¹å‡» ç”Ÿæˆæ–°ä»¤ç‰Œ å‹¾é€‰ projects æƒé™ å¤åˆ¶ç”Ÿæˆçš„ä»¤ç‰Œï¼ˆåªæ˜¾ç¤ºä¸€æ¬¡ï¼ï¼‰  PicGoé…ç½®å®‰è£…PicGoæ¨èä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…ï¼š # Windowsç”¨æˆ· winget install PicGo.PicGo  # macOSç”¨æˆ·   brew install --cask picgo  # æˆ–ä»GitHubä¸‹è½½ï¼šhttps://github.com...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://gitee.com/huangzhongqi776/my-images/raw/master/ff71db1967b4c412f794ffe33ef624f.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/ referrerpolicy="no-referrer"></div><div class="author-info-name">HuangZhongqi</div><div class="author-info-description">Deep Learning & Computer Vision</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">48</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">20</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Huangzhongqi978"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Huangzhongqi978" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://twitter.com/" target="_blank" title="Twitter"><i class="fab fa-twitter" style="color: #1da1f2;"></i></a><a class="social-icon" href="https://linkedin.com/in/huangzhongqi" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #0077b5;"></i></a><a class="social-icon" href="mailto:huangzhongqi978@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon qr-trigger" href="javascript:void(0)" title="WeChat" data-qr-src="https://gitee.com/huangzhongqi776/my-images/raw/master/20251005125834859.png" data-qr-type="WeChat"><i class="fab fa-weixin" style="color: #07c160;"></i></a><a class="social-icon qr-trigger" href="javascript:void(0)" title="QQ" data-qr-src="https://gitee.com/huangzhongqi776/my-images/raw/master/20251005125800207.png" data-qr-type="QQ"><i class="fab fa-qq" style="color: #12b7f5;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">å¥‡ç‚¹æ™ºåº“ - äººå·¥æ™ºèƒ½æŠ€æœ¯åšå®¢ä¸æ–‡æ¡£ï¼Œåˆ†äº«æ·±åº¦å­¦ä¹ ã€NLPã€è®¡ç®—æœºè§†è§‰æŠ€æœ¯</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%83%85%E6%84%9F%E8%AF%86%E5%88%AB%E6%A8%A1%E5%9E%8B%E4%BC%98%E5%8C%96%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3"><span class="toc-number">1.</span> <span class="toc-text">æƒ…æ„Ÿè¯†åˆ«æ¨¡å‹ä¼˜åŒ–è¯¦ç»†æ–‡æ¡£</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8B-%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">ğŸ“‹ ç›®å½•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%96-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.</span> <span class="toc-text">ğŸ“– æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E4%BC%98%E5%8C%96%E7%9B%AE%E6%A0%87"><span class="toc-number">1.2.1.</span> <span class="toc-text">ä¸»è¦ä¼˜åŒ–ç›®æ ‡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%A7-%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">1.3.</span> <span class="toc-text">ğŸ”§ æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%AF%B4%E8%AF%9D%E4%BA%BA%E6%97%A0%E5%85%B3%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. è¯´è¯äººæ— å…³åŒ–æŠ€æœ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%87%AA%E9%80%82%E5%BA%94%E5%AE%9E%E4%BE%8B%E5%BD%92%E4%B8%80%E5%8C%96-AdaIN"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1.1 è‡ªé€‚åº”å®ä¾‹å½’ä¸€åŒ– (AdaIN)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%A2%AF%E5%BA%A6%E5%8F%8D%E8%BD%AC%E5%AF%B9%E6%8A%97%E8%AE%AD%E7%BB%83"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">1.2 æ¢¯åº¦åè½¬å¯¹æŠ—è®­ç»ƒ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A4%9A%E5%A4%B4%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6"><span class="toc-number">1.3.2.</span> <span class="toc-text">2. å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81"><span class="toc-number">1.3.3.</span> <span class="toc-text">3. ä½ç½®ç¼–ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8F%97%EF%B8%8F-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.4.</span> <span class="toc-text">ğŸ—ï¸ ä»£ç å®ç°è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%A2%9E%E5%BC%BAGRU%E6%A8%A1%E5%9E%8B%E6%9E%B6%E6%9E%84"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. å¢å¼ºGRUæ¨¡å‹æ¶æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%89%8D%E5%90%91%E4%BC%A0%E6%92%AD%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. å‰å‘ä¼ æ’­æµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%99%EF%B8%8F-%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E"><span class="toc-number">1.5.</span> <span class="toc-text">âš™ï¸ å‚æ•°é…ç½®è¯´æ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84%E5%8F%82%E6%95%B0"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. æ¨¡å‹ç»“æ„å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5%E5%8F%82%E6%95%B0"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. ä¼˜åŒ–ç­–ç•¥å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AF%B4%E8%AF%9D%E4%BA%BA%E6%97%A0%E5%85%B3%E5%8C%96%E5%8F%82%E6%95%B0"><span class="toc-number">1.5.3.</span> <span class="toc-text">3. è¯´è¯äººæ— å…³åŒ–å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%8F%82%E6%95%B0"><span class="toc-number">1.5.4.</span> <span class="toc-text">4. æ³¨æ„åŠ›æœºåˆ¶å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8E%AF-%E8%AE%AD%E7%BB%83%E7%AD%96%E7%95%A5%E4%BC%98%E5%8C%96"><span class="toc-number">1.6.</span> <span class="toc-text">ğŸ¯ è®­ç»ƒç­–ç•¥ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BB%BC%E5%90%88%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0"><span class="toc-number">1.6.1.</span> <span class="toc-text">1. ç»¼åˆæŸå¤±å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8A%A8%E6%80%81%E5%AF%B9%E6%8A%97%E8%AE%AD%E7%BB%83%E7%AD%96%E7%95%A5"><span class="toc-number">1.6.2.</span> <span class="toc-text">2. åŠ¨æ€å¯¹æŠ—è®­ç»ƒç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AD%A6%E4%B9%A0%E7%8E%87%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5"><span class="toc-number">1.6.3.</span> <span class="toc-text">3. å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA%E7%AD%96%E7%95%A5"><span class="toc-number">1.6.4.</span> <span class="toc-text">4. æ•°æ®å¢å¼ºç­–ç•¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8A-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">1.7.</span> <span class="toc-text">ğŸ“Š æ€§èƒ½ç›‘æ§ä¸å¯è§†åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%AE%AD%E7%BB%83%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87"><span class="toc-number">1.7.1.</span> <span class="toc-text">1. è®­ç»ƒç›‘æ§æŒ‡æ ‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%B7%A8%E8%AF%B4%E8%AF%9D%E4%BA%BA%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">1.7.2.</span> <span class="toc-text">2. è·¨è¯´è¯äººæ€§èƒ½åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8E%AF-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.8.</span> <span class="toc-text">ğŸ¯ ä½¿ç”¨ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A8%A1%E5%9E%8B%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.8.1.</span> <span class="toc-text">1. æ¨¡å‹åˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AE%AD%E7%BB%83%E6%B5%81%E7%A8%8B"><span class="toc-number">1.8.2.</span> <span class="toc-text">2. è®­ç»ƒæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%80%A7%E8%83%BD%E8%AF%84%E4%BC%B0"><span class="toc-number">1.8.3.</span> <span class="toc-text">3. æ€§èƒ½è¯„ä¼°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%88-%E9%A2%84%E6%9C%9F%E6%94%B9%E8%BF%9B%E6%95%88%E6%9E%9C"><span class="toc-number">1.9.</span> <span class="toc-text">ğŸ“ˆ é¢„æœŸæ”¹è¿›æ•ˆæœ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E6%8F%90%E5%8D%87%E9%A2%84%E6%9C%9F"><span class="toc-number">1.9.1.</span> <span class="toc-text">æ€§èƒ½æå‡é¢„æœŸ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E4%BC%98%E5%8A%BF"><span class="toc-number">1.9.2.</span> <span class="toc-text">æŠ€æœ¯ä¼˜åŠ¿</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%A7-%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="toc-number">1.10.</span> <span class="toc-text">ğŸ”§ æ•…éšœæ’é™¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.10.1.</span> <span class="toc-text">å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%9A-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">1.11.</span> <span class="toc-text">ğŸ“š å‚è€ƒæ–‡çŒ®</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IEMOCAP%E8%AF%AD%E9%9F%B3%E6%83%85%E6%84%9F%E8%AF%86%E5%88%AB%E7%B3%BB%E7%BB%9F%E6%B7%B1%E5%BA%A6%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">IEMOCAPè¯­éŸ³æƒ…æ„Ÿè¯†åˆ«ç³»ç»Ÿæ·±åº¦æºç è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">2.1.</span> <span class="toc-text">ç›®å½•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E4%B8%8E%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86"><span class="toc-number">2.2.</span> <span class="toc-text">1. é¡¹ç›®æ•´ä½“æ¶æ„ä¸æ¨¡å—åˆ’åˆ†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.1 ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86"><span class="toc-number">2.2.2.</span> <span class="toc-text">1.2 æ ¸å¿ƒæ¨¡å—åˆ’åˆ†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E5%8A%9F%E8%83%BD%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="toc-number">2.3.</span> <span class="toc-text">2. æ ¸å¿ƒç»„ä»¶åŠŸèƒ½æ·±åº¦è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-HubertModel%E8%AF%AD%E9%9F%B3%E7%89%B9%E5%BE%81%E7%BC%96%E7%A0%81%E5%99%A8"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.1 HubertModelè¯­éŸ³ç‰¹å¾ç¼–ç å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E6%A8%A1%E5%9E%8B%E9%80%89%E6%8B%A9%E7%9A%84%E6%B7%B1%E5%B1%82%E8%80%83%E9%87%8F"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">2.1.1 æ¨¡å‹é€‰æ‹©çš„æ·±å±‚è€ƒé‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96%E7%9A%84%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">2.1.2 ç‰¹å¾æå–çš„æŠ€æœ¯å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-%E9%9F%B3%E9%A2%91%E9%A2%84%E5%A4%84%E7%90%86%E7%9A%84%E5%B7%A5%E7%A8%8B%E8%80%83%E9%87%8F"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">2.1.3 éŸ³é¢‘é¢„å¤„ç†çš„å·¥ç¨‹è€ƒé‡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-GRUModel%E5%8F%8C%E5%90%91%E5%BA%8F%E5%88%97%E5%BB%BA%E6%A8%A1%E5%99%A8"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.2 GRUModelåŒå‘åºåˆ—å»ºæ¨¡å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E7%9A%84%E6%B7%B1%E5%B1%82%E9%80%BB%E8%BE%91"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">2.2.1 æ¶æ„è®¾è®¡çš„æ·±å±‚é€»è¾‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E5%89%8D%E5%90%91%E4%BC%A0%E6%92%AD%E7%9A%84%E7%B2%BE%E5%AF%86%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">2.2.2 å‰å‘ä¼ æ’­çš„ç²¾å¯†è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-MatchingAttention%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3 MatchingAttentionæ³¨æ„åŠ›æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E6%B3%A8%E6%84%8F%E5%8A%9B%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">2.3.1 æ³¨æ„åŠ›è®¾è®¡çš„ç†è®ºåŸºç¡€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E6%B3%A8%E6%84%8F%E5%8A%9B%E8%AE%A1%E7%AE%97%E7%9A%84%E6%95%B0%E5%AD%A6%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">2.3.2 æ³¨æ„åŠ›è®¡ç®—çš„æ•°å­¦å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-%E6%B3%A8%E6%84%8F%E5%8A%9B%E5%9C%A8%E6%83%85%E6%84%9F%E8%AF%86%E5%88%AB%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8%E6%9C%BA%E5%88%B6"><span class="toc-number">2.3.3.3.</span> <span class="toc-text">2.3.3 æ³¨æ„åŠ›åœ¨æƒ…æ„Ÿè¯†åˆ«ä¸­çš„ä½œç”¨æœºåˆ¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%88%86%E7%B1%BB%E5%A4%B4%E4%B8%8E%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0%E7%9A%84%E7%B2%BE%E5%BF%83%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.3.4.</span> <span class="toc-text">2.4 åˆ†ç±»å¤´ä¸æ¿€æ´»å‡½æ•°çš„ç²¾å¿ƒè®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E5%88%86%E7%B1%BB%E5%A4%B4%E7%9A%84%E6%9E%B6%E6%9E%84%E9%80%89%E6%8B%A9"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">2.4.1 åˆ†ç±»å¤´çš„æ¶æ„é€‰æ‹©</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0%E7%9A%84%E5%B1%82%E6%AC%A1%E5%8C%96%E5%BA%94%E7%94%A8"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">2.4.2 æ¿€æ´»å‡½æ•°çš„å±‚æ¬¡åŒ–åº”ç”¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%B5%81%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90"><span class="toc-number">2.4.</span> <span class="toc-text">3. å®Œæ•´æ•°æ®æµè·¯å¾„åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E8%AE%AD%E7%BB%83%E9%98%B6%E6%AE%B5%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-number">2.4.1.</span> <span class="toc-text">3.1 è®­ç»ƒé˜¶æ®µæ•°æ®æµ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%8E%A8%E7%90%86%E9%98%B6%E6%AE%B5%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-number">2.4.2.</span> <span class="toc-text">3.2 æ¨ç†é˜¶æ®µæ•°æ®æµ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-GUI%E5%AE%9E%E6%97%B6%E5%A4%84%E7%90%86%E6%B5%81"><span class="toc-number">2.4.3.</span> <span class="toc-text">3.3 GUIå®æ—¶å¤„ç†æµ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%85%B3%E9%94%AE%E5%8F%82%E6%95%B0%E5%90%AB%E4%B9%89%E4%B8%8E%E6%80%A7%E8%83%BD%E5%BD%B1%E5%93%8D"><span class="toc-number">2.5.</span> <span class="toc-text">4. å…³é”®å‚æ•°å«ä¹‰ä¸æ€§èƒ½å½±å“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84%E5%8F%82%E6%95%B0%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90"><span class="toc-number">2.5.1.</span> <span class="toc-text">4.1 æ¨¡å‹ç»“æ„å‚æ•°æ·±åº¦åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%AE%AD%E7%BB%83%E8%B6%85%E5%8F%82%E6%95%B0%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90"><span class="toc-number">2.5.2.</span> <span class="toc-text">4.2 è®­ç»ƒè¶…å‚æ•°æ·±åº¦åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%8F%82%E6%95%B0%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90"><span class="toc-number">2.5.3.</span> <span class="toc-text">4.3 æ•°æ®å¤„ç†å‚æ•°æ·±åº¦åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98%E7%9A%84%E7%B3%BB%E7%BB%9F%E6%80%A7%E6%96%B9%E6%B3%95"><span class="toc-number">2.5.4.</span> <span class="toc-text">4.4 å‚æ•°è°ƒä¼˜çš„ç³»ç»Ÿæ€§æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%A8%A1%E5%9E%8B%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3"><span class="toc-number">2.6.</span> <span class="toc-text">5. æ¨¡å‹å·¥ä½œæœºåˆ¶æ·±å…¥ç†è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E8%87%AA%E7%9B%91%E7%9D%A3%E9%A2%84%E8%AE%AD%E7%BB%83%E7%9A%84%E6%B7%B1%E5%B1%82%E4%BB%B7%E5%80%BC"><span class="toc-number">2.6.1.</span> <span class="toc-text">5.1 è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ·±å±‚ä»·å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%BA%8F%E5%88%97%E5%BB%BA%E6%A8%A1%E7%9A%84%E6%97%B6%E5%BA%8F%E4%BE%9D%E8%B5%96%E6%9C%BA%E5%88%B6"><span class="toc-number">2.6.2.</span> <span class="toc-text">5.2 åºåˆ—å»ºæ¨¡çš„æ—¶åºä¾èµ–æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8A%A8%E6%80%81%E8%81%9A%E7%84%A6%E5%8E%9F%E7%90%86"><span class="toc-number">2.6.3.</span> <span class="toc-text">5.3 æ³¨æ„åŠ›æœºåˆ¶çš„åŠ¨æ€èšç„¦åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E5%85%A8%E5%B1%80%E6%B1%A0%E5%8C%96%E7%9A%84%E4%BF%A1%E6%81%AF%E8%81%9A%E5%90%88%E7%AD%96%E7%95%A5"><span class="toc-number">2.6.4.</span> <span class="toc-text">5.4 å…¨å±€æ± åŒ–çš„ä¿¡æ¯èšåˆç­–ç•¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8A%BF%E4%B8%8E%E6%8A%80%E6%9C%AF%E5%88%9B%E6%96%B0"><span class="toc-number">2.7.</span> <span class="toc-text">6. ç³»ç»Ÿä¼˜åŠ¿ä¸æŠ€æœ¯åˆ›æ–°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%AD%A6%E4%B9%A0%E8%8C%83%E5%BC%8F%E7%9A%84%E6%8A%80%E6%9C%AF%E7%AA%81%E7%A0%B4"><span class="toc-number">2.7.1.</span> <span class="toc-text">6.1 ç«¯åˆ°ç«¯å­¦ä¹ èŒƒå¼çš„æŠ€æœ¯çªç ´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%A4%9A%E5%B1%82%E6%AC%A1%E7%89%B9%E5%BE%81%E8%9E%8D%E5%90%88%E7%9A%84%E5%88%9B%E6%96%B0%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.7.2.</span> <span class="toc-text">6.2 å¤šå±‚æ¬¡ç‰¹å¾èåˆçš„åˆ›æ–°è®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E6%B3%A8%E6%84%8F%E5%8A%9B%E5%A2%9E%E5%BC%BA%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8E%9F%E5%88%9B%E6%80%A7%E5%BA%94%E7%94%A8"><span class="toc-number">2.7.3.</span> <span class="toc-text">6.3 æ³¨æ„åŠ›å¢å¼ºæœºåˆ¶çš„åŸåˆ›æ€§åº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E5%B7%A5%E7%A8%8B%E5%8C%96%E9%83%A8%E7%BD%B2%E7%9A%84%E5%85%A8%E9%9D%A2%E8%80%83%E8%99%91"><span class="toc-number">2.7.4.</span> <span class="toc-text">6.4 å·¥ç¨‹åŒ–éƒ¨ç½²çš„å…¨é¢è€ƒè™‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E8%AF%84%E4%BC%B0%E6%96%B9%E6%B3%95%E7%9A%84%E7%A7%91%E5%AD%A6%E6%80%A7"><span class="toc-number">2.7.5.</span> <span class="toc-text">6.5 è¯„ä¼°æ–¹æ³•çš„ç§‘å­¦æ€§</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.8.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/10/Yolo11%E4%BA%A4%E9%80%9A%E6%A0%87%E5%BF%97%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F/" title="Yolo11äº¤é€šæ ‡å¿—æ£€æµ‹ç³»ç»Ÿ"><img src="https://gitee.com/huangzhongqi776/my-images/raw/master/20251005131157954.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Yolo11äº¤é€šæ ‡å¿—æ£€æµ‹ç³»ç»Ÿ"/ referrerpolicy="no-referrer"></a><div class="content"><a class="title" href="/2025/09/10/Yolo11%E4%BA%A4%E9%80%9A%E6%A0%87%E5%BF%97%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F/" title="Yolo11äº¤é€šæ ‡å¿—æ£€æµ‹ç³»ç»Ÿ">Yolo11äº¤é€šæ ‡å¿—æ£€æµ‹ç³»ç»Ÿ</a><time datetime="2025-09-10T07:59:31.000Z" title="å‘è¡¨äº 2025-09-10 15:59:31">2025-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/05/technical_report/" title="åŸºäºLLMå’ŒRAGçš„é¢†å…‹æ±½è½¦æ™ºèƒ½é—®ç­”ç³»ç»Ÿ"><img src="https://gitee.com/huangzhongqi776/my-images/raw/master/20251103160846304.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åŸºäºLLMå’ŒRAGçš„é¢†å…‹æ±½è½¦æ™ºèƒ½é—®ç­”ç³»ç»Ÿ"/ referrerpolicy="no-referrer"></a><div class="content"><a class="title" href="/2025/09/05/technical_report/" title="åŸºäºLLMå’ŒRAGçš„é¢†å…‹æ±½è½¦æ™ºèƒ½é—®ç­”ç³»ç»Ÿ">åŸºäºLLMå’ŒRAGçš„é¢†å…‹æ±½è½¦æ™ºèƒ½é—®ç­”ç³»ç»Ÿ</a><time datetime="2025-09-05T05:59:31.000Z" title="å‘è¡¨äº 2025-09-05 13:59:31">2025-09-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/15/p2%E6%A3%80%E6%B5%8B%E5%A4%B4%E4%BA%A4%E9%80%9A%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F/" title="æ·»åŠ P2æ£€æµ‹å¤´ä¸SEæœºåˆ¶çš„YOLOv8äº¤é€šè½¦è¾†ä¸é“è·¯ç›‘æ£€æµ‹ç³»ç»Ÿä¼˜åŒ–"><img src="https://gitee.com/huangzhongqi776/my-images/raw/master/20251103161622681.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ·»åŠ P2æ£€æµ‹å¤´ä¸SEæœºåˆ¶çš„YOLOv8äº¤é€šè½¦è¾†ä¸é“è·¯ç›‘æ£€æµ‹ç³»ç»Ÿä¼˜åŒ–"/ referrerpolicy="no-referrer"></a><div class="content"><a class="title" href="/2025/07/15/p2%E6%A3%80%E6%B5%8B%E5%A4%B4%E4%BA%A4%E9%80%9A%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F/" title="æ·»åŠ P2æ£€æµ‹å¤´ä¸SEæœºåˆ¶çš„YOLOv8äº¤é€šè½¦è¾†ä¸é“è·¯ç›‘æ£€æµ‹ç³»ç»Ÿä¼˜åŒ–">æ·»åŠ P2æ£€æµ‹å¤´ä¸SEæœºåˆ¶çš„YOLOv8äº¤é€šè½¦è¾†ä¸é“è·¯ç›‘æ£€æµ‹ç³»ç»Ÿä¼˜åŒ–</a><time datetime="2025-07-14T16:00:00.000Z" title="å‘è¡¨äº 2025-07-15 00:00:00">2025-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/15/%E5%A9%9A%E6%81%8B%E7%B3%BB%E7%BB%9F%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E4%B8%8E%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" title="åŸºäºDjango+Vueçš„å©šå§»æ³•çŸ¥è¯†å›¾è°±é—®ç­”ç³»ç»Ÿ"><img src="https://gitee.com/huangzhongqi776/my-images/raw/master/20251103161244190.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åŸºäºDjango+Vueçš„å©šå§»æ³•çŸ¥è¯†å›¾è°±é—®ç­”ç³»ç»Ÿ"/ referrerpolicy="no-referrer"></a><div class="content"><a class="title" href="/2025/06/15/%E5%A9%9A%E6%81%8B%E7%B3%BB%E7%BB%9F%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E4%B8%8E%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" title="åŸºäºDjango+Vueçš„å©šå§»æ³•çŸ¥è¯†å›¾è°±é—®ç­”ç³»ç»Ÿ">åŸºäºDjango+Vueçš„å©šå§»æ³•çŸ¥è¯†å›¾è°±é—®ç­”ç³»ç»Ÿ</a><time datetime="2025-06-15T02:30:00.000Z" title="å‘è¡¨äº 2025-06-15 10:30:00">2025-06-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/27/AI%E6%99%BA%E8%83%BD%E7%AD%94%E9%A2%98%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="åŸºäºSpring Cloudä¸Vue3çš„AIæ™ºèƒ½ç­”é¢˜ç³»ç»Ÿ"><img src="https://gitee.com/huangzhongqi776/my-images/raw/master/20251103162047789.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åŸºäºSpring Cloudä¸Vue3çš„AIæ™ºèƒ½ç­”é¢˜ç³»ç»Ÿ"/ referrerpolicy="no-referrer"></a><div class="content"><a class="title" href="/2025/01/27/AI%E6%99%BA%E8%83%BD%E7%AD%94%E9%A2%98%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="åŸºäºSpring Cloudä¸Vue3çš„AIæ™ºèƒ½ç­”é¢˜ç³»ç»Ÿ">åŸºäºSpring Cloudä¸Vue3çš„AIæ™ºèƒ½ç­”é¢˜ç³»ç»Ÿ</a><time datetime="2025-01-27T02:00:00.000Z" title="å‘è¡¨äº 2025-01-27 10:00:00">2025-01-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://gitee.com/huangzhongqi776/my-images/raw/master/20251103161022855.png);"><div class="footer-other"><div class="footer-copyright"></div><div class="footer_custom_text"><div style="line-height: 1.8;">
  <div>Â© 2025 HuangZhongqi</div>
  <div style="margin-top: 8px;">
    <a href="https://beian.miit.gov.cn" target="_blank" rel="noopener" style="color: inherit; text-decoration: none;">
      <img src="/img/gongxin.png" alt="ICPå¤‡æ¡ˆ" style="height: 16px; vertical-align: middle; margin-right: 4px;">ICPå¤‡æ¡ˆé²ICPå¤‡2025190459å·
    </a>
  </div>
  <div style="margin-top: 8px;">
    <a href="http://www.beian.gov.cn" target="_blank" rel="noopener" style="color: inherit; text-decoration: none;">
      <img src="/img/å¤‡æ¡ˆå›¾æ ‡.png" alt="å…¬å®‰å¤‡æ¡ˆ" style="height: 16px; vertical-align: middle; margin-right: 4px;">å…¬å®‰å¤‡æ¡ˆé²å…¬ç½‘å®‰å¤‡37028102001667å·
    </a>
  </div>
  <div style="margin-top: 8px;">Copyright Â© 2022 - 2025 Huang Zhongqi. All Rights Reserved. é»„ä¸­å¥‡ç‰ˆæƒæ‰€æœ‰</div>
</div>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><script src="/js/qr-modal.js"></script><script src="/js/reading-progress.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'Huangzhongqi978/blog-commnts',
      'data-repo-id': 'R_kgDOQOt6kA',
      'data-category-id': 'DIC_kwDOQOt6kM4CxaSm',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script src="/js/mouse-trail.js"></script><script src="/js/background-check.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://unpkg.com/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script id="click-show-text" src="https://unpkg.com/butterfly-extsrc@1.1.6/dist/click-show-text.min.js" data-mobile="false" data-text="å¥½æ£’ï¼,åŠ æ²¹ï¼,å¾ˆæ£’ï¼,ç‚¹èµï¼,å¤ªæ£’äº†ï¼,ä¼˜ç§€ï¼,ç²¾å½©ï¼,èµï¼" data-fontsize="15px" data-random="true" async="async"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="local-search-input"><input placeholder="æœç´¢æ–‡ç« ..." type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.1"></script></div></div></body></html>